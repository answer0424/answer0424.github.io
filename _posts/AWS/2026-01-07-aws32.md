---
layout: post
title: Systems Manager 파라미터를 사용한 AMI 참조
date: 2026-01-07 09:00:00 +09:00
categories: [AWS, EC2, AMI]
tags: [aws]
image:
    path: /assets/img/aws/AWS.png
---

## 개요

> AWS Systems Manager Parameter Store를 이용하면 AMI ID를 직접 입력하는 대신 파라미터로 대신 참조할 수 있음
>
> 이를 통해 AMI ID 업데이트/관리 작업을 자동화 코드나 콘솔 흐름에서 단순화할 수 있음

- AMI ID 대신 파라미터 이름으로 인스턴스를 시작 가능
- Parameter Store에서 저장된 값은 AMI ID를 포함하는 값이어야 함
- 파라미터 데이터 유형은 공식적으로 `aws:ec2:image`로 지정해야 함

<hr>

## 파라미터를 사용하는 이유

#### 1. 사용 편의성 향상

- 특정 AMI를 반복해서 선택해야 하는 경우
- AMI가 정기적으로 새 버전으로 업데이트될 때
  - 사용자는 항상 하나의 파라미터 이름만 선택하면 되고 파라미터 값만 최신 AMI로 갱신하면 됨

> 이렇게 하면 사용자 본인이 매번 최신 AMI ID를 알 필요가 없어짐

<br>

#### 2. 자동화 코드 유지 관리 간소화

- 자동화 스크립트/템플릿이 AMI ID에 의존할 때
- 새 버전 AMI가 발행되어도 파라미터만 갱신하면 끝
  - 스크립트나 템플릿을 일일이 수정할 필요가 줄어듦

> 참고: 파라미터가 가리키는 AMI ID를 변경해도 이미 실행중인 인스턴스에는 영향이 없음

<hr>

## 파라미터 생성 시 주의사항

#### 데이터 유형은 반드시 `aws:ec2:image`로 설정

> 파라미터를 생성할 때 데이터 유형을 `aws:ec2:image`로 지정해야 AWS가 이를 AMI ID로 인식

- 이 데이터 유형을 지정하면 파라미터에 지정된 값이 정상적인 AMI ID 형식인지 검증됨
- 유효하지 않은 AMI ID를 저장하려 하면 오류가 발생할 수 있음

<hr>

## 인스턴스 시작 시 파라미터 지정 방법

```makefile
resolve:ssm:parameter-name
```

- 여기서 `parameter-name`은 파라미터 Store에 저장된 파라미터 이름
- 이 구문은 자동으로 파라미터 값을 AMI ID로 해석하여 인스턴스를 시작할 때 사용

> 또한 파라미터별 버전 번호를 명시할 수도 있음

```pgsql
resolve:ssm:parameter-name:version
```

- 버전을 지정하지 않으면 기본적으로 최신 버전이 참조됨

<hr>

## IAM 권한 요구 사항

> 인스턴스 시작 마법사나 자동화 코드가 Systems Manager 파라미터를 사용하는 경우, 다음 IAM 권한이 필요

| 작업 | 필요 이유 |
|-|-|
| `ssm:DescribeParameters` | 파라미터 목록을 보고 선택할 수 있도록 함 |
| `ssm:GetParameter` | 파라미터 이름으로 값을 조회할 수 있도록 함 |

- 특정 파라미터만 사용하도록 액세스 제한 정책을 정의할 수도 있음

<hr>

## 제한 사항/주의

- 파라미터는 리전별로 존재
  - 동일한 파라미터 이름이라도 각 리전에 별도로 생성해야 함
  - 다른 리전의 Parameter Store에서 자동으로 검색되지는 않음
- 파라미터 이름은 대/소문자 구분
  - 예: `/amis/prod/golden-ami`와 `/AMIS/PROD/GOLDEN-AMI`는 다른 파라미터로 간주됨
- 파라미터 구조
  - 파라미터가 계층 구조를 가질 때는 슬래시(`/`)를 포함할 수 있음
  - 계층 구조가 아니라면 슬래시 없이 이름만 쓸 수도 있음