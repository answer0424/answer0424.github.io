---
layout: post
title: EC2Launch와 함께 Windows Sysprep을 사용하여 AMI 생성
date: 2026-01-14 09:00:00 +09:00
categories: [AWS, EC2, AMI, Sysprep]
tags: [aws]
image:
    path: /assets/img/aws/AWS.png
---

## 기본 개념

- EC2Launch 에이전트는 Windows Server AMI에 기본 포함된 초기화 도구
- Sysprep을 실행할 때 EC2Launch는 필요한 응답 파일 및 스크립트를 자동으로 사용함
- 이 과정은 AMI 생성 준비를 위해 Windows 인스턴스를 일반화하는 공식 방법

<hr>

## EC2Launch가 제공하는 Sysprep 구성 요소

- `unattend.xml`
  - Sysprep 동작을 제어하는 기본 응답 파일임
  - Sysprep 옵션, 로케일, 암호 정책 등이 설정됨
- `BroforeSysprep.cmd`
  - Sysprep 실행 직전에 사용자 지정 명령을 실행할 수 있는 배치 파일
- `SysprepSpecialize.cmd`
  - Sysprep의 특수화 단계 중 실행될 명령을 지정할 때 사용하는 파일

<hr>

## Sysprep 실행 절차

#### 1. Windows 인스턴스 시작

- AWS 콘솔에서 Windows Server 2016 이상 AMI를 선택하고 인스턴스를 실행

#### 2. 인스턴스 수정

- 인스턴스에 연결하여 필요한 소프트웨어 설치/설정 등을 수행함

#### 3. EC2LaunchSettings 실행

- 기본 위치: `C:\ProgramData\Amazon\EC2-Windows\Launch\Settings`

#### 4. Administrator 암호 옵션 선택

| 옵션 | 설명 |
|-|-|
| Random | EC2Launch가 랜덤 관리자 암호 생성 후 암호화하고 설정 |
| Specify | 사용자가 지정한 암호를 설정 |
| DoNothing | `unattend.xml`에서 암호를 지정하거나 관리자 계정을 비활성화 |

#### 5. Sysprep으로 종료

<hr>

## 수동/스크립트 기반 Sysprep 실행

1. `LaunchConfig.json` 파일에서 필요한 설정을 지정
    - 위치: `C:\ProgramData\Amazon\EC2-Windows\Launch\Config`
2. 필요 시 `unattend.xml` 등 구성 파일을 수정
3. PowerShell으로 다음 스크립트를 실행하여 초기화 예약

```powershell
.\InitializeInstance.ps1 -Schedule
```

4. Sysprep 실행

```powershell
.\SysprepInstance.ps1
```

- 이후 인스턴스는 로그오프되고 종료됨

<hr>

## Windows Sysprep 적용 시 주의

- Windows Sysprep은 시스템 고유 정보(예: SID, 컴퓨터이름 등)를 제거하기 때문에 이를 활용한 일반적인 백업 목적에는 적합하지 않음
- 백업을 복원하면 예상치 않은 결과가 발생할 수 있으므로 주의해야 함