---
layout: post
title: EC2Config와 함께 Windows Sysprep을 사용하여 AMI 생성
date: 2026-01-14 09:00:00 +09:00
categories: [AWS, EC2, AMI, Sysprep]
tags: [aws]
image:
    path: /assets/img/aws/AWS.png
---

## Sysprep 이란?

- Sysprep(System Preparation Tool)은 Microsoft 제공 도구로, Windows 인스턴스를 일반환 하여 **컴퓨터 이름**, **보안 식별자**, **도메인 회원 정보** 등 고유 정보를 제거함으로써 재사용 가능한 AMI 이미지를 만들기 위해 OS를 초기화함

> Sysprep은 백업 용도로 사용하면 안됨
>
> 시스템 고유 정보를 제거하기 때문에 백업 대상 인스턴스 복사본으로 복원하면 원치 않는 결과가 발생할 수 있음
{: prompt-warning }

<hr>

## EC2Config 서비스 역할

#### 1. Sysprep 실행 트리거

- EC2 서비스 속성에서 Sysprep을 이용해서 종료를 선택하면 EC2Config는 다음 명령으로 Sysprep을 호출함

```bash
ec2config.exe -sysprep
```

<br>

#### 2. 설정 파일 로드

- EC2Config는 `BundleConfig.xml` 설정을 로드함
- 이 파일의 설정 
  - AutoSysprep: Sysprep 자동 실행 여부
  - SetRDPCertificate: 자체 서명 RDP 인증서 설정 여부
  - SetPasswordAfterSysprep: Sysprep 후 무작위 관리자 암호 생성 여부
  - PreSysprepRunCmd: Sysprep 직전 실행할 커맨드 스크립트 경로

<br>

#### 3. RDP 비활성화

- `BeforeSysprep.cmd` 스크립트가 실행되어 Sysprep 중 RDP 연결을 비활성화함

<br>

#### 4. Sysprep 호출

```bash
sysprep.exe /unattend:"C:\Program Files\Amazon\Ec2ConfigService\sysprep2008.xml" /oobe /generalize /shutdown
```


