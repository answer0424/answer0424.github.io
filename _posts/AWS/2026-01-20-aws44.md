---
layout: post
title: AMI 저장 및 복원 작동 방식
date: 2026-01-20 09:00:00 +09:00
categories: [AWS, EC2, AMI, copy]
tags: [aws]
image:
    path: /assets/img/aws/AWS.png
---

## 관련 API

| API | 역할 |
|-|-|
| CreateStoreImageTask | AMI와 해당 EBS 스냅샷을 S3 객체로 저장 |
| DescribeStoreImageTasks | 저장 작업의 진행 상태 확인 |
| CreateRestoreImageTask | S3 객체에서 AMI를 복원 |

<hr>

## 1. CreateStoreImageTask - AMI 저장

#### 저장 방식

- 지정한 AMI의 모든 구성 요소를 읽고, AWS는 S3 멀티파트 업로드를 사용해 AMI를 단일 S3 객체로 저장
- 저장 과정에서 일부 데이터는 압축되어 원본 스냅샷 크기보다 작은 객체로 저장될 수 있음

<br>

#### S3 객체 메타데이터

- AMI의 이름, 설명, 등록 날짜, 소유자 계정, 저장 작업 타임스탬프 등이 S3 객체의 메타데이터 태그로 포함됨
- AMI와 동일한 ID가 객체 이름에 사용되고 `.bin` 확장자가 붙음

<br>

#### 태그 및 제한

- AMI와 스냅샷에 태그가 있으면 저장된 객체에도 태그가 보존됨
- 진행 중인 모든 AMI 저장 작업의 스냅샷 데이터 총합은 계정당 1,200GB로 제한

<hr>

## 2. DescribeStoreImageTasks - 진행 상태 확인

- 저장하거나 복원 중인 task의 상태(`Inprogress`, `Completed`, `Failed`)를 확인할 수 있음
- AMI ID를 지정하면 그 AMI의 저장 작업만, 지정하지 않으면 최근 31일간의 모든 태스크를 나열함
- `InProgress` task의 경우 진행률도 응답에 표시됨

<hr>

## 3. CreateRestoreImageTask - AMI 복원

#### 복원 동작

- S3에 저장되어 있는 AMI 객체에서 복원 작업을 시작함
- 복원할 때는 대상 리전 내의 S3 버킷을 지정해야 함

<br>

#### 복원 결과

- 복원된 AMI는 새 AMI ID로 등록됨
- 원본 AMI의 메타데이터가 거의 모두 복원된 AMI에 반영됨
- 이름을 지정하지 않으면 원본 AMI 이름과 동일하게 설정됨

<HR>