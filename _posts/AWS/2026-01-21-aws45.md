---
layout: post
title: S3를 사용하여 AMI 저장 및 복원 작업
date: 2026-01-21 09:00:00 +09:00
categories: [AWS, EC2, AMI, save & restore]
tags: [aws]
image:
    path: /assets/img/aws/AWS.png
---

## 개요

> AWS에서는 EBS-backed AMI를 Amazon S3에 저장하고 이 저장된 S3 객체를 기반으로 새 AMI로 복원할 수 있음
>
> 이 흐름은 단순한 AMI 복사와는 다르며, 대규모 아카이브나 AWS 파티션/리전 간 이동 등에 사용됨

<hr>

## AMI 저장/복원 시 보안 권장 사항

- S3 버킷 권한 제한
  - 퍼블릭 액세스가 허용되지 않도록 설정해야 함
- S3 서버 측 암호화
  - 권장 - 저장된 AMI 객체도 암호화하여 보안 강화
- TLS 전송 보호
  - AMI 저장 시 데이터는 TLS 연결로 전송됨

<hr>

## 저장 및 복원 권한

- 저장 대상 S3 버킷의 객체를 생성/읽을 수 있는 권한
- AMI 및 관련 스냅샷 접근 권한
- KMS 키 사요 권한


> 복원 또한 동일하게 권한이 필요

<hr>

## 이미지 저장 태스크 생성 (CreateStoreImageTask)

- API/CLI/SDK를 통해 `CreateStoreImageTask` 호출
- S3 버킷에 단일 객체 형식으로 저장
- AMI 스냅샷과 메타데이터가 하나의 `.bin` 객체로 병합되어 저장
- 저장 완료까지 진행률을 모니터링 가능

<hr>

## S3 버킷 파일 경로 활용

```bash
s3://bucket-name/path1/path2
```

- 저장 객체 키:
  
```bash
path1/path2/ami-xxxxxxxxxxxxx.bin
```

---

## 저장/복원 작업 한도

AMI 저장/복원 작업은 진행중인 데이터 크기 기준 한도가 존재함

- ✔ **진행 중인 저장 작업 한도**: 최대 **1,200 GB**(스냅샷 데이터 총합)  
- ✔ **진행 중인 복원 작업 한도**: 최대 **600 GB**(스냅샷 데이터 총합)

<hr>

## 사용 사례

- AWS 파티션 간 AMI 이동
  - 예: 기본 상용 파티션 ➡️ GovCloud 같은 다른 파티션으로 이동 가능
- 아카이브 형태로 AMI 백업 보관
  - 저장된 AMI 객체를 장기 보관용으로 활용
- 리전 간 AMI 이동
  - 저장 ➡️ 다른 리전 S3로 객체를 복사 ➡️ 복원 흐름으로 이동 가능

<hr>

## 요약

| 항목 | 내용 |
|-|-|
| 저장 API | `CreateStoreImageTask` -  AMI를 S3로 저장 |
| 진행 상태 확인 | `DescribeStoreImageTasks` - 저장/복원 작업 상태 조회 |
| 복원 API | `CreateRestoreImageTask` - S3에서 AMI 복원 |
| 보안 | S3 퍼블릭 액세스 차단 + 서버 측 암호화 권장 + KMS 권한 |
| 한도 | 저장 1,200GB / 복원 600GB (진행 중인 작업 기준) |
| 사용 사례 | 파티션 간/리전 간 AMI 이동, 아카이브 백업 |