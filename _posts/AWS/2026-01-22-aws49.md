---
layout: post
title: 지정된 AMI를 참조하는 리소스 식별
date: 2026-01-22 09:00:00 +09:00
categories: [AWS, EC2, AMI, Using view]
tags: [aws]
image:
    path: /assets/img/aws/AWS.png
---

## 목적

- AMI를 더 이상 안전하게 삭제할 수 있는지 판단
- 리소스가 최신 AMI를 사용하고 있는지 규정 준수 확인
- AMI 기반 리소스 현황 파악

---

## 지원되는 리소스 유형

| 리소스 유형 | 설명 |
|-|-|
| EC2 인스턴스 | 인스턴스의 이미지 ID로 AMI 참조 |
| 시작 템플릿(Launch Template) | 템플릿에서 AMI ID로 참조 |
| SSM 파라미터 | System Manager Parameter Store에서 AMI ID로 참조 |
| Image Builder 이미지 레시피 | EC2 Image Builder 이미지 레시피에서 참조 |
| Image Builder 컨테이너 레시피 | 컨테이너 레시피에서 AMI 참조 |


---

## 작동 방식 

#### 기본 흐름

1. 확인할 AMI ID 지정
2. 스캔할 리소스 유형 선택
   - 특정 유형만 지정 가능
   - 모두 스캔하려면 전체 옵션 사용
3. 지정 AMI를 참조하는 리소스 목록 반화

---

## 콘솔에서 확인

1. AWS Management Console에서 EC2 서비스로 이동
2. 왼쪽에서 AMI 선택
3. 하나 이상 AMI 선택 후 작업 ➡️ AMI 사용 ➡️ 참조된 리소스 보기 선택
4. 해당 AMI를 참조하는 리소스 목록을 확인할 수 있음

---

## CLI에서 확인

```bash
aws ec2 describe-image-references \
    --image-ids ami-0abcdef1234567890 ami-1234567890abcdef0 \
    --resource-types \
        'ResourceType=ec2:Instance,ResourceTypeOptions=[{OptionName=state-name,OptionValues=[running,pending]}]' \
        'ResourceType=ec2:LaunchTemplate,ResourceTypeOptions=[{OptionName=version-depth,OptionValues=[20]}]' \
        'ResourceType=ssm:Parameter' \
        'ResourceType=imagebuilder:ImageRecipe' \
        'ResourceType=imagebuilder:ContainerRecipe'
```

- `ResourceTypeOptions`는 리소스별 옵션을 지정할 수 있는 파라미터임

#### 모든 리소스 유형에 대해 확인


```bash
aws ec2 describe-image-references \
    --image-ids ami-0abcdef1234567890 ami-1234567890abcdef0 \
    --include-all-resource-types
```

- 모든 지원 리소스 유형을 함께 스캔하여 AMI 참조를 확인할 수 있음

---

## IAM 권한 필요 조건

- `ec2:DescribeImageReferences`
- `ec2:DescribeInstances`
- `ec2:DescribeLaunchTemplates`
- `ec2:DescribeLaunchTemplateVersions`
- `ssm:DescribeParameters`
- `ssm:GetParameter`
- `imagebuilder:ListImageRecipes`
- `imagebuilder:ListContainerRecipes`
- `imagebuilder:GetContainerRecipe`

---

## 출력 정보

| 필드 | 설명 |
|-|-|
| ImageId | 지정한 AMI ID |
| ResourceType | AMI를 참조하는 리소스 유형 |
| Arn | 참조한 리소스의 ARN 또는 ID |

---

