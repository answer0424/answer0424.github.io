---
layout: post
title: 새 EC2 인스턴스를 시작하여 새 인스턴스 유형으로 마이그레이션
date: 2026-02-06 09:00:00 +09:00
categories: [AWS, EC2, Instance]
tags: [aws]
image:
    path: /assets/img/aws/AWS.png
---

## 핵심 요약

- 일부 EC2 인스턴스는 Stop 후 인스턴스 유형 변경이 불가능
- 이 경우 AMI + 새 인스턴스 생성 방식으로 마이그레이션
- 인스턴스 저장소 데이터는 자동 이전되지 않음
- EBS 스냅샷, 볼륨 연결, Elastic IP 재연결이 핵심 작업
- 콘솔과 CLI 모두 지원

---

## 마이그레이션이 필요한 경우

- 인스턴스 저장소 기반 인스턴스
- 기존 AMI가 대상 인스턴스 유형의 아키텍처를 지원하지 않음
- 이전 세대 인스턴스 ➡️ 최신 세대 인스턴스로 변경
- 가상화 타입(HVM/PV) 불일치

---

## 전체 흐름

1. 원본 인스턴스 데이터 백업
2. 대상 AMI 선택
3. 새 인스턴스 생성
4. EBS 볼륨 복원 또는 재연결
5. 애플리케이션 설정 복구
6. Elastic IP 재연결
7. 원본 인스턴스 종료

---

## 단계별 상세 절차

#### 데이터 백업

- EBS 볼륨: 스냅샷 생성
- 인스턴스 저장소: 직접 파일 복사 필요

CLI 예시

```bash
aws ec2 create-snapshot
    --volume-id vol-xxxx
    --description "before-migration"
```

주의사항

- 인스턴스 저장소 데이터는 스냅샷 불가
- 반드시 서비스 데이터 사전 백업 필요

---

## 새 인스턴스 생성

- AMI가 대상 인스턴스 유형의 아키텍처 지원 여부
- HVM 지원 여부
- 동일 VPC/Subnet/Security Group 권장

콘솔 절차

1. EC2 ➡️ 인스턴스 시작
2. AMI 선택
3. 인스턴스 유형 선택
4. 네트워크 및 보안 그룹 설정
5. 키 페어 지정 후 시작

CLI 예시

```bash
aws ec2 run-instances
    --image-id ami-xxxx
    --instance-type t3.medium
    --subnet-id subnet-xxxx
    --security-group-ids sg-xxxx
    --key-name my-key
```

---

## EBS 볼륨 복원 또는 연결

#### 방법1: 기존 볼륨 분리 후 연결

- 원본 인스턴스에서 볼륨 분리
- 새 인스턴스에 동일 볼륨 연결

```bash
aws ec2 attach-volume
    --volume-id vol-xxxx
    --instance-id i-xxxx
    --device /dev/sdf
```

---

#### 방법 2: 스냅샷에서 새 볼륨 생성

- 스냅샷 기반으로 새 볼륨 생성
- 새 인스턴스에 연결

```bash
aws ec2 create-volume
    --snapshot-id snap-xxxx
    --availability-zone ap-northeast-2a
```

---

## 애플리케이션 및 설정 복원

- OS 패키지 재설치
- 애플리케이션 설정 파일 복구
- 서비스 정상 기동 여부 확인

주의사항

- IP 변경, 네트워크 정책 변경에 따른 설정 영향 확인 필요

---

## Elastic IP 재연결

> 고정 IP를 사용하는 경우 필수 작업

- 콘솔

1. Elastic IP 선택
2. 기존 인스턴스 연결 해제
3. 새 인스턴스에 연결

```bash
aws ec2 disassociate-address
    --association-id eipassoc-xxxx

aws ec2 associate-address
    --instance-id i-xxxx
    --allocation-id eipalloc-xxxx
```

---

## 원본 인스턴스 종료

- 새 인스턴스 정상 동작 확인 후 종료
- 문제 발생 대비 일정 기간 유지 권장

---

## 콘솔 vs CLI 비교

| 작업 | 콘솔 | CLI |
|------|------|-----|
| 스냅샷 생성 | UI 클릭 | create-snapshot |
| 인스턴스 생성 | Launch Wizard | run-instances |
| 볼륨 연결 | Attach Volume | attach-volume |
| EIP 연결 | Associate | associate-address | 

---

## 주의사항 정리

- 인스턴스 저장소 데이터는 자동 이전되지 않음
- AMI 아키텍처 호환성 반드시 확인
- 서비스 중단 시간 사전 계산 필요
- 운영 환경은 사전 테스트 권장