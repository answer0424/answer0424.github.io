---
layout: post
title: 알림톡
date: 2025-04-11 09:26 +09:00
categories: [cbcp, week02]
tags: [cbcp]
---

## 알림톡

> 기업 고객이 자사의 카카오톡 채널을 통해 카카오톡 이용자에게 메시지를 발송할 수 있는 상품

#### 적용 프로세스

- 카카오톡 채널 개설
- 비즈니스 채널 신청
- 카카오와 파트너 계약이 되어 있는 공식 딜러사 선택 및 가입 (비즈톡)
- 딜러사 콘솔에서 계정 인증 및 발신번호 입력
- 딜러사 콘솔에서 카카오 채널 연돌
- 딜러사 콘솔에서 알림톡 생성 및 검수
- 딜러사 콘솔에서 검수된 알림톡 템플릿으로 알림톡 전송
- 콘솔에서 api ket, secret key 생성 후 환경 변수 파일에 등록
- sdk 설치
- api 개발문서에서 요구하는 매개변수와 함께 알림톡 전송

#### 항목
- 채널
- 템플릿코드
- 템플릿명
- 메시지 유형
- 템플릿 내용
- 강조 유형
- 버튼 정보
- 검수 상태
- 휴면 상태 

<br>

## 메서드 시그니처

| 시그니처 | 설명 |
|-|-|
| chnlDvCd | 채널 구분 코드 |
| tmplCd | 템플릿 코드 |
| msg | 메시지 내용 |
| apxCttList | 첨부 내용 (버튼 등) |
| mbphNo | 수신자 핸드폰 번호 |
| msgType | 메시지 타입 |
| bizMgntNo | 업무 관리 번호 |
| smsRprcsUseYn | SMS 재처리 여부 (Y/N)

<br>

## 리턴값 : nRslt

- `1` : 성공
- `-1` : 실패

<br>

## 주요 흐름

<br>

##### 1단계. 비즈톡 발송 이력 등록

- 채널, 템플릿, 수신자, 메시지 등 주요 정보를 이력 테이블에 저장
- 이때 DB 해당 발송의 고유번호를 저장하게 됨


<br>

#### 2단계. msgldx 생성 및 저장

- `msgldx`는 비즈톡 API에서 발송 결과 확인을 위한 고유 메시지 ID
- 중복을 방지하기 위한 방법을 통해 저장해야 함

<br>

#### 3단계. 발송 객체 구성

- 발신자 키는 채널 코드에 따라 다르게 설정
- 버튼 첨부는 리스트에서 가려와 JSON 형태로 세팅
- 이미지 메시지인 경우 `messageTpye`도 세팅

<br>

#### 4단계. 문자(SMS) 재처리 로직

- 알림톡 실패 시를 대비해 동일 내용을 문자(MMS)로 대체 전송할 수 있게 준비
- 버튼에 있는 URL도 메시지에 추가됨

#### 5단계. 비즈톡 API 호출

- 토큰 발급 ➡️ 발송 요청
- 응답이 `"OK"`이면 성공, 아니면 실패 로그를 남김

#### 6단계. 발송 결과 DB에 반영

- `01` : 성공
- `02` : 실패

