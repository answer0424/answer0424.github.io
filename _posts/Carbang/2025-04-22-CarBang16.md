---
layout: post
title: moca (dateLib)
date: 2025-04-22 16:32 +09:00
categoties: [carbang, week04]
tags: [carbang]
---

## Moca

> 웹 애플리케이션에서 공통적으로 사용되는 기능들을 모아놓은 전역 유틸리티 객 생성자 함수

- 전역 공통 변수 및 초기값 설정
- 날짜 포맷 처리 유틸
- 이벤트 바인딩
- 컬럼 리사이징 로직 초함
- 드롭다운 메뉴나 필터창 등을 닫기 위한 처리

➡️ 페이지 공통 기능을 처리하기 위한 싱글턴 유틸리티 객체를 생성하는 초기화 함수

<br>

## dateLib.getDate

> 현재 날짜와 시간을 "YYYYMMDDHH24MISS" 형식의 문자열로 반환하는 유틸 함수

- 현재 날짜 객체 생성
- 각 구성요소 추출
- 각 값들을 2자리로 보정
- 문자열 조합 후 반환

➡️ 현재 시간을 기준으로 "년월일시분초" 형태의 문자열로 반환


<br>

## dateLib.makeDateFormat

> 다양한 형식의 날짜 문자열을 `yyyy/mm/dd` 형식으로 변환

- `.` 또는 `-` 기준으로 분리
- 각 날짜 부분을 추출하고 월과 일이 10보다 작은 경우 0을 붙임
- flag 파라미터 -> 구분자

➡️ 다양한 형식으로 주어진 날짜 문자열을 일관된 `yyyy/mm/dd` 형식으로 변환

<br>

## dateLib.addDay

> 주어진 날짜에 특정 일수를 더한 후 새로운 날짜를 `yyyymmdd` 형식으로 반환

- 연도, 월, 일 추출
- offset 값을 더해서 새로운 날짜를 계산
- 계산된 날짜에서 연도, 월, 일을 다시 추출하여 두 자릿수 형식으로 만듦

➡️ 주어진 날짜에 일수를 더하거나 빼서 새로운 날짜를 계산하고 그 결과를 특정 날짜 형식으로 반환

<br>

## dateLib.addToDay

> 현재 날짜에 특정 일수를 더한 후 `yyyy/mm/dd` 형식으로 반환

- arg가 비어있을 경우 기본값 0 
- 현재 날짜를 가져와 arg만끔 날짜를 더함
- 계산된 날짜에서 연도, 월, 일을 추출하여 `yyyy/mm/dd` 형식으로 만듦

➡️ 현재 날짜에 주어진 일수를 더하거나 빼서 그 결과를 특정 날짜 형식으로 반환

<br>

## dateLib.addMonth

> 주어진 연도에 특정 월을 더한 후 `yyyy/mm/dd` 형식으로 반환

- 각 매개변수의 값을 받아 해당 날짜를 설정
- 매개별수로 받은 월 수 만큼 월을 더하거나 뺌
- 계산된 날짜에서 연도, 월, 일을 추출하여 `yyyy/mm/dd` 형식으로 만듦

➡️ 특정 날짜에 주어진 월수를 더하거나 빼서 그 결과를 특정 날짜 형식으로 반환

<br>

## dateLib.calcToday

> 현재 날짜를 기준으로 연, 월, 일 단위로 날짜를 더하거나 빼서 `yyyymmdd` 형식으로 반환

- year, month, day 값이 비어있을 경우 0으로 설정
- 현재 날짜에서 매개변수를 더하거나 뺌
- 계산된 날짜의 연도, 월, 일을 각각 추출하여 `yyyymmdd` 형식으로 조합

➡️ 오늘 날짜를 기준으로 연, 월, 일을 조정하여 새로운 날짜를 구하고 그 날짜를 특정 형식으로 반환

<br>

## dateLib.compareDate

> 두 날짜 문자열을 비교하여 어느 날짜가 더 빠른지를 판단

- 매개변수로 받는 두 날짜가 빈 문자열이 아닐 경우만 비교
- `fromDate`가 `toDate`보다 크면 0을 반환
- 그렇지 않으면 1 반환
- 둘 중 하나라도 값이 비어있으면 9 반환

➡️ 두 날짜를 비교하여 0 또는 1 또는 9를 반환하는 비교용 함수

<br>

## dateLib.miunsDate

> 두 날짜 사이의 일 수 차이를 계산하여 반환

- 각각의 문자열을 연, 월, 일로 나눈 후 Date 객체로 반환
- 두 날짜 객체를 빼서 밀리초 단위 차이를 구함
- 이를 일 수 차리로 변환

➡️ 두 날짜 사이의 일 수 차리를 정수로 반환

<br>

## dateLib.getMonthTerm

> 두 월 사이의 기간을 개월 수로 반환 매개변수는 `yyyymm` 형식

- 처음 오는 매개변수가 뒤에 오는 매개변수보다 작거나 같을 경우만 동작
- 두 날짜의 연도 차이와 월 차이를 구함
- 연도 차이에서 12를 곱하고 월 차이에서 1을 더해서 월 차이를 계산

➡️ 시작월과 종료월 사이의 전체 개월 수를 구하는 함수

<br>

## dateLib.getQuarterTerm

> 시작 분기와 종료 분기 사이의 전체 분기 수를 계산하여 반환 매개변수는 `yyyyQ` 형식

- 처음 오는 매개변수가 뒤에 오는 매개변수보다 작거나 같을 경우만 동작
- 연도 차이와 분기 차이를 구함
- 전체 분기 수 = 연도차이에 4를 곱하고 분기차이에 1을 더해서 구함
- 계산된 분기 수를 반환
- 시작 분기가 종료 분기보다 이후면 0을 반환

➡️ 두 분기 사이의 전체 분기 수를 계산하는 유틸 함수

<br>

## dateLib.isDate

> 입력된 문자열이 유효한 날짜 형식인지 검사하는 함수

- 구분자를 제거해서 `YYYYMMDD` 형식으로 변환
- 문자열 길이가 8이 아닌 경우 false 반환
- 각 문자가 숫자인지 확인하고 데이터 추출
- 월 별로 허용 일수를 비교하여 검사

➡️ 문자열로 입력된 날짜가 실제로 존재 가능한 날짜인지 검증하는 유틸 함수

<br>

## dateLib.getQuarter

> 해당 월이 속함 분기를 문자열로 반환

- 입력 값을 정수형으로 반환
- 해당 값이 어떤 분기에 속하는지 if-else로 판단
- 범위를 벗어나면 빈 문자열 반환

➡️ 입력된 월 숫자에 따라 해당하는 분기 번호를 리턴하는 분기 계산 함수

<br>

## dateLib.getToday

> 오늘 날짜를 매개변수가 주어진 구분자가 포함된 형식의 문자열로 반환

- 현재 날짜를 구함
- 10보다 작을 경우 0을 붙여 두자리로 만듦
- 구분자가 존재할 경우 구분자를 포함하여 반환
- 없으면 `YYYYMMDD` 형식으로 반환

➡️ 오늘 날짜를 원하는 구분자 형식 또는 기본 형식으로 문자열로 리턴

<br>

## dateLib.addDayFormat

> 주어진 날짜에서 `offset`만큼 날짜를 더한 뒤 구분자를 포함해 특정 날짜 형식으로 반환

- 매개변수에서 연도, 월, 일을 추출
- 월은 `-1`처리 후 두 자리 형식으로 맞춤
- `offset` 만큼 날짜를 더함
- 결과 날짜는 특정 날짜 형식으로 반환

➡️ 주어진 날짜에서 지정한 마큼 날짜를 더한 경과를 원하는 구분자 형식으로 리턴

<br>

## dateLib.getWeekTerm

> 특정 날짜가 속한 주의 시작일 또는 종료일을 반환

- 매개변수를 `Date` 객체로 반환
- `.getDay()`를 통해 요일을 구함
- 두번째 매개변수가 `true`이면 해당 요일만큼 날짜를 뒤로 이동하여 일요일 계산
- 두번째 매개변수가 `false`이면 `6-요일`만큼 날짜를 앞으로 이동하여 토요일 계산

➡️ 특정 날짜가 속한 주의 일요일 또는 토요일 날짜를 구해서 특정 날짜 형식으로 리턴

<br>

## dateLib.getFirstDayOfMonth

> 주어진 날짜가 속한 월의 첫째 날을 구해 특정 날짜 형식으로 반환

- 입력받은 문자열 매개변수에서 연과 월을 분리
- 월이 한 자리 숫자일 경우 `0`을 붙여 두 자리로 만듦
- 날짜는 무조건 `01`로 설정
- 연동 + 월 + 01 을 붙여 반환

➡️ 특정 날짜가 속한 월의 첫날을 반환

<br>

## dateLib.getLastDayOfMonth

> 주어진 날짜가 속한 월의 마지막 날을 구해 특정 날짜 형식으로 반환

- 입력받은 문자열에서 연과 월을 분리
- 다음 달의 0일, 즉 전달의 마지막 날을 생성
- 월이 한 자리 숫자일 경우 `0`을 붙여 두자리로 만듦

➡️ 특정 날짜가 속한 월의 마지막 날을 특정 날짜 형식으로 반환

<br>

## dateLib.getQuarterTerm

> 입력된 날짜가 속한 분기의 시작일과 종료일을 `termObj` 객체로 반환

- 매개변수에서 연도와 월을 분리
- 월에 따라 해당 분기를 판별
- 위 함수들을 사용해 시작일과 종료일을 계산
- `termObj`에 담아 반환

➡️ 특정 날짜가 속한 분기의 시작일과 종료일을 객체로 반환

<br>

## dateLib.getFirstDayOfYear

> 입력한 날짜에 해당하는 연도의 처음 날짜를 반환

- 매개변수에서 연도만 분리
- 0101을 추가해서 해당 연도의 처음 날짜를 반환

<br>

## dateLib.getLastDayOfYear

> 입력한 날짜에 해당하는 연도의 마지막 날짜를 반환

- 매개변수에서 연도만 분리
- 1231을 추가해서 해당 연도의 마지막 날짜를 반환

<br>

## dateLib.getYears

> 캘린더에서 사용할 연도 리스트를 동적으로 구성하여 세션 스토리지에 저장하고 재사용

- `sessionStorage`에 `g_years_dataList` 값이 없을 경우에만 실행
- 매개변수를 이용해 컴포넌트를 가져옴 (`WebSquare.util.getComponentById`)
- `minYear`과 `maxYear`을 가져오고 특정 방식으로 오프셋 조정
- 조정된 연도 범위를 기반으로 반복문을 돌며 데이터 삽입
- 결과를 JSON 문자열로 저장
- 해당 `sessionStorage` 값을 반환

➡️ WebSquare 캘린더 컴포넌트용 연도 목록을 구성해서 세션 스토리지에 저장하고 필요 시 재사용

<br>

## dateLib.getDay

> 요일 번호를 받아 요일의 한글 이름 또는 영문 약어를 반환

- 첫 번째 매개변수가 0부터 6까지인지 확인
- 두번째 매개변수가 요구하는 언어가 한글인지 영어인지 확인
- 언어 코드가 없거나 인식할 수 없을 경우 첫 번째 매개변수로 받은 숫자 자체를 반환
- 0~6이 아니여도 숫자 자체를 반환

➡️ 요일 숫자(0~6)을 한글 또는 영문 요일 명으로 반환하는 함수

<br>

## dateLib.getSysDate

> 서버에서 시스템 날짜를 동기 방식으로 가져오는 함수

- `$.ajax`를 통해 `POST` 방식으로 서버에 요청
- 요청 주소
- 비동기 비활성화
- 서버가 JSON 형식으로 데이터를 응답
- 응답에서 `today` 값을 `obj`에 담아 리턴

➡️ 서버에서 현재 날짜를 받아와 문자열로 반환하는 함수

<br>

## dateLib.dateTimeFormat

> `연도-월-일 시:분:초`로 포맷팅 해주는 함수

<br>

## dateLib.getLeftTime

> 현재 시각과 `_deadLine` 사이에 남은 시간을 계산하여 포맷 문자열로 반환

- 현재 시각을 밀리초 단위로 구함
- `leftTime`: 현재시간을 빼서 밀리초 단위로 구함
- `leftTime`이 1 미만이면 TIMEOUT 반환
- 아니면 일, 시, 분, 초를 계산하여 문자열로 조합

➡️ 현재 시각 기준으로 특정 막마 시간까지 남은 시간을 계산해서 포맷된 문자열로 반환