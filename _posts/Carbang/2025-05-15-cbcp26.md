---
layout: post
title: 차량 정보 조회, 차량 저당 말소 요청
date: 2025-05-15  09:00 +09:00
categoties: [cbcp, week07]
tags: [cbcp]
---

## 차량 정보 조회 프로세스

- 조회 결과에 따른 응답 코드를 저장할 변수 선언
- 1. 조건문 (`RESULT_CD`에 정상 응답 코드가 들어오지 않은 경우)
  - 즉, 차량을 신규 등록하였거나, 차량 번호 변경 시청 후 3일이 경과하지 않은 경우, 차량 번호가 바뀐 경우, 차량 번호 및 차대 번호를 잘못 알고 있는 경우, 입력 오류인 경우
  - 1-1. 조건문
    - 차량번호 포맷이 아니라면
    - 차량 번호 없음 return
    - 차량번호 포맷이라면 
    - 조회 오류 return
- 2. 조건문 (자동차 용도 변경 이력이 있는지)
  - `RENT_CAR_HISTORY`의 값이 `"없음"`이면 `N`을 저장
  - `RENT_CAR_HISTORY`의 값이 `"있음"`이면 `Y`을 저장
- 3. 조건문 (영업용도 사용 이력이 있는지)
  - `BUSINESS_HISTORY`의 값이 `"없음"`이면 `N`을 저장
  - `BUSINESS_HISTORY`의 값이 `"있음"`이면 `Y`을 저장
- 4. 조건문 (관용 용도 사용 이력이 있는지)
  - `COMMON_USE_HISTORY`의 값이 `"없음"`이면 `N`을 저장
  - `COMMON_USE_HISTORY`의 값이 `"있음"`이면 `Y`을 저장
- 5. 자동차 번호 변경 횟수(`CAR_NUM_CHANGE_COUNT`), 소유자 변경 횟수(`OWNER_CHANGE_COUNT`), 자동차 보험 특수 사고 이력-전손(`TOTAL_LOSS_HISTORY`), 자동차 보험 특수 사고 이력-도난(`ROBBERY_HISTORY`) 저장
- 6. 조건문 (자동차 보험 특수 사고이력-침수(전손, 분손) key값이 있는지)
  - 있다면 `FLOODING_TOTAL_LOSS_HISTORY`의 값을 찾아서 저장
  - 있다면 `FLOODING_PARTIAL_LOSS_HISTORY`의 값을 찾아서 저장
- 7. 조건문 (보험 사고 이력: 내차피해)
  - `MY_CAR_DAMAGE_HISTORY`의 값을 변수에 저장
  - 7-1. 조건문 (값이 없음이 아닐 경우)
    - 7-1-1. 조건문 (`회`라는 단어가 포함되어 있는 경우)
      - 회를 기준으로 문자열을 나눔 (1회 250만원)
      - 7-1-1-1. 조건문 (글자만 있는 경우 미확정 여부 있는지 확인하고 사고 횟수만 저장)
      - ex) 1회 미확정
      - 7-1-1-2. 조건문 (숫자가 포함되어 있는 경우 (정상))
      - 회를 기준으로 나눈 문자열을 각각 `내차피해사고횟수`와 `내차피해합계금액`에 저장
  - 7-2. 조건문 (값이 없음일 경우)
    - `내차피해사고횟수`와 `내차피해합계금액`에 0을 저장
- 8. 조건문 (보험 사고 이력: 타차피해)
  - `OTHER_CAR_DAMAGE_HISTORY`의 값을 변수에 저장
  - 조건문 7번과 동일한 프로세스 진행
- 제작사(`MANUFATURER`), 자동차명(`CAR_NAME`), 연식(`CAR_TYPE`), 사용연료(`FUEL`) 저장
- 9. 조건문 (`ENGINE_DISPLACEMENT` key값이 있는지)
  - 9-1. 조건문 (빈 값이 아니라면)
    - 배기량의 숫자만 저장
- 차제형상(`CAR_BODY`) 저장
- 10. 조건문 (자동차 모델(`CAR_MODEL`) key값이 있는지)
  - 공백 제거 후 문자열 분리
  - 10-1. 조건문 (차종구분명이 빈값이 아니라면)
  - 10-2. 조건문 (사용용도명이 빈값이 아니라면)
- 보험 미가입 기간(`UNDERACARRIAGE_DATE`) 저장
- 11. 조건문 (보험 미가입 기간이 없다면)
  - 0을 저장
  - 있다면 `,` 단위로 분리하여 저장
- 최초 보험 가입일자(`FIRST_CAR_INSURANCE_DATE`) 저장
- 12. 조건문 (내차 보험 처리 이력(`TOTAL_COUNT`)이 있는지)
  - `RESP_DATA`의 값을 리스트에 저장
  - for문을 통해 리스트에서 받아온 값을 가공
  - 사고 구분 코드 1로 고정, 사고일자, 보험금
  - 12-1. 조건문 (보험료 처리(`MY_INSURANCE_BENEFIT`)가 숫자로만 이루어져 있는지)
  - 12-2. 조건문 (수리 비용 관련)
    - 12-2-1. 조건문 (수리비용(`MY_REPAIR_COST`)의 값에 따라)
    - `미확정`인 경우 미확정 보험금 칸에 저장
    - `최초수리비용`인 경우 보험금 저장 안함
    - `일반 숫자 형태`인 경우 수리비 저장
- 13. 조건문 (타차 보험 처리 이력(`TOTLE_COUNT2`)이 있는지)
  - 조건문 12와 동일한 프로세스
- 14. 조건문 (타차 가해 이력 (`TOTLE_COUNT3`)이 있는지)
  - 조건문 12와 동일한 프로세스
- 15. 조건문 (주행거리 이력(`TOTLE_COUNT4`)이 있는지)
  - `RESP_DATA4`의 값을 리스트에 저장
  - for문을 통해 주행거리 이력에 대한 정보를 저장
- 16. 조건문 (소유자변경, 최초등록, 차량번호 변경 이력이 있는지)
  - `RESP_DATA5`의 값의 리스트에 저장
  - 받은 리스트를 조건문을 통해 데이터 가공
  - 16-1. 조건문 (`MY_CHANGE_CHANGE_NAME`의 값이 소유자 변경 이력인지)
    - 존재한다면 `04`라는 값을 저장하고 `MY_CHANGE_CHANGE_DATE`의 값도 저장
    - 16-1-1. 조건문 (차량 사용 용도 변경 이력(`MY_CHANGE_CAR_USES`)이 있는지)
      - 16-1-1-1. 조건문 (차종구분명이 빈값이 아니라면)
      - 16-1-1-2. 조건문 (사용용도명이 빈값이 아니라면)
  - 16-2. 조건문 (`MY_CHANGE_CHANGE_NAME`의 값이 최초등록인지)
    - 최초등록일(`MY_CHANGE_CHANGE_DATE`)와 차량번호(`MY_CHANGE_CAR_NUMBER`) 저장
    - 16-2-1. 조건문 (차량 사용 용도 변경 이력(`MY_CHANGE_CAR_USES`)이 있는지)
      - 16-2-1-1. 조건문 (차종구분명이 빈값이 아니라면)
      - 16-2-1-2. 조건문 (사용용도명이 빈값이 아니라면)
  - 16-3. 조건문 (`MY_CHANGE_CHANGE_NAME`의 값이 번호 변경인지)\
    - 16-3-1. 조건문 (차량 사용 용도 변경 이력(`MY_CHANGE_CAR_USES`)이 있는지)
      - 16-3-1-1. 조건문 (차종구분명이 빈값이 아니라면)
      - 16-3-1-2. 조건문 (사용용도명이 빈값이 아니라면)
- 오류가 발생한다면 9999코드 저장

<br>

## 차량 저당 말소 요청 처리 프로세스

<br>

#### 기능

- 소유자 정보 확인
- 등록원부 및 제한사항 조회
- 소유자명 일치 여부 판단 및 업데이트
- 말소 처리 흐름 제어(진행/중단)
- 말소 비용 처리 및 상태 업데이트