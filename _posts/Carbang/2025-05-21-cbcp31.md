---
layout: post
title: VES Thread (4)
date: 2025-05-21  09:00 +09:00
categoties: [cbcp, week08]
tags: [cbcp]
---

## VESSuProcThread

> 설정 처리 Thread

<br>

#### run()

- `procMedYn` 컬럼을 `Y`로 변경 (현재 스레드가 작업을 처리하고 있다는 뜻)
- 진행상태별 처리 수행(접수상태)
  - `strHypcStgupReg()` 호출
- 진행상태별 처리 수행(등록진행 중 상태)
  - 관공서 등록요청의 경우
    - IDC에서 과세 결과 확인 후 과게 완료되면 통지 전문 전송 (`VESController.updatreVesSvcRslt()`)
  - 관공서 등록요청대기(익일 예정)
    - 현재 시간이 운영단에 입력한 요청 가능한 시간임을 확인(`selectRqstTmYn`)
    - 등록 요청 가능 시간일 경우
      - 저당 설정 요청 정보 조회(`selectHypcStgupRqstInfo`)
      - 저당 설정 요청 (`rqstStgupReg()`) 호출
      - 관공서 등록 요청 이거나 관공서 등록 예정일 경우 ➡️ 진행상태정보 고객사 전송
  - 관공서 등록 오류 ➡️ 2가지 케이스 (등록요청 시 오류, 최종 과세 결과 수신 시 오류)
    - 등록 재요청 플래그가 `Y`이면 관공서 앞 재요청
    - 등록 가능한 시간인지 확인
      - 가능한 시간이라면 (`selectHypcStgupRqstInfo`)
      - 재요청 플래그 리셋 (`updateVcexSvcMgntBase`)
  - 관공서 등록 불가 
    -  