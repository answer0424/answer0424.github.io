---
layout: post
title: 비즈니스 로직 (3)
date: 2025-05-27  09:00 +09:00
categoties: [cbcp, week09]
tags: [cbcp]
---

#### getMvPrcInfo

> BMW 시세 정보 조회

- 중고차 시세 조회(`getShacVhclMvPrc`)
- 중고차 시세 조회 결과 존재할 경우
  - 시세조회에 성공할 경우
    - 요청 차량정보구분코드: 판매상사
    - TS 조회결과: 판매상사차량 아님
    - 소유자명 존재
    - 등록원부 조회 결과: 정상
    - 일반 시세 조회: 성공
    - ➡️ 5가지 조건을 충족했을 경우 완료
  - 시세조회에 실패할 경우
    - 시세 조회 오류로 처리
    - 시세 조회 오류 건 중 보험사고 이력 조회 건은 분리하여 처리
    - 시가 표준액 검색 실패일 경우 오류메시지 발송
  - 시세 조회 오류인 경우 ➡️ 오류 메시지 추가

<br>

#### getMvPrc()

> 일반시세 또는 판매상사 시세, 제휴사시세 비교

- 일반시세/판매상사 시세와 제휴사 시세 중 더 큰값으로 시세를 제공
- 상한가/하한가 계산(`selectUplmLwlmRt`)

<br>

#### cnfmSef()

> 라온시큐어 본인확인

- 입력 파라미터 검증 ➡️ 실명, 생년월일, 성별 구분 코드, 이동통신사 코드, 전화번호
- 암호화 모듈 호출
- 본인확인 전문 생성 및 저장
- 소켓 통신으로 전문 송신(`sndSockTmsg`)
- 응답 전문 확인

<br>

#### getAutoupMvPrc()

> 오토업 시세 조회

- 필수 파라미터 ➡️ 차량번호, 차대번호, 원부차명, 형식년도, 최초등록일자, 원동기형식
- Autoup 시세 요청
- Autoup 시세 인터페이스 내역 저장(`writeValueAsString`)
- `rtnMap` `null`이 아닐 경우
  - `rtnMap` 작성
  - 시세 조회에 성공했을 경우
    - 응답코드 정상
    - 세부등급명, 세부등급 가격리스트가 존재할 때만 저장
  - 차량정보는 있으나 시세 정보가 없을 경우
    - 차량 정보만 저장
  - 시세 조회에 실패
    - 오류메시지 update
- Autoup 시세 인터페이스 내역 저장(`insertComAfcrMvIntfPtcl`)

<br>

#### getInsbfAmtDpcrtAmt()

> 내차보험사고 금액 감가상각 금액 조회

- 대행 관리 번호가 존재하는지 확인
- 내차 보험금 감가상각 금액 조회(`selectInsbfAmtDpcrtAmt`)
- 내차 보험금 감가상각 금액이 존재할 경우
  - `rsltMap`에 저장

<br>

#### bzaqVhclOwnrCnfm()

> 거래처 소유자 확인

- 파라미터로 받은 `cnfmRqstList`가 존재할 경우
  - 거래처 소유자 확인 대상 리스트 조회(`selectVesBzaqVhclOwnrCnfmMgntBase`)
  - 비동기 처리
    - 소유자확인 후 결과 DB 업데이트(`cnfmVhclOwnrAndUpdateRslt`)
    - 소유자 확인 실패 시 (주), ㈜ 확인 후 해당하면 재조회(`cnfmVhclOwnrAndUpdateRslt`)
- 비동기 `shutdown`

<br>