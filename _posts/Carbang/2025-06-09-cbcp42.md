---
layout: post
title: git action (2)
date: 2025-06-05  09:00 +09:00
categoties: [cbcp, week11]
tags: [cbcp]
---

## 재사용 가능한 워크플로 호출

> `uses` 키워드를 사용하여 재사용 가능한 워크플로를 호출

- 다음 구문 중 하나를 사용하여 재사용 가능한 워크플로 파일을 참조
  - 퍼블릭 및 프라이빗 리포지토리에서 재사용 가능한 워크플로의 경우 `{owner}/{repo}/.github/workflows/{filename}@{ref}`
    - `{ref}`는 SHA, 릴리스 태크 또는 분기 이름을 사용할 수 있음
    - 릴리스 태그와 분기의 이름이 같을 경우 태그가 분기 이름보다 우선
  - 동일한 리포지토리에서 다시 사용할 수 있는 워크플로의 경우 `./.github/workflows/{filename}`
    - `{owner}/{repo}`, `@{ref}`를 사용하는 경우 호출된 워크플로는 호출자 워크플로와 동일한 커밋을 가져옴

```yaml
jobs:
  call-workflow-1-in-local-repo:
    uses: octo-org/this-repo/.github/workflow/workflow-
1.yml@172239021f7ba04fe7327647b213799853a9eb89
  call-workflow-2-in-local-repo:
    uses: ./.github/workflows/workflow-2.yml
  call-workflow-in-another-repo:
    uses: octo-org/another-repo/.github/workflows/workflow.yml@v1
```

<br>

#### 재사용 가능한 워크플로에서 입력 및 비밀 전달

> 명명된 입력을 호출된 워크플로에 전달하려면 작업에서 `with` 키워드를 사용
>
> 명명된 secret을 전달하려면 `secrets` 키워드를 사용

```yaml
jobs:
  call-workflow-passing-data:
    uses: octo-org/example-repo/.github/workflow/reusable-workflow.yml@main
    with:
      config-path: .github/labeler.yml
    secrets:
      personal_access_token: ${{ secrets.token }}
```

- 동일한 조직에서 재사용 가능한 워크플로를 호출하는 워크플로는 `inherit` 키워드를 사용

```yaml
jobs:
  call-workflow-passing-data:
    uses: octo/org/example-repo/.github/workflow/reusable-workflow.yml@main
    with:
      config-path: .github/labeler.yml
    secrets: inherit
```

<br>

#### 재사용 가능한 워크플로에 행렬 전략 사용 

- 매트릭스 전략을 사용하면 단일 작업 정의에서 변수를 사용하여 변수의 조합을 기반으로 하는 여러 작업 실행을 자동으로 만듦
- 예를 들어 행렬 전약을 사용하여 재사용 가능한 워크플로에 다른 입력을 전달 가능
- 아래 예시는 재사용 가능한 워크플로를 호출하고 값 `[dev, stage, prod]`로 변수 `target`을 정의하여 행렬형 컨텍스트를 참조

```yaml
jobs:
  reuseableMatrixJobForDeployment:
    strategy:
      matrix:
        target: [dev, stage, prod]
    uses: octocat/octo-repo/.github/workflow/deployment.yml@main
    with:
      target: ${{ matrix.target }}
```

<br>

#### 재사용 가능한 워크플로를 호출하는 작업에 대해 지원되는 키워드

- <a href="https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idname"><code>jobs.&lt;job_id&gt;.name</code></a>
- <a href="https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_iduses"><code>jobs.&lt;job_id&gt;.uses</code></a>
- <a href="https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idwith"><code>jobs.&lt;job_id&gt;.with</code></a>
- <a href="https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idwithinput_id"><code>jobs.&lt;job_id&gt;.with.&lt;input_id&gt;</code></a>
- <a href="https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idsecrets"><code>jobs.&lt;job_id&gt;.secrets</code></a>
- <a href="https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idsecretssecret_id"><code>jobs.&lt;job_id&gt;.secrets&lt;secret&gt;</code></a>
- <a href="https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idsecretsinherit"><code>jobs.&lt;job_id&gt;.secrets.inherit</code></a>
- <a href="https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idstrategy"><code>jobs.&lt;job_id&gt;.strategy</code></a>
- <a href="https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idneeds"><code>jobs.&lt;job_id&gt;.needs</code></a>
- <a href="https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idif"><code>jobs.&lt;job_id&gt;.if</code></a>
- <a href="https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idconcurrency"><code>jobs.&lt;job_id&gt;.concurrency</code></a>
- <a href="https://docs.github.com/ko/actions/using-workflows/workflow-syntax-for-github-actions#jobsjob_idpermissions"><code>jobs.&lt;job_id&gt;.permissions</code></a>

```yaml
name: Call a reusable workflow

on:
  pull_request:
    branches:
      - main

jobs:
  call-workflow:
    uses: octo-org/example-repo/.github/workflow/workflow-A.yml@v1

  call-workflow-passing-data:
    permissions:
      contents: read
      pull-request: write
    uses: octo-org/example-repo/.github/workflows/workflow-B.yml@main
    with:
      config-path: .github/labeler.yml
    secrets:
      token: ${{ secrets.GITHUB_TOKEN }}
```

<br>