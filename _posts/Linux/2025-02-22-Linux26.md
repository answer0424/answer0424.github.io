---
layout: post
title: vsftpd 
date: 2025-02-22 13:53 +09:00
categories: [Linux, advanced]
tags: [linux]
image:
    path: /assets/img/python/Linux.png
---

## vsftpd (Very Secure FTP Daemon) ê°œìš”
> `vsftpd`ëŠ” Linux/Unix ê¸°ë°˜ì˜ FTP ì„œë²„ ì¤‘ í•˜ë‚˜ë¡œ ë³´ì•ˆì„±ê³¼ ì„±ëŠ¥ì´ ë›°ì–´ë‚˜ê¸° ë•Œë¬¸ì— ë„ë¦¬ ì‚¬ìš©ëœë‹¤
> ì´ë¦„ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´ ë§¤ìš° ì•ˆì „í•œ FTP ë°ëª¬ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆìœ¼ë©°, ë¹ ë¥¸ ì†ë„, ê°•ë ¥í•œ ë³´ì•ˆ, ê°€ë²¼ìš´ ì„±ëŠ¥ì„ ì œê³µí•˜ëŠ” ê²ƒì´ íŠ¹ì§•ì´ë‹¤

<br>

## vsftpd ì„¤ì¹˜
> Ubuntu/Debian ê³„ì—´

```bash
sudo dnf update
sudo dnf install vsftpd -y
```

- ì„¤ì¹˜ê°€ ì™„ë£Œë˜ë©´ `vsftpd` ì„œë¹„ìŠ¤ê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤

<br>

## vsftpd ì„œë¹„ìŠ¤ ê´€ë¦¬
> vsftpdê°€ ì‹¤í–‰ë˜ê³  ìˆëŠ”ì§€ í™•ì¸í•˜ê³  í•„ìš”ì‹œ ì¬ì‹œì‘í•  ìˆ˜ ìˆë‹¤

```bash
# ì„œë¹„ìŠ¤ ì‹œì‘
sudo systemctl start vsftpd

# ì„œë¹„ìŠ¤ ìë™ ì‹œì‘ ì„¤ì • (ì„œë²„ ì¬ë¶€íŒ… ì‹œ ìë™ ì‹¤í–‰)
sudo systemctl enable vsftpd

# í˜„ì¬ ìƒíƒœ í™•ì¸
sudo systemctl status vsftpd

# ì„¤ì • ë³€ê²½ í›„ vsftpd ì¬ì‹œì‘
sudo systemctl restart vsftpd
```

<br>

## vsftps ì„¤ì • íŒŒì¼ ë³€ê²½
> `vsftpd`ì˜ ëª¨ë“  ì„¤ì •ì€ `/etc/vsftpd.conf` íŒŒì¼ì— ì €ì¥ë˜ì–´ ìˆë‹¤
> FTP ì„œë²„ì˜ ë³´ì•ˆ ë° ê¸°ëŠ¥ì„ ì¡°ì •í•˜ë ¤ë©´ ì´ íŒŒì¼ì„ ìˆ˜ì •í•´ì•¼ í•œë‹¤

```bash
sudo vi /etc/vsftpd.conf
```

#### ì£¼ìš” ì„¤ì • ì˜µì…˜

| ì„¤ì • ì˜µì…˜ | ì„¤ëª… | ê¸°ë³¸ê°’ |
|---|---|---|
| `anonymous_enable=NO` | ìµëª… ì‚¬ìš©ìì˜ FTP ì ‘ê·¼ í—ˆìš© ì—¬ë¶€ | `YES` |
| `local_enable=YES` | ë¡œì»¬ ì‚¬ìš©ì ë¡œê·¸ì¸ í—ˆìš© | `NO`|
| `write_enable=YES` | íŒŒì¼ ì—…ë¡œë“œ/ìˆ˜ì • í—ˆìš© | `NO` |
| `chroot_local_user=YES` | ì‚¬ìš©ì í™ˆ ë””ë ‰í† ë¦¬ ì œí•œ (ë³´ì•ˆ) | `NO` |
| `pasv_enable=YES` | Passiveëª¨ë“œ í™œì„±í™”(NAT í™˜ê²½ í•„ìˆ˜) | `YES` |
| `pasv_min_port=40000` | Passive ëª¨ë“œì˜ ìµœì†Œ í¬íŠ¸ | ì—†ìŒ |
| `pasv_max_port=50000` | 	Passive ëª¨ë“œì˜ ìµœëŒ€ í¬íŠ¸ | ì—†ìŒ |
| `utf8_filesystem=YES` | UTF-8 íŒŒì¼ëª… ì§€ì› | `NO` |

> ì„¤ì • ë³€ê²½ í›„ ë°˜ë“œì‹œ `vsftpd`ë¥¼ ì¬ì‹œì‘í•´ì•¼ ì ìš©ëœë‹¤

```bash
sudo systemctl restart vsftpd
```

<br>

## FTP ì‚¬ìš©ì ê³„ì • ê´€ë¦¬
> vsftpdëŠ” ë¡œì»¬ ê³„ì •ì„ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìœ¼ë©°, FTP ì „ìš© ê³„ì •ì„ ë”°ë¡œ ìƒì„±í•  ìˆ˜ë„ ìˆë‹¤ë‹¤

#### FTP ì „ìš© ê³„ì • ìƒì„±

```bash
sudo useradd -m -s /sbin/nologin ftpuser   # ì‰˜ ì ‘ê·¼ ê¸ˆì§€
sudo passwd ftpuser  # ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
```


#### FTP ì‚¬ìš©ì ë””ë ‰í† ë¦¬ ì„¤ì •
> FTP ì‚¬ìš©ìì˜ í™ˆ ë””ë ‰í† ë¦¬ë¥¼ `/home/ftpuser`ë¡œ ì„¤ì •í•˜ê³  í•´ë‹¹ ë””ë ‰í† ë¦¬ì˜ ê¶Œí•œì„ ë³€ê²½í•œë‹¤

```bash
sudo chown ftpuser:ftpuser /home/ftpuser
sudo chmod 750 /home/ftpuser
```

#### íŠ¹ì • ì‚¬ìš©ìë§Œ FTP ì ‘ì† í—ˆìš©
> íŠ¹ì • ì‚¬ìš©ìë§Œ FTPì— ë¡œê·¸ì¸í•˜ë„ë¡ ì„¤ì •í•˜ë ¤ë©´ `/etx/vsftpd.user_list` íŒŒì¼ì„ ì‚¬ìš©í•œë‹¤

```bash
echo "ftpuser" | sudo tee -a /etc/vsftpd.user_list
```

- ê·¸ í›„, `vsftpd.conf`ì— ì•„ë˜ ì„¤ì •ì„ ì¶”ê°€í•œë‹¤

```ini
userlist_enable=YES
userlist_file=/etc/vsftpd.user_list
userlist_deny=NO
```

<br>

## Passive ëª¨ë“œ ì„¤ì • (ë°©í™”ë²½ ì´ìŠˆ í•´ê²°)
> Passive Mode(ìˆ˜ë™ ëª¨ë“œ)ëŠ” NAT í™˜ê²½(ê³µìœ ê¸° ë’¤ì— ìˆëŠ ì„œë²„)ì—ì„œ í•„ìˆ˜ì ì¸ ì„¤ì •ì´ë‹¤
> `/etc/vsftpd.conf` íŒŒì¼ì— ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•˜ê¸°

```ini
pasv_enable=YES
pasv_min_port=40000
pasv_max_port=50000
```

- ì´í›„ ë°©í™”ë²½ì—ì„œ í•´ë‹¹ í¬íŠ¸ë¥¼ ì—´ì–´ì¤˜ì•¼ í•œë‹¤

#### Ubuntu ë°©í™”ë²½ ì„¤ì •

```bash
sudo ufw allow 20/tcp   # FTP ë°ì´í„° í¬íŠ¸
sudo ufw allow 21/tcp   # FTP ì œì–´ í¬íŠ¸
sudo ufw allow 40000:50000/tcp  # Passive ëª¨ë“œ í¬íŠ¸
sudo ufw reload
```

#### CentOs ë°©í™”ë²½ ì„¤ì •

```bash
sudo firewall-cmd --permanent --add-service=ftp
sudo firewall-cmd --permanent --add-port=40000-50000/tcp
sudo firewall-cmd --reload
```

## vsftpd ë³´ì•ˆ ê°•í™”
> FTPëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë³´ì•ˆì— ì·¨ì•½í•˜ë¯€ë¡œ SSL/TLSë¥¼ ì ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤

#### SSL / TLS ì„¤ì •
- SSL ì¸ì¦ì„œ ìƒì„±

```bash
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
-keyout /etc/ssl/private/vsftpd.pem -out /etc/ssl/private/vsftpd.pem
```

- `vsftpd.conf`ì— SSL ì ìš©

```ini
ssl_enable=YES
rsa_cert_file=/etc/ssl/private/vsftpd.pem
rsa_private_key_file=/etc/ssl/private/vsftpd.pem
force_local_logins_ssl=YES
force_local_data_ssl=YES
```

- vsftpd ì¬ì‹œì‘

```bash
sudo systemctl restart vsftpd
```


<br>

## FTP ì ‘ì† ë° í…ŒìŠ¤íŠ¸

#### CLIì—ì„œ FTP ì ‘ì†

```bash
ftp <ì„œë²„ IP>
```

- ë˜ëŠ” SFTP(ë³´ì•ˆ FTP) ì‚¬ìš©

```bash
sftp ftpuser@<ì„œë²„ IP>
```

<br>

## ë¡œê·¸ ë° ë¬¸ì œ í•´ê²°

#### ë¡œê·¸ í™•ì¸
- FTP ì ‘ì† ë° ì˜¤ë¥˜ ë¡œê·¸ëŠ” ì•„ë˜ ê²½ë¡œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤

```bash
sudo journalctl -u vsftpd --no-pager
sudo tail -f /var/log/vsftpd.log
```

#### í¬íŠ¸ê°€ ì—´ë ¤ìˆëŠ”ì§€ í™•ì¸

```bash
sudo netstat -tulnp | grep vsftpd
```

#### SELinux ì„¤ì • (CentOS)
- CentOSì—ì„œ FTP ì ‘ì†ì´ ì•ˆëœë‹¤ë©´ SELinuxë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤

```bash
sudo setsebool -P ftp_home_dir on
```

- ë˜ëŠ” SELinuxë¥¼ ì¼ì‹œì ìœ¼ë¡œ ë¹„í™œì„±í™”í•˜ê¸°

```bash
sudo setenforce 0
```


## ğŸ¯ ë§ˆë¬´ë¦¬ ì •ë¦¬
- vsftpdëŠ” ê°€ë³ê³  ì•ˆì „í•œ FTP ì„œë²„
- ë³´ì•ˆ ê°•í™”ë¥¼ ìœ„í•´ SSL ì ìš©ì´ í•„ìˆ˜
- Passive ëª¨ë“œ ì„¤ì • ë° ë°©í™”ë²½ ì¡°ì •ì´ í•„ìš”
- ë¬¸ì œ ë°œìƒ ì‹œ ë¡œê·¸ í™•ì¸



