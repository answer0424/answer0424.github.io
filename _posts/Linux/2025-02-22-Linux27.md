---
layout: post
title: DHCP Server 
date: 2025-02-22 15:25 +09:00
categories: [Linux, advanced]
tags: [linux]     
---

## DHCP μ„λ²„ (Dynamic Host Configuration Protocol Server) κ°μ”
> DHCPλ” λ„¤νΈμ›ν¬ μ¥μΉ (PC, μ¤λ§νΈν°, μ„λ²„ λ“±)μ— μλ™μΌλ΅ IP μ£Όμ†λ¥Ό ν• λ‹Ήν•λ” ν”„λ΅ν† μ½μ΄λ‹¤
> DHCP μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ—κ² IP μ£Όμ†, μ„λΈλ„· λ§μ¤ν¬, κ²μ΄νΈ μ›¨μ΄, DNS μ„λ²„ λ“±μ λ„¤νΈμ›ν¬ μ„¤μ •μ„ μλ™μΌλ΅ μ κ³µν•λ” μ—­ν• μ„ ν•λ‹¤
 

 ## DHCP μ„λ²„μ μ£Όμ” κΈ°λ¥
 - IP μ£Όμ† μλ™ ν• λ‹Ή : ν΄λΌμ΄μ–ΈνΈκ°€ μ ‘μ†ν•  λ• μλ™μΌλ΅ IP μ£Όμ†λ¥Ό λ¶€μ—¬ν•λ‹¤
 - IP μ£Όμ† μ„λ€ (Lease) : μΌμ • μ‹κ°„ ν›„ IP μ£Όμ†λ¥Ό νμν•κ±°λ‚ μ—°μ¥ κ°€λ¥ν•λ‹¤
 - IP μ£Όμ† μ¶©λ λ°©μ§€ : λ„¤νΈμ›ν¬μ—μ„ μ¤‘λ³µλ IPκ°€ μ‚¬μ©λμ§€ μ•λ„λ΅ κ΄€λ¦¬ν•λ‹¤
 - λ„¤νΈμ›ν¬ μ„¤μ • μλ™ν™” : κ²μ΄νΈμ›¨μ΄, μ„λΈλ„· λ§μ¤ν¬, DNS μ„λ²„ μ„¤μ •λ„ μ κ³µ κ°€λ¥ν•λ‹¤

 <br>

## DHCP μ„λ²„ μ‘λ™ μ›λ¦¬
> DHCPλ” ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ— DORA ν”„λ΅μ„Έμ¤(Discover -> Offer -> Request -> Acknowledge)λΌλ” κ³Όμ •μ„ κ±°μ³ IPλ¥Ό ν• λ‹Ήν•λ‹¤

##### DORA ν”„λ΅μ„Έμ¤ (DHCP IP ν• λ‹Ή κ³Όμ •)

1. DHCP Discover : ν΄λΌμ΄μ–ΈνΈ -> λ„¤νΈμ›ν¬ λΈλ΅λ“μΌ€μ¤νΈλ΅ IP μ£Όμ†λ¥Ό μ”μ²­ν•λ‹¤
2. DHCP Offer : μ„λ²„ -> μ‚¬μ© κ°€λ¥ν• IP μ£Όμ†λ¥Ό μ μ•ν•λ‹¤
3. DHCP Request : ν΄λΌμ΄μ–ΈνΈ -> λ°›μ€ IPλ¥Ό μ‚¬μ©ν•κ² λ‹¤κ³  μ”μ²­ν•λ‹¤
4. DHCP Acknowledge : μ„λ²„ -> μµμΆ… μΉμΈ ν›„ IP μ„¤μ • μ™„λ£


<br>

## DHCP μ„λ²„ μ„¤μΉ 

- DHCP ν¨ν‚¤μ§€ μ„¤μΉ 
```bash
sudo dnf install dhcp*
```

- DHCP μ„¤μ • νμΌ μμ •
> DHCPμ μ„¤μ • νμΌμ€ `/etc/dhcp/dhcpd.conf`μ— μλ‹¤

```bash
sudo vi /etc/dhcp/dhcpd.conf
```

- κΈ°λ³Έ μ„¤μ • μμ‹ (`/etx/dhcp/dhcpd.conf`)

```ini
# DHCP μ„λ²„κ°€ κ΄€λ¦¬ν•λ” μ„λΈλ„· λ²”μ„ μ„¤μ •
subnet 192.168.1.0 netmask 255.255.255.0 {
    range 192.168.1.100 192.168.1.200;  # ν• λ‹Ήν•  IP λ²”μ„
    option routers 192.168.1.1;         # κΈ°λ³Έ κ²μ΄νΈμ›¨μ΄
    option subnet-mask 255.255.255.0;   # μ„λΈλ„· λ§μ¤ν¬
    option domain-name-servers 8.8.8.8, 8.8.4.4;  # DNS μ„λ²„
    default-lease-time 600;  # κΈ°λ³Έ μ„λ€ μ‹κ°„ (μ΄)
    max-lease-time 7200;     # μµλ€ μ„λ€ μ‹κ°„ (μ΄)
}
```

- νΉμ • μ¥μΉμ— κ³ μ • IP ν• λ‹Ή(MAC μ£Όμ† κΈ°λ°)
> νΉμ • μ¥μΉμ— ν•­μƒ λ™μΌν• IPλ¥Ό μ£Όκ³  μ‹¶λ‹¤λ©΄ MAC μ£Όμ†λ¥Ό κΈ°λ°μΌλ΅ μ„¤μ •ν•  μ μλ‹¤

```ini
host my_server {
    hardware ethernet 00:1A:2B:3C:4D:5E;
    fixed-address 192.168.1.50;
}
```

<br>

## DHCP μ„λΉ„μ¤ μ‹¤ν–‰ λ° ν™μ„±ν™”

> μ„¤μ • μ™„λ£ ν›„ DHCP μ„λ²„λ¥Ό μ‹¤ν–‰ν•΄μ•Ό ν•λ‹¤

- DHCP μ„λΉ„μ¤ μ‹μ‘

```bash
sudo systemctl start dhcpd
```

- μ„λ²„ λ¶€ν… μ‹ μλ™ μ‹¤ν–‰ μ„¤μ •

```bash
sudo systemctl enable dhcpd
```

- μ„λΉ„μ¤ μƒνƒ ν™•μΈ

```bash
sudo systemctl status dhcpd
```

<br>

## λ°©ν™”λ²½ μ„¤μ • (ν•„μ” μ‹)
> DHCP μ„λ²„λ” UDP 67λ² ν¬νΈμ—μ„ λ™μ‘ν•λ―€λ΅ λ°©ν™”λ²½μ—μ„ ν—μ©ν•΄μ•Ό ν•λ‹¤

```bash
sudo firewall-cmd --permanent --add-port=67/udp
sudo firewall-cmd --reload
```

<br>

## DHCP ν• λ‹Ήλ IP ν™•μΈ
> ν΄λΌμ΄μ–ΈνΈκ°€ λ°›μ€ IP μ •λ³΄λ¥Ό ν™•μΈν•λ ¤λ©΄ λ΅κ·Έ νμΌμ„ ν™•μΈν•λ©΄ λλ‹¤

```bash
sudo cat /var/lib/dhcpd/dhcpd.leases
```

<br>

## ν΄λΌμ΄μ–ΈνΈμ—μ„ DHCPλ΅ IP λ°›κΈ°
- ν„μ¬ IP ν™•μΈ

```bash
ip a
```

- DHCP μ„λ²„μ—μ„ μƒ IP μ”μ²­

```bash
sudo dhclient -r  # κΈ°μ΅΄ IP ν•΄μ 
sudo dhclient     # μƒλ΅μ΄ IP μ”μ²­
```

<br>

## DHCP μ„λ²„ λ¬Έμ  ν•΄κ²°

#### DHCP μ„λΉ„μ¤ λ΅κ·Έ ν™•μΈ

```bash
sudo journalctl -u dhcpd --no-pager
```

#### νΉμ • ν΄λΌμ΄μ–ΈνΈμ— IPκ°€ ν• λ‹Ήλμ§€ μ•μ„ λ•
- `/var/lib/dhcpd/dhcpd.leases` νμΌμ—μ„ IP ν• λ‹Ή μƒνƒ ν™•μΈ
- λ°©ν™”λ²½μ—μ„ `67/udp` ν¬νΈκ°€ μ—΄λ ¤ μλ”μ§€ ν™•μΈ
- λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤κ°€ μ¬λ°”λ¥΄κ² μ„¤μ •λμ—λ”μ§€ ν™•μΈ (`ip a` λλ” `ifconfig` λ…λ Ήμ–΄ μ‚¬μ©)

<br>

## π― μ •λ¦¬

- DHCP μ„λ²„λ” IP μ£Όμ†λ¥Ό μλ™μΌλ΅ ν• λ‹Ήν•΄μ£Όλ” μ„λΉ„μ¤
- DORA κ³Όμ • (Discover -> Offer -> Request -> Acknowledge)μΌλ΅ μ‘λ™
- `/etc/dhcp/dhcpd.conf` νμΌμ—μ„ IP λ²”μ„ λ° λ„¤νΈμ›ν¬ μ„¤μ • μ΅°μ • κ°€λ¥
- νΉμ • μ¥μΉμ— κ³ μ • IPλ¥Ό ν• λ‹Ήν•λ ¤λ©΄ MAC μ£Όμ† κΈ°λ° μ„¤μ • μ¶”κ°€
- `dnf`λ΅ DHCP μ„λ²„ μ„¤μΉ ν›„ μ„λΉ„μ¤ μ‹¤ν–‰ λ° λ°©ν™”λ²½ μ„¤μ • ν•„μ”
