---
layout: post
title: PXE Server 
date: 2025-02-23 17:00 +09:00
categories: [Linux, advanced]
tags: [linux]     
---

## PXE Server κ°μ”
> PXEλ” λ„¤νΈμ›ν¬ λ¶€ν…μ„ μ§€μ›ν•λ” κΈ°μ μ΄λ‹¤
> PXE μ„λ²„λ¥Ό κµ¬μ„±ν•λ©΄ ν΄λΌμ΄μ–ΈνΈκ°€ λ΅μ»¬ λ””μ¤ν¬ μ—†μ΄ λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄ OSλ¥Ό λ‹¤μ΄λ΅λ“ν•μ—¬ λ¶€ν…ν•  μ μλ‹¤

#### μ‚¬μ© μ‚¬λ΅€
- OS μλ™ μ„¤μΉ(λ¦¬λ…μ¤, μλ„μ° λ“±)
- λ€λ‰μ μ»΄ν“¨ν„° μ΄κΈ°ν™” λ° λ³µκµ¬
- λ””μ¤ν¬ μ—†λ” μ›ν¬μ¤ν…μ΄μ… μ΄μ
- λ„¤νΈμ›ν¬ κΈ°λ° μ μ§€λ³΄μ λ° λ°°ν¬

<br>

## PXE μ„λ²„μ κΈ°λ³Έ μ›λ¦¬
> PXE μ„λ²„λ” λ‹¤μκ³Ό κ°™μ€ λ„¤νΈμ›ν¬ μ„λΉ„μ¤λ¥Ό ν†µν•΄ μ‘λ™ν•λ‹¤

| μ„λΉ„μ¤ | μ—­ν•  |
|---|---|
|DCHP(Dynamic Host Configuration Protocol) | ν΄λΌμ΄μ–ΈνΈμ— IP μ£Όμ† λ° PXE μ„λ²„ μ •λ³΄ μ κ³µ |
| TFTP (Trivial File Transfer Protocol) | ν΄λΌμ΄μ–ΈνΈκ°€ λ¶€ν…ν•  OS μ΄λ―Έμ§€λ¥Ό λ‹¤μ΄λ΅λ“ |
| NFS/HTTP/FTP | OS μ„¤μΉ νμΌ μ κ³µ (μ„ νƒμ‚¬ν•­) |

- PXEλ¥Ό μ‚¬μ©ν•λ ¤λ©΄ ν΄λΌμ΄μ–ΈνΈμ BIOS λλ” URFIμ—μ„ "PXE λ¶€ν…"μ„ ν™μ„±ν™”ν•΄μ•Ό ν•¨

<br>

## PXE μ„λ²„ κµ¬μ„± μ”μ†

1. DHCP μ„λ²„ -> PXE μ„λ²„μ μ£Όμ† μ κ³µ
2. TFTP μ„λ²„ -> λ¶€ν… μ΄λ―Έμ§€ μ κ³µ
3. PXELINUX -> λ„¤νΈμ›ν¬ λ¶€ν… λ΅λ”
4. OS μ„¤μΉ μ΄λ―Έμ§€ (NFS, HTPP, FTP μ‚¬μ© κ°€λ¥)

<br>

## PXE μ„λ²„ κµ¬μ¶• (dnf μ‚¬μ©)

#### PXE κ΄€λ ¨ ν¨ν‚¤μ§€ μ„¤μΉ 

```bash
sudo dnf install dhcp-server tftp-server syslinux httpd -y
```

#### DHCP μ„λ²„ μ„¤μ •
> PXE ν΄λΌμ΄μ–ΈνΈκ°€ μ¬λ°”λ¥Έ PXE μ„λ²„λ¥Ό μ°Ύμ„ μ μλ„λ΅ `/etx/dhcp/dhcpd.conf`λ¥Ό μμ •ν•΄μ•Ό ν•λ‹¤

```bash
sudo vi /etc/dhcp/dhcpd.conf
```

- λ‹¤μμ λ‚΄μ©μ„ μ¶”κ°€ν•κΈ°

```ini
subnet 192.168.1.0 netmask 255.255.255.0 {
    range 192.168.1.100 192.168.1.200;
    option routers 192.168.1.1;
    option subnet-mask 255.255.255.0;
    option domain-name-servers 8.8.8.8;
    
    # PXE μ„¤μ •
    next-server 192.168.1.10;  # PXE μ„λ²„ IP
    filename "pxelinux.0";
}
```

- μ„¤μ • ν›„ DHCP μ„λ²„λ¥Ό μ‹μ‘

```bash
sudo systemctl restart dhcpd
sudo systemctl enable dhcpd
```

<br>

## TFTP μ„λ²„ μ„¤μ •
> PXE λ¶€ν… νμΌμ„ μ „μ†΅ν•λ” μ—­ν• μ„ ν•λ‹¤

#### TFTP ν™μ„±ν™”

```bash
sudo systemctl enable --now tftp
```

#### PXELINUX λ¶€ν… νμΌ λ³µμ‚¬

```bash
sudo cp /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot/
sudo cp /usr/share/syslinux/menu.c32 /var/lib/tftpboot/
sudo cp /usr/share/syslinux/memdisk /var/lib/tftpboot/
sudo cp /usr/share/syslinux/chain.c32 /var/lib/tftpboot/
```

#### PXE λ¶€ν… λ©”λ‰΄ μƒμ„±

```bash
sudo mkdir -p /var/lib/tftpboot/pxelinux.cfg
sudo vi /var/lib/tftpboot/pxelinux.cfg/default
```

```ini
DEFAULT menu.c32
PROMPT 0
TIMEOUT 100
ONTIMEOUT local

MENU TITLE PXE Boot Menu

LABEL linux
    MENU LABEL Install CentOS
    KERNEL vmlinuz
    APPEND initrd=initrd.img inst.repo=http://192.168.1.10/centos/

LABEL local
    MENU LABEL Boot from Local Drive
    LOCALBOOT 0
```

<br>

## λ°©ν™”λ²½ μ„¤μ •
> PXE μ„λ²„κ°€ μ •μƒμ μΌλ΅ μ‘λ™ν•λ ¤λ©΄ ν•„μ”ν• ν¬νΈλ¥Ό μ—΄μ–΄μ¤μ•Ό ν•λ‹¤

```bash
sudo firewall-cmd --permanent --add-service=dhcp
sudo firewall-cmd --permanent --add-service=tftp
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --reload
```


<br>

## ν΄λΌμ΄μ–ΈνΈμ—μ„ PXE λ¶€ν… μ„¤μ •

1. BIOS/UEFIμ—μ„ λ„¤νΈμ›ν¬ λ¶€ν…(PXE) ν™μ„±ν™”
2. DHCP μ„λ²„μ—μ„ PXE μ •λ³΄λ¥Ό λ°›μ•„ PXE λ©”λ‰΄ ν™•μΈ
3. OS μ„¤μΉ μ§„ν–‰

<br>

## PXE μ„λ²„ λ¬Έμ  ν•΄κ²°
- DHCP μ„λ²„ μ‘λ™ ν™•μΈ

```bash
sudo systemctl status dhcpd
```

- TFTP μ„λ²„ ν™•μΈ

```bash
sudo systemctl status tftp
```

- PXE ν΄λΌμ΄μ–ΈνΈκ°€ λ¶€ν… νμΌμ„ κ°€μ Έμ¬ μ μλ”μ§€ ν™•μΈ

```bash
tftp 192.168.1.10 -c get pxelinux.0
```

> μ •μƒμ μΌλ΅ νμΌμ΄ λ‹¤μ΄λ΅λ“λλ©΄ TFTPκ°€ μ •μƒ λ™μ‘ μ¤‘

## π― μ •λ¦¬

- PXE μ„λ²„λ” λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄ OSλ¥Ό λ¶€ν…ν•  μ μλ„λ΅ μ§€μ›
- DHCP μ„λ²„μ—μ„ PXE ν΄λΌμ΄μ–ΈνΈμ—κ² λ¶€ν… μ„λ²„ μ •λ³΄λ¥Ό μ κ³µ
- TFTP μ„λ²„μ—μ„ λ¶€ν… λ΅λ” (`pxelinux.0`)λ¥Ό μ „λ‹¬
- HTTP/NFS/FTPλ¥Ό μ‚¬μ©ν•΄ OS μ„¤μΉ νμΌμ„ μ κ³µ
- λ°©ν™”λ²½ λ° ν΄λΌμ΄μ–ΈνΈ BIOD/UEFI μ„¤μ • ν•„μ”
