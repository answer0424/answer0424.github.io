---
layout: post
title: PXE + ν‚¥μ¤νƒ€νΈ 
date: 2025-02-23 17:16 +09:00
categories: [Linux, advanced]
tags: [linux]
image:
    path: /assets/img/linux/Linux.png
---

## PXE ν‚¥μ¤νƒ€νΈ μ„¤μΉ κ°μ”
> PXE λ¶€ν…μ€ λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄ OS μλ™ μ„¤μΉν•  μ μλ„λ΅ ν•΄μ£Όλ”λ°, ν‚¥μ¤νƒ€νΈ(kickstart)λ” OS μ„¤μΉ κ³Όμ •μ„ μλ™ν™”ν•λ” λ°©λ²•μ΄λ‹¤

<br>

## PXE ν‚¥μ¤νƒ€νΈ μ„¤μΉ κ°μ”

- PXE: ν΄λΌμ΄μ–ΈνΈκ°€ λ„¤νΈμ›ν¬μ—μ„ OS λ¶€ν… λ° μ„¤μΉ
- ν‚¥μ¤νƒ€νΈ: μ‚¬μ „μ— μ •μλ μ„¤μ • νμΌμ„ μ‚¬μ©ν•΄ μλ™ μ„¤μΉ

- PXE -> ν΄λΌμ΄μ–ΈνΈκ°€ λ„¤νΈμ›ν¬λ΅ λ¶€ν…
- Kickstart: μλ™ μ„¤μΉ μ¤ν¬λ¦½νΈλ΅ μ„¤μ • μλ™ν™”

> ν‚¥μ¤νƒ€νΈ νμΌμ€ HTTP, FTP, NFS λ“±μ„ ν†µν•΄ μ κ³µν•  μ μλ‹¤
> κΈ°λ³Έμ μΌλ΅ `/root/anaconda-ks.cfg` νμΌμ„ μ°Έκ³ ν•λ©΄ λλ‹¤

<br>

## ν‚¥μ¤νƒ€νΈ μ„¤μ • νμΌ μ‘μ„±
> ν‚¥μ¤νƒ€νΈ νμΌμ€ `/var/www/html/kickstart.cfg`μ— μ„ν”Όν•λ„λ΅ μ„¤μ •ν•λ‹¤

#### κΈ°λ³Έ ν‚¥μ¤νƒ€νΈ νμΌ μ„¤μ •
> λ¨Όμ € κΈ°μ΅΄ μ„¤μΉ λ΅κ·Έλ¥Ό κΈ°λ°μΌλ΅ ν‚¥μ¤νƒ€νΈ νμΌμ„ μƒμ„±ν•  μ μλ‹¤

```bash
cp /root/anaconda-ks.cfg /var/www/html/kickstart.cfg
```

#### ν‚¥μ¤νƒ€νΈ νμΌ μμ • (`/var/www/html/kickstart.cfg`)

```ini
# μ‹μ¤ν… μ–Έμ–΄ μ„¤μ •
lang en_US.UTF-8

# ν‚¤λ³΄λ“ λ μ΄μ•„μ›ƒ
keyboard us

# λ„¤νΈμ›ν¬ μ„¤μ • (DHCP μ‚¬μ©)
network --bootproto=dhcp --device=eth0 --onboot=on

# λ£¨νΈ λΉ„λ°€λ²νΈ μ„¤μ • (μ•”νΈν™”λ κ°’)
rootpw --plaintext password123

# μ‹κ°„λ€ μ„¤μ •
timezone Asia/Seoul --isUtc

# λ¶€ν… λ΅λ” μ„¤μΉ
bootloader --location=mbr

# νν‹°μ… μ„¤μ • (λ””μ¤ν¬ μ „μ²΄ μ‚¬μ©)
clearpart --all --initlabel
autopart --type=plain

# ν¨ν‚¤μ§€ μ„¤μΉ (κΈ°λ³Έ μ„¤μΉ)
%packages
@core
wget
vim
net-tools
%end

# μ„¤μΉ ν›„ μ‹¤ν–‰ν•  λ…λ Ήμ–΄
%post
echo "PXE μ„¤μΉ μ™„λ£" > /root/installed.txt
%end
```

<br>

## HTTP μ„λ²„ μ„¤μ • (ν‚¥μ¤νƒ€νΈ νμΌ μ κ³µ)
> ν‚¥μ¤νƒ€νΈ νμΌμ„ μ κ³µν•κΈ° μ„ν•΄μ„λ” HTTP μ„λ²„κ°€ ν•„μ”ν•λ‹¤

#### HTTP μ„λ²„ μ‹μ‘

```bash
sudo systemctl start httpd
sudo systemctl enable httpd
```

#### HTTP μ„λ²„κ°€ ν‚¥μ¤νƒ€νΈ νμΌμ„ μ κ³µν•λ”μ§€ ν™•μΈ

```bash
curl http://192.168.1.10/kickstart.cfg
```

> μ •μƒμ μΌλ΅ νμΌμ΄ μ¶λ ¥λλ©΄ μ„±κ³µμ΄λ‹¤

<br>

## PXE μ„λ²„ μ„¤μ • (ν‚¥μ¤νƒ€νΈ μ μ©)
> PXE λ¶€ν… μ‹ ν‚¥μ¤νƒ€νΈ νμΌμ„ μλ™μΌλ΅ λ¶λ¬μ¤λ„λ΅ μ„¤μ •ν•΄μ•Ό ν•λ‹¤

#### PXE λ¶€ν… λ©”λ‰΄ μ„¤μ • (`/var/lib/tftpboot/pxelinux.cfg/default`)

```ini
DEFAULT menu.c32
PROMPT 0
TIMEOUT 100
ONTIMEOUT ks

MENU TITLE PXE Boot Menu

LABEL ks
    MENU LABEL Automated Kickstart Installation
    KERNEL vmlinuz
    APPEND initrd=initrd.img inst.ks=http://192.168.1.10/kickstart.cfg
```

- `inst.ks=http://192.168.1.10/kickstart.cfg` -> ν‚¥μ¤νƒ€νΈ νμΌμ„ μλ™μΌλ΅ λ΅λ“ν•λ„λ΅ μ„¤μ •ν•λ‹¤


<br>

## λ°©ν™”λ²½ μ„¤μ •

> ν‚¥μ¤νƒ€νΈ νμΌμ„ HTTPλ΅ μ κ³µν•λ―€λ΅ λ°©ν™”λ²½μ—μ„ ν¬νΈλ¥Ό μ—΄μ–΄μ•Ό ν•λ‹¤

```bash
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --reload
```

<br>

## ν΄λΌμ΄λ„νΈ PCE λ¶€ν… λ° μλ™ μ„¤μΉ
1. ν΄λΌμ΄μ–ΈνΈμ—μ„ λ„¤νΈμ›ν¬ λ¶€ν… (PXE) ν™μ„±ν™”
2. PXE λ©”λ‰΄μ—μ„ "Automated Kickstart Installation" μ„ νƒ
3. μλ™μΌλ΅ OS μ„¤μΉ μ§„ν–‰ 

<br>

## ν‚¥μ¤νƒ€νΈ μ„¤μΉ ν›„ ν™•μΈ
> μ„¤μΉκ°€ λλ‚ ν›„ ν΄λΌμ΄μ–ΈνΈμ—μ„ λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ ν›„ μ„¤μΉ μ™„λ£ μ—¬λ¶€λ¥Ό ν™•μΈν•  μ μλ‹¤

```bash
cat /root/installed.txt
```

- PXE μ„¤μΉ μ™„λ£ν•λ” λ©”μ‹μ§€κ°€ λ‚μ¤λ©΄ μ„±κ³µ


## π― μ •λ¦¬
- PXEλ” λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄ OSλ¥Ό λ¶€ν… λ° μ„¤μΉ κ°€λ¥
- ν‚¥μ¤νƒ€νΈλ” OS μ„¤μΉ κ³Όμ •μ„ μλ™ν™”ν•λ” λ°©λ²•
- `/var/www/html/kickstart.cfg`μ— ν‚¥μ¤νƒ€νΈ νμΌ μ €μ¥
- PXE λ©”λ‰΄μ—μ„ `inst.ks=http://..`μ„¤μ •ν•μ—¬ μλ™ μ„¤μΉ μ§„ν–‰
- μ™„μ „ μλ™ν™”λ OS μ„¤μΉ κ°€λ¥!
