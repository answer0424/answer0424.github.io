---
layout: post
title: Virtual Hosting
date: 2025-02-26 11:26 +09:00
categories: [Linux, advanced]
tags: [linux]     
---

## Virtual Hosting ê°œë…

- ë„ë©”ì¸ ë³„ë¡œ ì„œë¡œ ë‹¤ë¥¸ ì›¹ ì‚¬ì´íŠ¸ ì œê³µ
- ì„œë²„ í•˜ë‚˜ë¡œ ì—¬ëŸ¬ ê°œì˜ ë„ë©”ì¸ ìš´ì˜ ê°€ëŠ¥
- ê° ì‚¬ìš©ì ê³„ì •ë§ˆë‹¤ ê°œë³„ì ì¸ ë””ë ‰í† ë¦¬ í• ë‹¹ ê°€ëŠ¥


#### Virtual Hosting ë°©ì‹

1. IP ê¸°ë°˜ : í•˜ë‚˜ì˜ IPì—ì„œ ì—¬ëŸ¬ ê°œì˜ IPë¥¼ í• ë‹¹í•˜ê³  ê° IPì— ë‹¤ë¥¸ ì›¹ ì‚¬ì´íŠ¸ë¥¼ ì—°ê²°
2. ì´ë¦„ ê¸°ë°˜ : í•˜ë‚˜ì˜ IPì—ì„œ ì—¬ëŸ¬ ë„ë©”ì¸ì„ ìš´ì˜ (ì£¼ë¡œ ì‚¬ìš©)
3. í¬íŠ¸ ê¸°ë°˜ : ê°™ì€ IPì§€ë§Œ, í¬íŠ¸ë¥¼ ë‹¤ë¥´ê²Œ ì„¤ì •í•˜ì—¬ ì—¬ëŸ¬ ì›¹ ì‚¬ì´íŠ¸ ì œê³µ

<br>

## Apache Virtual Hosting ì„¤ì •
> Apache(htppd)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ì ê³„ì •ë³„ ì›¹ ì‚¬ì´íŠ¸ êµ¬ì„±í•˜ëŠ” ë°©ë²•

#### ì‚¬ìš©ì ê³„ì • ìƒì„±

```bash
sudo useradd user1
sudo useradd user2
```

#### ì‚¬ìš©ìë³„ ì›¹ ë””ë ‰í† ë¦¬ ìƒì„±

```bash
sudo mkdir -p /home/user1/public_html
sudo mkdir -p /home/user2/public_html
```

#### ìƒ˜í”Œ HTML íŒŒì¼ ì¶”ê°€

```bash
echo "<h1>Welcome to user1.co.kr</h1>" | sudo tee /home/user1/public_html/index.html
echo "<h1>Welcome to user2.co.kr</h1>" | sudo tee /home/user2/public_html/index.html
```

#### ê¶Œí•œ ì„¤ì •

```bash
sudo chown -R user1:user1 /home/user1/public_html
sudo chown -R user2:user2 /home/user2/public_html
sudo chmod -R 755 /home/user1/public_html
sudo chmod -R 755 /home/user2/public_html
```

#### Apache ê°€ìƒ í˜¸ìŠ¤íŠ¸ ì„¤ì •
- ì„¤ì • íŒŒì¼ : `/etc/httpd/conf.d/vhosts.conf`

```bash
sudo vi /etc/httpd/conf.d/vhosts.conf
```

```ini
<VirtualHost *:80>
    ServerAdmin admin@user1.co.kr
    ServerName user1.co.kr
    DocumentRoot /home/user1/public_html
    ErrorLog /var/log/httpd/user1_error.log
    CustomLog /var/log/httpd/user1_access.log combined
</VirtualHost>

<VirtualHost *:80>
    ServerAdmin admin@user2.co.kr
    ServerName user2.co.kr
    DocumentRoot /home/user2/public_html
    ErrorLog /var/log/httpd/user2_error.log
    CustomLog /var/log/httpd/user2_access.log combined
</VirtualHost>
```

#### Apache ì„¤ì • í™•ì¸ ë° ì¬ì‹œì‘

```bash
sudo httpd -t  # ì„¤ì • íŒŒì¼ ë¬¸ë²• ê²€ì‚¬
sudo systemctl restart httpd
sudo systemctl enable httpd
```

<br>

## DNS ì„¤ì •
> DNS ì„œë²„ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ `named` ì„¤ì •ë„ ì¶”ê°€í•´ì•¼ í•œë‹¤ë‹¤ 

#### DNS ì¡´ íŒŒì¼ ìˆ˜ì • 
- ì„¤ì • íŒŒì¼ : `/var/named/user1.co.kr.zone`

```bash
sudo vi /var/named/user1.co.kr.zone
```

```ini
$TTL 86400
@   IN  SOA ns1.user1.co.kr. admin.user1.co.kr. (
        2025022201 ; Serial
        3600       ; Refresh
        1800       ; Retry
        604800     ; Expire
        86400 )    ; Minimum TTL

    IN  NS  ns1.user1.co.kr.
ns1 IN  A   192.168.1.10
@   IN  A   192.168.1.10
www IN  A   192.168.1.10
```

#### ì—­ë°©í–¥ DNS ì„¤ì •
- ì„¤ì • íŒŒì¼ : `/var/named/1,168.192.in-addr.arpa`

```bash
sudo vi /var/named/1.168.192.in-addr.arpa
```

```ini
$TTL 86400
@   IN  SOA ns1.user1.co.kr. admin.user1.co.kr. (
        2025022201 ; Serial
        3600       ; Refresh
        1800       ; Retry
        604800     ; Expire
        86400 )    ; Minimum TTL

    IN  NS  ns1.user1.co.kr.
10  IN  PTR ns1.user1.co.kr.
```

#### DNS ì„œë²„ ì¬ì‹œì‘

```bash
sudo systemctl restart named
sudo systemctl enable named
```

<br>

## Nginx ê°€ìƒ í˜¸ìŠ¤íŒ… ì„¤ì • 
> Nginxë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì•„ë˜ì˜ ì„¤ì •ì„ ì¶”ê°€í•´ì•¼ í•œë‹¤

#### ì‚¬ìš©ìë³„ Nginx ì„¤ì •
- ì„¤ì • íŒŒì¼ : `/etc/nginx/conf.d/user1.co.kr`

```bash
sudo vi /etc/nginx/conf.d/user1.co.kr.conf
```

```ini
server {
    listen 80;
    server_name user1.co.kr;
    root /home/user1/public_html;
    index index.html;
    
    access_log /var/log/nginx/user1_access.log;
    error_log /var/log/nginx/user1_error.log;
}
```

#### ì„¤ì • í™•ì¸ ë° Nginx ì‹œì‘

```bash
sudo nginx -t  # ì„¤ì • í™•ì¸
sudo systemctl restart nginx
sudo systemctl enable nginx
```

## ğŸ¯ ì •ë¦¬

- Virtual Hostingì„ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ì ê³„ì •ë³„ë¡œ ê°œë³„ ì›¹ ì‚¬ì´íŠ¸ë¥¼ ìš´ì˜í•  ìˆ˜ ìˆë‹¤
- ApacheëŠ” `/etc/httpd/conf.d/vhost.conf`, NginxëŠ” `/etc/nginx/conf.d/*.conf` ì„¤ì •
- DNS ì„œë²„ì—ì„œ `user1.co.kr.zone` ì„¤ì •í•˜ë©´ ë„ë©”ì¸ ì—°ê²°ì´ ê°€ëŠ¥í•˜ë‹¤
- ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ `user.co.kr`, `user2.co.kr` ì…ë ¥í•˜ë©´ ê°œë³„ ì›¹ ì‚¬ì´íŠ¸ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤