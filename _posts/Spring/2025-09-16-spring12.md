---
layout: post
title: Autowiring with @Primary or @Fallback
date: 2025-09-16 13:00 +09:00
categories: [Spring, IoC Container, Annotation_based container]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

##  필요한 이유

> Spring에서 `@Autowired` autowiring은 유형(type)을 기준으로 후보 빈(bean)들을 찾고, 적절한 것 하나를 주입하려고 함
>
> 만약 같은 타입의 빈이 여러개 있을 경우 어떤 것을 주입해야 할지 모호(ambiguous)해짐
>
> 이럴 때 `@Primary`나 `@Fallback` 어노테이션을 사용하여 우선순위를 지정할 수 있음

<br>

## @Primary와 @Fallback의 역할과 사용법

| 어노테이션 | 의미 | 동작 방식 | 언제 쓰는지 |
|-|-|-|-|
| `@Primary` | 여러 후보 빈들 중에서 우선적으로 선택되어야 하는 빈임을 표시 | 한타입의 빈 후보 중 `@Primary`가 붙은 빈이 있다면, `@Autowired`로 주입할 때 그 빈을 사용 | 여러 구현체 중 기본 구현체를 정해두고 싶을 경우 사용 |
| `@Fallback` | 정규 후보가 하나도 없을 경우에만 사용 | 정규 빈이 없고, `@Primary`도 없을 경우 마지막 옵션의 느낌 | 플러그인 가능 구조, 테스트 환경 또는 기본 동작이 없을 경우 대비용 구현을 두고 싶을 경우 사용 |

<br>

## 예시 코드 (`@Primary`)

```java
@Configuration
public class MovieConfiguration {

    @Bean
    @Primary
    public MovieCatalog firstMovieCatalog() {
        return new MovieCatalog("first");
    }

    @Bean
    public MovieCatalog secondMovieCatalog() {
        return new MovieCatalog("second");
    }

}
```

그리고 이렇게 주입되는 부분:

```java
@Component
public class MovieRecommender {
  
  @Autowired
  private MovieCatalog movieCatalog;

  public void recommend() {
    System.out.println(movieCatalog.getName());
  }
}

```

- 위 설정에서는 `firstMovieCatalog`에 `@Primary`가 있으므로, `MovieRecommender`의 `movieCatalog` 필드에는 `firstMovieCatalog` 빈이 주입됨

<br>

## 예시 코드(`@Fallback`)

```java
@Configuration
public class MovieConfiguration {

  @Bean
  public MovieCatalog mainMovieCatalog() {
    return new MovieCatalog("Main");
  }

  @Bean
  @Fallback
  public MovieCatalog fallbackMovieCatalog() {
    return new MovieCatalog("Fallback");
  }
}
```

- 이 경우, `mainMovieCatalog`라는 정규 빈이 있으므로 `fallbackMovieCatalog`는 사용되지 않음
- 만약 `mainMovieCatalog` 빈이 없었다면, `fallbackMovieCatalog`가 주입되었을 것

<br>

## 우선순위 정리

> Autowired 후보 빈이 여러 개일 때 우선순위 

1. 타입(type)으로 가능한 빈들 모두 찾음
2. 그 중에서 `@Primary`가 붙은 빈이 있으면 사용
3. 만약 `@Primary`가 없고, 정규 후보들도 없을 경우, `@Fallback`이 붙은 빈을 사용
4. 그래도 후보가 애매할 경우 예외 발생(혹은 `@Qualifier` 등이 명시되어 있으면 그것 참고)