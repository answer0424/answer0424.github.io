---
layout: post
title: 다양한 Bean에 대해 다양한 트랜잭션 의미 구성
date: 2025-09-22 09:00:00 +09:00
categories: [Spring, DataAccess, Transaction Management, Declarative Transaction Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 핵심 내용 요약

> 여러 서비스 빈 객체들(service layer)을 대상으로, 서로 다른 트랜잭션 설정을 적용하는 방법을 설명
>
> 예를 들어, 어떤 서비스에서는 기본 트랜잭션 설정을 쓰고, 다른 서비스에서는 트랜잭션을 사용하지 않거나, 읽기 전용 또는 다른 특성을 갖는 트랜잭션 사용 등으로 분리해서 관리하는 설정을 설명

<br>

## 주요 예시와 설정

- 예시1: 같은 패키지(`x.y.service`)의 `"*Service"` 이름을 가진 빈들에 대해 기본적인 트랜잭션 적용

```xml
<aop:pointcut id="serviceOperation"
  expression="execution(* x.y.service..*Service.*(..))"/>
<aop:advisor pointcut-ref="serviceOperation" advice-ref="txAdvice"/>
<tx:advice id="txAdvice">
  <tx:attributes>
    <tx:method name="get*" read-only="true"/>
    <tx:method name="*"/>
  </tx:attributes>
</tx:advice>
```

> 위 설정은 `fooService`, `barService` 같은 빈들이 `serviceOperation` 포인트컷에 걸려서 트랜잭션 동작이 적용됨

- 예시 2: 동일한 서비스 계층 내에서도 일부 빈만 다른 트랜잭션 설정을 갖도록 구성

```xml
<aop:pointcut id="defaultServiceOperation"
  expression="execution(* x.y.service.*Service.*(..))"/>
<aop:pointcut id="noTxServiceOperation"
  expression="execution(* x.y.service.ddl.DefaultDdlManager.*(..))"/>

<aop:advisor pointcut-ref="defaultServiceOperation" advice-ref="defaultTxAdvice"/>
<aop:advisor pointcut-ref="noTxServiceOperation" advice-ref="noTxAdvice"/>

<tx:advice id="defaultTxAdvice">
  <tx:attributes>
    <tx:method name="get*" read-only="true"/>
    <tx:method name="*"/>
  </tx:attributes>
</tx:advice>

<tx:advice id="noTxAdvice">
  <tx:attributes>
    <tx:method name="*" propagation="NEVER"/>
  </tx:attributes>
</tx:advice>
```

> `DefaultDblManager` 빈은 `noTxAdvice`가 적용되어 트랜잭션 없이 실행되고 다른 서비스 빈들은 기본 트랜잭션 규칙이 적용됨

<br>

## 활용 시점 & 유의사항

- 위 방식은 서비스 빈마다 요구사항이 다를 때 유용
  - 예를 들어, 어떤 서비스는 트랜잭션이 필요 없거나 데이터 베이스 변경 없이 단순 조회만 하는 경우에는 트랜잭션 설정을 다르게 함으로써 오버헤드를 줄일 수 있음
- 설정 복잡성이 증가할 수 있음
  - 포인트컷, advice, advisor 들이 많아질수록 관리가 힘들어질 수 있으니 명명 규칙, 패키지 구조, 빈 이름 규칙 등 미리 설계해 두는 것이 좋음
- XML 기반 설정 예지만, 동일한 개념이 `@Transactional` 어노테이션과 `Qualifier` 또는 `Custom Advice/Aspect` 를 통해서도 구현 가능