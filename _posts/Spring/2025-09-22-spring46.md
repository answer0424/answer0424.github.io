---
layout: post
title: 프로그래밍 방식 트랜잭션 관리
date: 2025-09-22 13:00:00 +09:00
categories: [Spring, DataAccess, Transaction Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념 정리: 프로그래매틱 트랜잭션 관리

> 프로그래매틱 방식이란 어노테이션이나 XML 설정 같은 선언적 방식 대신, 코드 내에서 직접 트랜잭션을 시작하고, 롤백 등을 제어하는 방식
>
> Spring에서는 `PlatformTransactionManager`, `TransactionStatus`, `TransactionDefinition`, `TransactionTemplate`같은 API와 class들을 써서 이걸 구현
>
> 또한 reactive 환경에서는 `ReactiveTransactionManager` & `TransactionalOperator`를 사용

## 주요 구성 요소 & 동작 흐름

#### PlatformTransactionManager

- 전통적인 트랜잭션을 관리하는 핵심 인터페이스
- 트랜잭션 시작, 커밋, 롤백 등의 기능 제공

<br>

#### DefaultTransactionDefinition

- 트랜잭션의 성격을 설정하는 객체
- 예: propagation, isolation, name, timeout 등

<br>

#### TransactionStatus

- 지금 트랜잭션이 어떤 상태인지 유지하는 객체
- `getTransaction()` 호출 시 이를 이용해 rollback/commit 호출

<br>

#### TransactionTemplate

- 콜백 기반 형식으로 트랜잭션 작업을 감싸서 실행하도록 간편화한 유틸리티
- boilerplate 코드를 줄여줌

<br>

#### ReactiveTransactionManager & TransactionalOperator

- 리액티브 환경에서 트랜잭션을 관리하는 인터페이스와 클래스
- 비동기/논블로킹 환경에서도 트랜잭션 경계를 설정 가능함

<br>

## 예시

```java

DefatultTransactionDefinition def = new DefaultTransactionDefinition();
def.setName("SomeTxName");
def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);

TransactionStatus status = txManager.getTransaction(def);

try {
    // 비즈니스 로직 수행
    txManager.commit(status);
} catch (SomeException ex) {
    txManager.rollback(status);
    throw ex;
}
```

> Reactive 예시도 유사하게 `ReactiveTransactionManager` + `TransactionalOperator` 사용해서 리액티브 스트림 안에서 commit/rollback 제어 가능

<br>

## 장단점

- 장점
  - 세밀한 제어 가능: 트랜잭션 이름, 타임아웃, 전파 방식 등 원하는 대로 코드 내에서 직접 설정 가능
  - 선언적 방식이 커버 안하는 복잡한 흐름들을 처리할 때 유연
  - 리액티브 환경에서도 reactive 트랜잭션 동작을 코드로 제어할 수 있음
- 단점
  - 코드가 늘어나고 비즈니스 로직에 트랜잭션 관련 코드가 섞이게 됨
  - 유지보수가 어려워질 수 있음
  - 선언적 방식에 비해 오류 가능성과 boilerplate 코드 증가
  - 코드 간 중복 방생 가능
  - 리액티브 및 non-reactive 방식 간의 혼용 시 주의 필요

<br>

## 정리

> 프로그래매틱 트랜잭션 관리는 `PlatformTransactionManager` 등 API를 사용해 코드 내에서 트랜잭션을 직접 시작,커밋,롤백하고 필요 시 `TransactionTemplate`이나 `TransactionalOperator`를 이용해 트랜잭션 속성을 세밀히 제어할 수 있게 해주는 방식