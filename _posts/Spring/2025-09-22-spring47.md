---
layout: post
title: Transaction-bound Events
date: 2025-09-22 13:00:00 +09:00
categories: [Spring, DataAccess, Transaction Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념

- Spring 4.2부터 이벤트 리스너를 트랜잭션의 특정 단계에 묶어서 실행할 수 있게 됨
- 평소 일반 이벤트 리스너는 `@EventListener`를 쓰면 되고, 트랜잭션 경계와 연동된 이벤트 리스너가 필요하면 `@TransactionalEventListener` 어노테이션을 사용
- 이벤트를 publish한 트랜잭션이 커밋된 뒤에만 리스너가 처리되도록 하고 싶을 때 유용함
- 예: 주문을 저장하고 트랜잭션이 정상 완료된 후에만 알림 또는 후속 작업을 수행

<br>

## 주요 속성 및 설정

| 속성 | 역할 / 옵션 |
|-|-|
| `phase` | 이벤트를 어떤 트랜잭션 단계에 바인딩할지 설정(`BEFORE_COMMIT`, `AFTER_COMMIT`, `AFTER_ROLLBACK`, `AFTER_COMPLETION`) |
| `fallbackExecution` | 만약 이벤트가 트랜잭션 안에서 발행되지 않았다면, 이 리스너가 실행될지 여부를 설정(기본값 `false`) |
| `classes` 또는 `value` | 어떤 이벤트 타입을 처리할지 지정 `(@TransactionalEventListener(classes = ...)` 또는 `value`로 설정 가능| 
| `condition` | SpEL 표현식으로 조건을 주어서, 이벤트의 특정 속성 등을 보고 실행 여부를 결정할 수 있음 |

<br>

## 제약 및 유의사항

- 이벤트가 트랜잭션 없이 발행되면, 해당 리스너는 호출되지 않음
- 트랜잭션이 커밋되거나 롤백 완료된 이후에 이벤트 리스너가 실행되면, 트랜잭션 리소스가 여전히 접근 가능한 상태일 수도 있으나 이때 변경은 커밋되지 않음
- 6.1 버전부터는 반응형 트랜잭션도 지원
- `@EventListener`와 `@TransactionalEventListener`를 혼용할 수 있음

<br>

## 예제

```java
@Component
public class MyListener {

    @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT, classes = OrderCreatedEvent.class)
    public void onOrderCreated(OrderCreatedEvent event) {
        // 주문 저장 트랜잭션이 정상 커밋된 후 처리
    }
}
```

- 위 예시 코드는 `OrderCreatedEvent` 타입의 이벤트를 트랜잭션 커밋 이후에만 처리함
- 트랜잭션 없이 이벤트를 발행하면 이 리스너는 실행되지 않음

<br>

## 정리

> `Transaction-bound Events`는 `@TransactionalEventListener` 어노테이션을 통해 이벤트 리스너를 트랜잭션의 특정 단계에 바인딩함으로써, 이벤트 처리를 트랜잭션의 결과에 따라 안전하게 실행할 수 있게 해주는 기능