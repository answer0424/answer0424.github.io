---
layout: post
title: Controlling Database Connections
date: 2025-09-23 09:00:00 +09:00
categories: [Spring, DataAccess, Transaction Management, JDBC]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 주요 구성 요소 및 동작 방식

#### DataSource

- Spring JDBC 작업 시 기본적으로 `DataSource` 인터페이스를 통해 커넥션을 획득
- `DataSource`는 JDBC 표준이고, 연결 풀 또는 테스트용 단순 구현체 등을 설정하는 역할

<br>

#### DriverManagerDataSource

- 테스트 용도 등 단순한 환경에서 사용되는 `DataSource` 구현체들
- 연결 풀 기능없음 ➡️ 여러 요청이 반복될 경우 성능 저하
- 프로덕션보다는 개발/테스트 환경용으로 적합

<br>

#### SmartDataSource

- Spring이 제공하는 확장된 인터페이스
- `DataSource`를 상속하고, 커넥션을 닫을 필요가 있는지 등의 상태 등을 묻는 기능
- 여러 커넥션을 재사용해야 할 때 효율적

<br>

#### TransactionAwareDataSourceProxy

- 트랜잭션이 걸려 있을 때, `DataSource`가 반환하는 커넥션이 트랜잭션-연계가 고려된 커넥션이 되도록 감싸는 프록시
- 트랜잭션이 없는 상태에서는 일반 `DataSource`와 동일하게 동작
- 이를 통해 트랜잭션 내부에서 얻는 커넥션이 적절히 관리되도록 보장

<br>

#### DataSourceTransactionManager / JdbcTransactionManager

- 하나의 `DataSource`만을 사용하는 트랜잭션 매니저 구현체임
- 해당 데이터 소스의 커넥션을 스레드-바인딩 방식으로 관리하여, 트랜잭션 범위 내에서는 같은 커넥션을 재사용하고, 커밋 또는 롤백할 때 적절히 행동

<br>

#### DataSourceUtils

- Spring 내부 유틸 클래스
- `getConnection(DataSource)` 같은 메서드를 제공해서, 트랜잭션이 존재하면 트랜잭션에 연결된 커넥션을 반환하고, 그렇지 않으면 새 커넥션 요청
- 코드가 트랜잭션 여부에 상관없이 커넥션 획득/반환 로직을 일관되게 사용할 수 있음

<br>

## 유의사항

- 테스트 또는 개발 환경에서는 `DriverManagerDataSource` 같은 단순 구현체를 사용해도 되지만, 실제 운영 환경에서는 커넥션 풀에 있는 데이터소스를 사용해야 성능, 자원 관리 측면에서 효율적임
- 트랜잭션이 걸린 상태에서 커넥션 획득 시 반드시 Spring의 유틸리티를 사용하는게 좋음
- 그렇지 않으면 트랜잭션 경계 밖에서 예기치 않은 커넥션이 새로 열리거나 반대로 커넥션이 제대로 닫히지 않을 수 있음
- `TransactionAwareDataSourceProxy`같은 프록시를 사용하면 코드 상에서 `DataSource` 직접 쓸 때도 트랜잭션-연계가 되도록 보장 가능