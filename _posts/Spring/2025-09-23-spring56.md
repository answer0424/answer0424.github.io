---
layout: post
title: Hibernate
date: 2025-09-23 09:00:00 +09:00
categories: [Spring, DataAccess, Transaction Management, ORM]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 주요 기능과 구성 요소

#### SessionFactory 설정

- `LocalSessionFactoryBean`으로 `SessionFactory`를 Spring 빈으로 등록
- 데이터 소스, 매핑 리소스, Hibernate 설정 속성 등을 설정 가능
- `SessionFactory` 빈은 데이터 소스의 JDBC 연결 기반, 매핑 엔티티/매핑 파일, 방언 등 Hibernate 설정을 포함

<br>

#### DAO 구현 스타일

- Hibernate API를 직접 사용하는 방식이 권장
- DAO가 Hibernate의 `SessionFactory`를 주입받고, `sessionFactory.getCurrentSession()`등을 이용해 `Session`을 가져와 CRUD 작업 수행

<br>

#### 트랜잭션 관리 전략

- `HibernateTransactionManager`를 사용해 Hibernate `SessionFactory` 기반의 로컬 트랜잭션을 관리하거나, 분산 트랜잭션이 필요하면 JTA TransactionManager 사용 가능
- Spring의 선언적 트랜잭션(`@Transactional`) 혹은 XML/AOP 기반의 트랜잭션 어드바이스를 통해 트랜잭션 경계를 지정

<br>

#### 리소스 관리: 세션 바인딩

- Spring은 트랜잭션 범위 내에서 Hibernate `Session`을 현재 스레드와 바인딩하여 재사용 가능하게 함
- 동일 트랜잭션 내 여러 DAO 호출 시 동일한 `Session`이 사용되며, 커밋/롤백 시점에 적절한 동작이 가능
- Hibernate JDBC `Connection`을 노출하거나 JDBC 코드와 혼합 사용할 경우에도 동일한 트랜잭션 맥락이 유지

<br>

#### 예외 변환

- Hibernate의 `HibernateException` 등을 Spring의 `DataAccessException` 계층으로 감싸서 던짐으로써, 어플리케이션 코드가 Hibernate 특유의 예외에 의존하지 않게 함

<br>

#### 유연성/기술 교체 용이성

- Hibernate 설정을 변경하거나, Hibernate 대신 JPA 구현체를 사용하더라도 비즈니스 계층은 가능한 한 Hibernate API 또는 공통 API를 사용하여 기술 종속성을 낮추는 것이 좋음
- Spring의 설정 대부분은 configuration만 바꿔서 사용 가능 


<br>

## 유의사항

- 세션 관리와 Lazy Loading: Hibernate `Session`이 언제 열리고 닫히는지
- Lazy Loading이 필요한 엔티티 관계가 세션 범위 내에서 사용되는지 주의
- Open Session in View 패턴(OSIV) 같은 경우 요청 종료 시점까지 세션을 유지하는 패턴이지만, 남발하면 성능/트랜잭션 경계 문제가 발생할 수 있음
- 트랜잭션 경계(self-invocation)
  - 같은 클래스 내부 메서드 호출(self-invoke)에서는 proxy 또는 트랜잭션 interceptor가 적용되지 않을 수 있음
  - Hibernate 코드에서도 트랜잭션 외부에서 세션이 자동으로 열려 있지 않다면 예외 발생 가능
- 성능 관련 설정
  - 캐시, 벌크 작업, JDBC 연결, flush 전략 배치 등을 적절히 설정해야 함

<br>

## 정리

> Spring의 Hibernate 통합은 `SessionFactory` 설정, 선언적/프로그래매틱 트랜잭션 관리, 세션 바인딩, 예외 변환, DAO 구현 스타일 지원 등을 통해 Hibernate를 Spring 환경 안에서 유연하고 일관성 있게 사용해주는 기능