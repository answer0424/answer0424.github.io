---
layout: post
title: Interceptors
date: 2025-09-25 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, DispatcherServlet]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 요약

> `DispatcherServlet`이 핸들러 매핑을 할 때, 매핑된 핸들러에 대해 인터셉터 체인을 구성하고 실행하는 과정을 다루고 있음

<br>

## 주요 내용

- `HandlerMapping`이 요청 경로 등을 기준으로 핸들러를 결정할 때, 단순히 핸들러만 반환하는 게 아니라, 핸들러 + 인터셉터 리스트를 포함한 `HandlerExecutionChain` 객체를 반환
- 인터셉터는 `MappedInterceptor` 형태로 매핑조건을 가질 수 있고, `HandlerMapping`이 이 조건에 맞는지 필터링하여 실행 대상 인터셉터를 체인에 포함
- 인터셉터는 요청 핸들러가 실행되기 전/후/최종 완료 시점에 훅을 걸 수 있는 메서드들을 제공함
- 인터셉터는 요청 핸들러가 실행되기 전/후/최종 완료 시점에 훅을 걸 수 있는 메서드들을 제공
- **요청 흐름 처리**
  - 1. `HandlerMapping` ➡️ `HandlerExecutionChain` 획득(핸들러 + 인터셉터 체인)
  - 2. 인터셉터 체인의 `preHandler()`들이 순서대로 호출
  - 3. `HandlerAdapter`가 핸들러를 실행
  - 4. 핸들러 실행 완료 후, 인터셉터 체인의 `postHandle()`들이 역순으로 호출
  - 5. 뷰 렌더링 등 응답 처리 끝난 뒤, 인터셉터 체인의 `afterCompletion()`들이 역순을 호출
- 만약 `preHandle()` 메서드에서 `false`를 반환하면 그 이후의 인터셉터나 핸들러 실행 자체가 중단될 수 있음
- 예외 발생이나 핸들러 실행 중단 등 다양한 상황을 고려해서 `afterCompletion()`은 반드시 호출될 수 있게 설계됨
- Java 설정 방식에서는 `WebMvcConfigurer`의 `addInterceptors(InterceptorRegistry registry)` 메서드를 통해 인터셉터를 등록할 수 있고, XML 방식에서는 `<mvc:interceptors>`등을 사용
- 인터셉터 적용 시 패스 패턴 등으로 특정 URL만 걸리게 할 수 있음