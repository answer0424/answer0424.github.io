---
layout: post
title: Multipart Resolver
date: 2025-09-29 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, DispatcherServlet]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 핵심 기능

- Multipart 요청이 들어오면 HTTP 요청이 `multipart/form-data`가 이를 감지하고 내부적으로 요청을 파싱해서 일반 파라미터와 파일 파트들을 `MultipartFile` 객체 등으로 변환
- 컨트롤러 메서드에서는 `@RequestParam("file") MultipartFile file` 같은 식으로 파일을 받을 수 있음
- 여러 파일을 받은 경우 `List<MultipartFile>`이나 `MultipartFile[]` 등으로 선언 가능
- 복잡한 multipart 요청인 경우 `@RequestPart` 어노테이션을 써서 JSON 파트 + 파일 파트 등을 분리해서 받을 수 있음
- 바인딩 대상 객체 내부 필드에 `MultipartFile`을 선언해서도 바인딩 가능

```java
class MyForm {
    private String name;
    private MultipartFile file;
    // getters/setters
}
```

> 이 경우 컨트롤러는 `public String handleFormUpload(MyForm form)`과 같이 받을 수 있음

<br>

## 설정 방법 & 구현체

#### `StandardServletMultipartResolver`

- 서블릿 3.0 이상 환경에서 기본 multipart 지원을 이용하는 구현
- 추가 라이브러리 없이 가능

<br>

#### `CommonsMultipartResolver`

- Apache Commons FileUpload 라이브러리를 기반으로 한 구현체

<br>

## 설정 예시 (Java / XML)

```xml
<bean id="multipartResolver"
    class="org.springframework.web.multipart.commons.CommonsMultipartResolver"/>
```

또는 Commons 기반:

```xml
<bean id="multipartResolver"
    class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
    <property name="maxUploadSize" value="10485760"/> <!-- 10MB -->
</bean>
```

<br>

또한 `web.xml` 또는 Servlet 설정에서 `<multipart-config>` 등을 설정할 수 있음

- Java 설정 (Spring Boot / Java Config 방식)

```java
@Bean
public StandardServletMultipartResolver multipartResolver() {
    return new StandardServletMultipartResolver();
}
```

또는 DispatcherServlet 등록 시 `MultipartConfigElemnt` 설정을 통해 최대 크기, 임시 저장 위치 등을 지정해 줄 수 있음

- DispatcherServlet 등록 시 예:

```java
registration.setMultipartConfig(new MultipartConfigElement(tempDir, maxFileSize, maxRequestSize, fileSizeTheshold));
```

<br>

## 예제 및 주의점

```java
@PostMapping("/upload")
public String handleFileUpload(@RequestParam("name") String name,
                               @RequestParam("file") MultipartFile file) throws IOException {
    if (!file.isEmpty()) {
        byte[] bytes = file.getBytes();
        // 파일 저장 로직 등
        return "redirect:/uploadSuccess";
    }
    return "redirect:/uploadFail";
}
```

<br>

```java
@PostMapping(path = "/multi", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
public String handle(@RequestPart("meta") MetaData meta,
                     @RequestPart("file") MultipartFile file) {
    // meta 객체 + 파일 처리
}
```

- 폼 태그에서 `enctype="multipart/form-data"` 반드시 지정해야 함
- `@RequestParam`대신 `@RequestPart`를 써야 하는 경우도 있음
- 파일 크기 제한, 총 요청 크기 제한 등의 설정이 필요 (예: `MultipartConfigElement`, `maxUploadSize` 등)
- 업로드한 파일이 커질 경우 메모리/디스크 부담 고려 필요

<br>