---
layout: post
title: Validation
date: 2025-10-13 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, Controller]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## Spring MVC의 유효성 검증 개요

- Spring MVC는 `@RequestMapping` 메서드에 대해 검증을 기본적으로 지원
- 검증은 다음 두 수준에서 적용될 수 있음
  - 메서드 인자 수준 검증(**argument level validation**)
  - 메서드 수준 검증(**method-level validation**)
- 어떤 검증 예외가 던져지는지는 컨트롤러 메서드 시그니처에 따라 달라짐
  - `MethodArgumentNotValidException`
  - `HandlerMethodValidationException`

<br>

## 검증 방식 및 발생 조건

#### 메서드 인자 수준 검증

- `@ModelAttribute`, `@RequestBody`, `@RequestPart`와 같은 인자 리졸버가 검증을 수행할 수 있음
- 충족되어야 할 조건들
  - 해당 메서드 파라미터에 `@Valid` 또는 Spring `@Validated`가 붙어 있어야 함
  - 그 파라미터 바로 뒤에 `Errors` 또는 `BindingResult` 타입의 인자가 없어야 함
  - 메서드 수준 검증이 필요없는 경우
- 이 경우 검증 실패 시 `MethodArgumentNotValidException`이 발생

<br>

#### 메서드 수준 검증

- 메서드의 파라미터 또는 반환값에 직접 `@Constraint` 어노테이션을 붙인 경우, 메서드 수준 검증이 적용됨
- 메서드 수준 검증은 `@Valid` 만으로는 트리거되지 않으며, `@Constraint` 어노테이션이 직접 붙어 있어야 함
- 이 경우 검증 실채 시 `HandlerMethodValidationException`이 발생

<br>

## 예제 코드

#### 메서드 인자 수준 검증 예제

```java
@RestController
public class UserController {
    @PostMapping("/users")
    public ResponseEntity<String> createUser(@Valid @RequestBody UserDTO user) {
        return ResponseEntity.ok("User created");
    }
}
```

- `UserDTO` 클래스에는 `@NotNull`, `@Size` 등 JSR-380 제약 어노테이션이 붙어 있어야 함
- 만약 검증 오류가 발생하면 Spring은 자동으로 예외를 던지는 방식으로 처리

####

```java
@RestController
public class OrderController {
    @PostMapping("/orders")
    public ResponseEntity<String> placeOrder(
        @NotBlank @RequestParam String productId,
        @Min(1) @RequestParam int quantity
    ) {
        return ResponseEntity.ok("Order placed");
    }
}
```

- 여기서 `productId`와 `quantity` 파라미터에 직접 제약 어노테이션이 붙어 있으므로, 메서드 수준 검증이 사용됨
- 검증 실패 시 `HandlerMethodValidationException`이 발생

<br>

## 예외 처리 및 커스터마이징

- 어플리케이션에서는 `MethodArgumentNotValidException`과 `HandlerMethodValidationException`을 모두 처리해야 함
- 예외 처리 방식으로는 `@ExceptionHandler`메서드를 사용하거나 `ResponseEntityExceptionHandler`를 확장하는 방법이 있음
- `HandlerMethodValidationException`에는 `ParameterValidationResult` 리스트가 포함되어 있어서, 파라미터별 검증 결과를 그룹별로 처리할 수 있음
- 에러 응답 형식, 메시지 번들, 지역화 등을 통해 예외 응답을 조정할 수 있음