---
layout: post
title: Controller Advice
date: 2025-10-13 13:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, Controller]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## `@ControllerAdvice` / `@RestControllerAdvice` 개념 및 역할


- `@ControllerAdvice`는 전역 수준에서 공통 기능을 여러 컨트롤러에 적용할 수 있게 해주는 어노테이션
- `@RestControllerAdvice`는 `@ControllerAdvice` + `@ResponseBody`를 결합한 형태로, 주로 REST API의 예외 처리 등에 사용 
- 즉, 예외 처리 메서드들이 자동으로 응답 본문 형태로 반환됨을 의미
- `@ControllerAdvice`는 `@Component`로 메타 어노테이션이 붙어 있어서, 컴포넌트 스캔을 통해 빈으로 등록

#### 적용 범위 제어

> 기본적으로 `@ControllerAdvice`는 어플리케이션의 모든 컨트롤러에 적용

- `annotations` ➡️ 특정 어노테이션이 붙은 컨트롤러만 적용
- `assignableTypes` ➡️ 특정 타입 또는 하위 타입에만 적용
- `basePackages` 또는 `value` ➡️ 특정 패키지의 컨트롤러만 적용

<br>

## `@ControllerAdvice` 내부 동작 & 우선순위

- `RequestMappingHandlerMapping`이 `ExceptionHandlerExceptionResolver` 가 어플리케이션 시작 시점에 `@ControllerAdvice` 빈을 감지하고 등록
- 예외 처리 메서드 관점에서 보면, 로컬 컨트롤러 내의 `@ExceptionHandler`가 먼저 고려되며, 그 다음은 글로벌 `@ControllerAdvice`의 `@ExceptionHandler` 메서드가 적용
- 반대로, `@ModelAttribute` 및 `@InitBinder` 메서드는 전역 (`@ControllerAdvice`) 쪽이 먼저 실행되고 그 다음에 로컬 컨트롤러의 `@ModelAttribute`/`@InitBinder`가 실행

<br>

## 예제 코드

#### 공토 예외 처리

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(IOException.class) 
    public ResponseEntity<String> handleIOException(IOException ex) {
        return ResponseEntity
            .status(HttpStatus.INTERNAL_SERVER_ERROR)
            .body("I/O Error: " + ex.getMessage());
    }

    @ExceptionHandler(IllegalArgumentException.class)
    public ResponseEntity<String> handleIllegalArgument(IllegalArgumentException ex) {
        return ResponseEntity
            .status(HttpStatus.BAD_REQUEST)
            .body("Bad Request: " + ex.getMessage());
    }
}
```

- 이 클래스 내의 `@ExceptionHandler` 메서드들은 어플리케이션 전역의 컨트롤러들에서 발생한 해당 예외들을 처리할 수 있음
- `@RestControllerAdvice` 덕분에 반환 타입이 `ResponseEntity<String>`이면 JSON 또는 텍스트 응답으로 클라리언트에게 전달됨

<br>


#### 적용 대상 제한

```java
@ControllerAdvice(annotations = RestController.class)
public class RestOnlyAdvice {
    // 이 Advice는 @RestController가 붙은 컨트롤러에만 적용됨
}

@ControllerAdvice("com.example.myapp.controllers")
public class PackageScopedAdvice {
    // 이 Advice는 com.example.myapp.controllers 패키지 안의 컨트롤러에만 적용됨
}

@ControllerAdvice(assignableTypes = {UserController.class, AdminController.class})
public class SpecificControllersAdvice {
    // 이 Advice는 UserController 또는 AdminController 타입에만 적용됨
}
```

- 이런 방식으로 `@ControllerAdvice`가 작동할 범위를 제한할 수 있음
- 다만 문서에서는 이렇게 제한하는 것이 런타임 성능에 영향을 줄 수 있으므로, 필요한 경우에만 사용할 것이라고 경고

<br>

## 주요 포인트 및 사용 팁

| 항목 | 설명 / 팁 |
|---|---|
| 전역 제어 | `@ControllerAdvice`는 전역 차원의 예외 처리, 바인딩 초기화, 모델 속성 추가 등에 유용 |
| 우선 순위 | 로컬 컨트롤러 내의 `@ExceptionHandler`가 먼저 처리되고 글로벌 `@ControllerAdvice`가  나중에 적용 |
| 실행 순서 | `@ControllerAdvice` 클래스의 `@ModelAttribute` / `@InitBinder` 메서드는 로컬 것보다 먼저 실행 |
| 반환 방식 다양성 | `@ExceptionHandler` 메서드에서는 `ResponseEntity`, `@ResponseBody, 뷰이름, `ModelAndView` 등 다양한 형태로 응답 가능 |
| 적용 범위 제한 주의 | `annotations`, `assignableTypes`, `basePackages` 등을 사용해 적용 범위를 제한할 수 있으나, 과도한 제한은 복잡성을 초래할 수 있음 |
| @RestControllerAdvice | REST API 중심 어플리케이션에서는 `@RestControllerAdvice`를 사용하면 응답 본문 형태로 예외 응답을 쉽게 구성할 수 있음 |