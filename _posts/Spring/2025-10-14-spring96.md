---
layout: post
title: CORS
date: 2025-10-14 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## CORS 개요 및 필요성

- 브라우저 보안 정책상 다른 출처에 대한 AJAX 요청은 기본적으로 차단됨
- CORS는 W3C 사양으로, 클라이언트가 특정 출처간 요청을 허용하도록 서버가 명시적으로 응답 헤더를 통해 허가할 수 있게 함
- Spring MVC는 CORS를 처리하는 기능을 내장하고 있으며, `HandlerMapping` ➡️ `HandlerMapping` 레벨 또는 어노테이션 방식으로 구성 가능

<br>

## 동작 방식 및 처리 흐름

- CORS 요청은 크게 Preflight 요청, Simple 요청, Actual 요청으로 구분됨
- Spring은 `HandlerMapping` 단계 뒤에 CORS 구성을 확인하고 사전 검사 요청은 직접 처리
- 만약 해당 요청에 대응하는 CORS 설정이 없으면
  - Preflight 요청은 403 응답
  - Simple/Actual 요청에 대해서는 응답 헤더에 CORS 관련 헤더가 붙지 않아 브라우저가 요청을 거부하게 됨
- CORS 설정은 전역 수준과 로컬 수준을 조합해서 사용 가능
- 전역 설정은 보통 병합 방식으로 적용됨. 다만 일부 속성은 로컬 설정이 전역을 override 함

<br>

## `@CrossOrigin` 어노테이션 방식

- `@CrossOrigin`을 컨트롤러 클래스나 메서드에 붙이면 해당 엔드포인트에 대해 CORS 허용 설정을 할 수 있음
- 기본 설정은 다음과 같은
  - 모든 origin 허용
  - 모든 헤더 허용
  - 메서드에 매핑된 HTTP 메서드 허용
  - `allowCredentials` 기본값은 `false`

```java
@RestController
@RequestMapping("/account")
public class AccountController {
    @CrossOrigin
    @GetMapping("/{id}")
    public Account retrieve(@PathVariable Long id) {
        // ...
    }

    @DeleteMapping("/{id}")
    public void delete(@PathVariable Long id) {
        // ...
    }
}
```

<br>

## 전역 CORS 설정

#### Java 설정 방식(WebMvcConfigurer)

- `WebMvcConfigurer`의 `addCorsMappings` 메서드를 오버라이드 하여 전역 CORS 매핑을 설정할 수 있다

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**")
            .allowedOrigins("https://example.com")
            .allowedMethods("GET", "POST", "PUT", "DELETE")
            .allowedHeaders("Authorization", "Content-Type")
            .allowCredentials(true)
            .maxAge(3600);
    }
}
```

- 이 방식의 기본 전역 설정은
  - 모든 출처 허용
  - 모든 헤더 허용
  - `GET`, `HEAD`, `POST` 메서드 허용
  - `allowCredentials = false`
  - `maxAge = 1800` (30분)

<br>