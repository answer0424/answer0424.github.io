---
layout: post
title: FreeMarker
date: 2025-10-15 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, View Technologies]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- FreeMarker는 일반 텍스트, HTML, 이메일 등 다양한 출력 형식을 생성할 수 있는 템플릿 엔진
- Spring Framework는 Spring MVC 컨트롤러와 FreeMarker 템플릿 엔진을 결합하여 뷰 렌더링을 지원하는 내장 통합 기능을 제공
- 즉, 컨트롤러가 뷰 이름을 반환하면 FreeMarker 템플릿과 모델 데이터를 병합하여 최종 렌더링된 뷰를 클라이언트에 응답할 수 있게 됨

<br>

## 뷰 구성(View Configuration)

#### Java + Spring 설정

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void configureViewResolvers(ViewResolverRegistry registry) {
        registry.freeMarker();
    }

    @Bean
    public FreeMarkerConfigurer freeMarkerConfigurer() {
        FreeMarkerConfigurer configurer = new FreeMarkerConfigurer();
        configurer.setTemplateLoaderPath("/WEB-INF/views/");
        configurer.setDefaultEncoding(StandardCharsets.UTF_8);
        return configurer;
    }
}
```

- `configureViewResolvers`에서 `registry.freeMarker()` 호출하면 FreeMarker 뷰 리졸버가 설정됨
- `FreeMarkerConfigurer` 빈을 등록해서 템플릿 로더 경로, 문자 인코딩 등을 지정
- 위 설정이 있으면, 컨트롤러가 `"welcome"` 같은 뷰 이름을 반환하면 `/WEB-INF/views/welcome.ftl` 템플릿이 사용됨

<br>

#### XML 설정 


```xml
<mvc:annotation-driven/>

<mvc:view-resolvers>
  <mvc:freemarker/>
</mvc:view-resolvers>

<mvc:freemarker-configurer>
  <mvc:template-loader-path location="/WEB-INF/freemarker"/>
</mvc:freemarker-configurer>
```

- `mvc:freemarker` 태그를 이용해 뷰 리졸버를 설정할 수 있음
- `mvc:freemarker-configurer` 태그로 `FreeMarkerConfigurer` 설정 가능

#### FreeMarker 설정 확장

- `FreeMarkerConfigurer`에는 `freemarkerSettings` 프로퍼티로 FreeMarker의 `Configuration` 설정을 직접 전달할 수 있음
- 또한 `freemarkerVariables` 프로퍼티를 이용해 템플릿 내에서 공통으로 사용될 변수를 정의할 수 있음

```xml
<bean id="freemarkerConfig" class="org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer">
  <property name="templateLoaderPath" value="/WEB-INF/freemarker/"/>
  <property name="freemarkerVariables">
    <map>
      <entry key="xml_escape" value-ref="fmXmlEscape"/>
    </map>
  </property>
</bean>

<bean id="fmXmlEscape" class="freemarker.template.utility.XmlEscape"/>
```

<br>

## 폼처리 & 바인딩

- Spring MVC는 JSP에서 제공하는 `<spring:bind>` 태그에 대응하는 FreeMarker용 매크로들을 제공
  - 이 메크로들은 FreeMarker 템플릿 안에서 폼 데이터를 바인딩하고 검증 오류를 출력하는 등의 기능을 도움
- FreeMarker 템플릿 파일 안에서는 먼저 `spring.ftl` 매크로 파일을 import 해서 매크로 사용 네임스페이스를 정의해야 함

```ftl
<#import "/spring.ftl" as spring/>
```

- 그 뒤 `spring:bind` 같은 매크로를 사용하여 폼 필드 바인딩, 오류 표시 등을 할 수 있음
- 예: 폼 필드에 기본값을 채우거나 오류 메시지를 출력할 때 유용

<br>

## FreeMarkerView 클래스 & 내부 동작

- `FreeMarkerView` 클래스는 Spring MVC에서 FreeMarker 기반 뷰 구현체
- 내부적으로 모델 데이터를 FreeMarker의 `Template`과 병합하고, 그 결과를 `HttpServletResponse`에 출력하는 역할
- 주요 기능
  - `setEncoding(..)`, `setCharset(..)`등을 통해 템플릿 파일의 문자 인코딩을 지정할 수 있음
  - `renderMergedTemplateModel(..)` 메서드를 통해 모델과 템플릿을 병합하고 응답 스트림에 쓰는 작업을 수행
  - 템플릿 존재 여부 확인 (`checkResource(...)`) 기능도 제공

<br>

## 요약 정리 & 유의살사항 팁

- Spring MVC와 FreeMarker의 통합은 비교적 간단하게 설정 가능하며, `FreeMarkerConfigurer` + FreeMarker 뷰 리졸버 구성을 통해 템플릿 렌더링 시스템을 구성할 수 있음
- 폼 바인딩 및 검증과 관련된 기능은 FreeMarker용 매크로 (`spring.ftl`)를 활용하여 JSP에서와 유사한 방식으로 구현 가능
- FreeMarker 템플릿 파일 경로, 인코딩, 공유 변수 설정 등을 꼼꼼히 설정해 주는 것이 주요
- `FreeMarkerView` 내부 동작 방식도 이해하면 커스터 마이징할 때 유리