---
layout: post
title: Error Responses
date: 2025-10-15 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- REST API에서는 예외 발생 시 단순히 HTTP 상태 코드만 전달하는 것보다 응답 본문에 에러 상세 정보를 담는 것이 일반적
- Spring Framework는 RFC 9457 규격을 기반으로, 보다 구조화된 에러 응답을 지원
- 주요 추상 개념
  - `ProblemDetail`: RFC 9457 규격에 맞춘 에러 응답 표현 객체(표준 필드 + 추가 필드)
  - `ErrorResponse`: HTTP 상태, 헤더 그리고 RFC 9457 형식의 본문을 포함하는 응답 객체
  - `ErrorResponseException`: `ErrorResponse` 구현의 기본 클래스로 활용 가능
  - `ResponseEntityExceptionHandler`: `@ContreollAdvice`용 기본 핸들러 클래스로, Spring MVC 내부 예외들과 `ErrorResponseException`을 처리하고 `ProblemDetail` 응답으로 렌더링 기능을 제공

<br>

## 동작 방식 및 사용법


#### `ProblemDetail` 또는 `ErrorResponse` 반환

- `@ExceptionHandler` 메서드 또는 `@RequestMapping` 메서드에서 `ProblemDetail` 또는 `ErrorResponse`를 반환 가능
- `ProblemDetail` 객체의 `status` 속성이 HTTP 응답 상태로 사용됨
- `ProblemDetail.instance` 속성이 비어 있다면, 기본적으로 현재 요청의 경로가 할당됨
- 콘텐프 협상을 수행할 때, Jackson `HttpMessageConverter`는 `application/problem+json` 미디어 타입을 우선적으로 고려하고, 만약 적합한 미디어 타입이 없으면 fallback으로 `application/json` 등을 사용

<br>

#### Spring MVC 예외도 RFC 9457 응답으로 처리하기

- Spring MVC가 자체적으로 발생시키는 다양한 예외도 `ResponseEntityExceptionHandler` 확장을 통해 `ProblemDetail` 응답으로 처리할 수 있음
- 즉, 예외 ➡️ `ErrorResponse` 또는 `ProblemDetail` ➡️ 클라이언트 응답 흐름이 일관된 패턴으로 동작
- `ResponseEntityExceptionHandler`에 `@ControllerAdvice`를 붙이면, 전역 예외 처리가 되며 필요에 따라 더 많은 예외 처리 메서드를 추가할 수 있음

<br>

#### 비표준 필드 추가

- RFC 9457 규정에 없는 추가 정보를 응답 본문에 포함하려면, 두 가지 방식이 있음
  - `ProblemDetail`의 `properties` 맵에 값을 삽입
    - Jackson의 mixin 덕분에 이 `properties` 맵이 JSON 직렬화 시 최상위 필드로 풀어져서 응답됨
  - `ProblemDetail`을 확장한 서브클래스를 만들고, 해당 클래스에 별도 필드를 두는 방식
    - `ProblemDetail`의 복사 생성자를 활용해 기존 `ProblemDetail`로부터 손쉽세 변환 가능

<br>

