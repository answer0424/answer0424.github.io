---
layout: post
title: Script Views
date: 2025-10-16 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, View Technologies]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- Spring MVC는 JSR-223 스크립팅 엔진 기반의 템플릿 라이브러리들을 뷰로 사용할 수 있게 통합을 지원
- 대표적으로 `Mustrache`, `Handlebars` 등 다양한 템플릿 엔진과 연동 가능함
- 중요한 전제는 사용하는 스크립트 엔진이 `ScriptEngine` 및 `Invocable` 인터페이스를 구현해야 한다는 점

<br>

## 설정 방법

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void configureViewReolvers(ViewResolverRegistry registry) {
        registry.scriptTemplate();
    }

    @Bean
    public ScriptTemplateConfigurer configurer() {
        ScriptTemplateConfigurer configurer = new ScriptTemplateConfigurer();
        configurer.setEngineName("nashorn"); 
        configurer.setScripts("mustache.js");
        configurer.setRenderObject("Mustache");
        configurer.setRenderFunction("render");
        return configurer;
    }
}
```

- `registry.scriptTemplate()` 호출로 스크립트 템플릿 리졸버 활성화됨
- `ScriptTemplateConfigurer` 빈은 스크립트 엔진 이름, 로드할 스크립트 파일, 렌더링 객체 및 함수 이름 등을 설정하는 역할을 함

#### XML 설정 방식


```xml
<mvc:annotation-driven/>
<mvc:view-resolvers>
  <mvc:script-template/>
</mvc:view-resolvers>

<mvc:script-template-configurer engine-name="nashorn" render-object="Mustache" render-function="render">
  <mvc:script location="mustache.js"/>
</mvc:script-template-configurer>
```

- `<mvc:script-template>` 태그로 스크립트 기반 뷰 리졸버 활성화
- `<mvc:script-template-configurer>` 태그로 엔진 이름, 스크립트 위치, 렌더링 함수 등의 속성 설정 가능

<br>

## 뷰 동작 방식 / 템플릿 구조

```java
@Controller
public class SampleController {
    @GetMapping("/sample")
    public String test(Model model) {
        model.addAttribute("title", "Sample title");
        model.addAttribute("body", "Sample body");
        return "template";
    }
}
```

- 위 컨트롤러의 Mustache 템플릿 예시

```mustache
<html>
  <head>
    <title>{{title}}</title>
  </head>
  <body>
    <p>{{body}}</p>
  </body>
</html>
```

- 스프링은 내부적으로 `renderFunction(template, model, renderingContext)` 함수를 호출해서 템플릿 + 모델 데이터를 합성하고 응답을 생성
- `RenderingContext`는 어플리케이션 컨텍스트, 로케일, 템플릿 로더, 요청 URL 등에 대한 정보를 포함
- 스크립트 기반 뷰는 스크립트 엔진에 안전하게 동작해야 하므로, non-thread-safe 엔진을 사용할 경우 `sharedEngine = false` 설정이 필요 함

