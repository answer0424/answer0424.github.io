---
layout: post
title: Type Conversion
date: 2025-10-17 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, MVC config]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- Spring MVC는 기본적으로 숫자, 날짜 타입 등에 대해 formatter / converter를 내장 지원
- 또한 어노테이션 기반의 포맷팅도 지원
  - `@NumberFormat`
  - `@DateTimeFormat`
  - `@DurationFormat`
- 요청 파라미터나 폼 데이터 ➡️ 모델 객체 타입 변환 또는 뷰 렌더링 시 타입 ➡️ String 변환 시 이 기능이 동작

<br>

## 커스터 마이징: Formatter / Converter 등록

#### Javs 설정

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addFormatters(FormatterRegistry registry) {
        registry.addFormatter(new MyCustomFormatter());
        registry.addConverter(new MyCustomConverter());
    }
}
```

- `FormatterRegistry`는 `Formatter`와 `Converter`를 모두 등록할 수 있는 레지스트리
- `Formatter`는 특정 타입 ↔️ 문자열 간 형식 변환 책임이 있으며, 파라미터 유효성 검사나 뷰 렌더링에도 영향을 미침
- `Converter`는 일반적인 타입 간 변환에 사용됨

<br>

#### XML 설정

```xml
<mvc:annotation-driven conversion-service="conversionService"/>

<bean id="conversionService"
      class="org.springframework.format.support.FormattingConversionServiceFactoryBean">
  <property name="converters">
    <set>
      <bean class="com.example.MyConverter"/>
    </set>
  </property>
  <property name="formatters">
    <set>
      <bean class="com.example.MyFormatter"/>
    </set>
  </property>
  <property name="formatterRegistrars">
    <set>
      <bean class="com.example.MyFormatterRegistrar"/>
    </set>
  </property>
</bean>
```

- `<mvc:annotation-driven conversion-service="...">` 속성으로 커스텀 `ConversionService` 빈을 지정 가능
- `FormattingConversionServiceFactoryBean`을 빈으로 정의하고 내부에 `converters`, `formatters`, formatterRegistrars` 등을 설정할 수 있음
  
<br>

## 날짜/시간 포맷팅 특수 설정

- 브라우저의 `<input type="date">`, `<input type="time">`과 같은 HTML 폼 필드는 고정된 포맷을 사용하므로 Spring은 기본적으로 요청 로케일을 기준으로 날짜 값을 해석하지만, HTML 날짜 입력 필드의 표준 규격 설정이 필요할 수 있음
- 이럴 때 `DateTimeFormatAnnotationFormatterFactory`를 사용해 ISO 포맷 사용 옵션을 활성화할 수 있음
 
```java
@Configuration
public class DateTimeWebConfiguration implements WebMvcConfigurer {
    @Override
    public void addFormatters(FormatterRegistry registry) {
        DateTimeFOrmatterRegistrar registrar = new DateTimeFormatterRegistrar();
        registrar.setUseIsoFormat(true);
        registrar.registerFormatters(registry);
    }
}
```

- 위 설정 시 `LocalDate`, `LocalDateTime` 등 타입에 대해 ISO-8601 포맷이 기본 적용됨

<br>

## FormatterRegistrar & 고급 확장

- `FormatterRegistrar` SPI(Service Provider Interface)
- `FormatterConversionServiceFactoryBean`은 `formatterRegistrars` 프로퍼티를 통해 Registrar 객체들을 받아들이며, 내부적으로 등록 로직을 위임