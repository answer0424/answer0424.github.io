---
layout: post
title: Interceptor
date: 2025-10-17 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, MVC config]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념 및 역할

- 인터셉터는 HTTP 요청 처리 흐름의 전/후 단계에 개입하여 공통 처리가 가능하도록 하는 기능
- 주로 로깅, 인증/인가 체크, 응답 헤더 조작, 요청 시작/끝 타이밍 기록 등의 용도로 많이 사용됨
- Spring MVC 에서는 `HandlerInterceptor` 인터페이스를 구현하거나 이를 확장한 `HandlerInterceptorAdapter` 또는 람다 기반 인터셉터를 사용할 수 있음


<br>

## 등록 방식

```java
@Configuration
public class WebConfiguration implements WebMvcConfigurer {
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LocaleChangeInterceptor())
                .addPathPatterns("/**")
                .excludePathPatterns("/admin/**");
    }
}
```

```xml
<mvc:interceptors>
    <bean class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor"/>
    <mvc:interceptor>
        <mvc:mapping path="/**"/>
        <mvc:exclude-mapping path="/admin/**"/>
        <bean class="org.springframework.web.servlet.theme.ThemeChangeInterceptor"/>
    </mvc:interceptor>
</mvc:interceptors>
```

- `<mvc:interceptors>` 내부에 `<mvc:interceptor>` 구조로 매핑 조건과 제외 경로를 지정할 수 있음

<br>

## 인터셉터 메서드 흐름

| 메서드                                                                                   | 호출 시점                       | 기능/역할                                                          |
| ---------------------------------------------------------------------------------------- | ------------------------------- | ------------------------------------------------------------------ |
| `preHandle(HttpServletRequest, HttpServletResponse, Object handler)`                     | 컨트롤러 메서드 실행 이전       | 요청을 가로채거나, 조건 검사 ➡️ `false` 반환 시 실행 흐름 차단 가능 |
| `postHandle(HttpServletRequest, HttpServletResponse, Object handler, ModelAndView mav)`  | 컨트롤러 실행 후 뷰 렌더링 직전 | 모델 조작 혹은 뷰 관련 추가 처리 가능                              |
| `afterCompletion(HttpServletREquest, HttpServletResponse, Object handler, Exception ex)` | 뷰 렌더링 후                    | 리소스 정리, 예외 로깅, 성능 특정 종료 작업 등                     |


<br>

## 주의사항 및 팁

- URL 패턴 매칭 주의
  - 인터셉터의 `addPathPatterns` / `excludePathPatterns`를 적절히 설정해야, 불필요한 경로에 대해 인터셉터가 실행되는 것을 방지할 수 있음
- 보안 레벨 제한
  - 인터셉터를 보안 계층으로 완전히 신뢰하는 것은 바람직하지 않음
  - 인터셉터는 어노테이션 기반 경로 매핑과 타이밍이 맞지 않을 수 있으므로 보안 처리는 Spring Security 또는 서블릿 필터 쪽에서 수행하는 것이 좋음
- MappedIntercepter 재사용
  - Java 설정 방식은 `WebMvcConfigurer`가 관리하는 `handlerMapping`에만 인터셉터를 등록
  - 반면 XML 방식에서는 `MappedInterceptor` 빈이 생성되어 MVC 외의 다른 HandlerMapping에도 인터셉터가 적용될 수 있음
  - 만약 여러 `HandlerMapping` 간에 동일한 인터셉터를 재사용하고 싶다면, Java 설정에서는 `MappedInterceptor` 빈으로 등록해야 함