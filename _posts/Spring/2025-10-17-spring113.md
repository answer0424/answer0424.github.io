---
layout: post
title: Content Type
date: 2025-10-17 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, MVC config]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념 및 목적

- Content Negotiation은 클라이언트가 요청 시 원하는 응답 미디어 타입을 서버에게 알려주고 서버는 그에 맞는 표현으로 응답하는 메커니즘
- Spring MVC는 기본적으로 `Accept` 헤더를 기준으로 미디어 타입을 판단
- 즉, 클라이언트가 `Accept: application/json` 헤더를 보내면 JSON 응답을 선택하게 됨
- 하지만 URL 확장자, 쿼리 파라미터, 헤더 외의 방식 등을 기반으로 미디어 타입을 결정하도록 설정을 변경할 수 있음

<br>

## Spring에서의 설정 방법

```java
@Configuration
public class WebConfiguration implements WebMvcConfigurer {
    @Override
    public void configureContentNegotiation(ContentNegotiationConfigurer configurer) {
        configurer
            .mediaType("json", MediaType.APPLICATION_JSON)
            .mediaTpye("xml", MediaType.APPLICATION_XML);
    }
}
```

- 위 예제는 URL 확장자 `"json"` ➡️ `application/json`, `"xml"` ➡️ `application/xml` 매핑을 추가한 것
- 이 설정 외에도 `favorParameter(true)`나 쿼리 파라미터 이름을 지정할 수 있으며, 이를 통해 `?format=json` 같은 요청 방식도 허용할 수 있음

```xml
<mvc:annotation-driven content-negotiation-manager="contentNegotiationManager"/>

<bean id="contentNegotiationManager"
      class="org.springframework.web.accept.ContentNegotiationManagerFactoryBean">
  <property name="mediaTypes">
    <value>json=application/json, xml=application/xml</value>
  </property>
</bean>
```

- XML 구성 방식에서는 `ContentNegotiationManagerFactoryBean`을 정의하고 `mediaTypes` 속성에 확장자 ↔️ 미디어 타입 매핑을 설정
- 그 후 `<mvc:annotation-driven>`에 `content-negotiation-manager` 속성으로 연결

<br>

## 주요 옵션 및 전략

| 옵션 | 설명 |
|-|-|
| `mediaType(String extension, MediaType mediaType)` | URL 확장자 기반 매핑을 추가 |
| `favorParameter(boolean favor)` | 쿼리 파라미터 기반 매핑 허용 여부 |
| `parameterName(String name)` | 위 쿼리 파라미터 이름 지정 |
| `ignoreAcceptHeader(boolean ignore)` | `Accept` 헤더를 무시할지 여부 결정 |
| `useRegisteredExtensionOnly(boolean useRegisteredOnly)` | 미리 등록된 확장자만 허용할지 여부 |
| `defaultContentType(MediaType mediaType)` | 클라이언트가 특정 미디어 타입을 요청하지 않았을 때 기본 응답 타입 |

<br>

## 주의사항 및 팁

- URL 확장자 방식은 보안 또는 유지보수 측면에서 추천되지 않으며, 쿼리 파라미터 방식이 더 안전한 대체 방법으로 권장된다는 언급이 있음
- 기본적으로 Spring은 `accept` 헤더만을 기준으로 콘텐츠 협상을 수행하므로, 확장자나 파라미터 기반 방식은 명시적으로 설정해야 동작
- 확장자 매핑할 때 예를 들어 `.json` 또는 `.xml` 확장자는 REST API 환경에서 자주 충돌할 수 있으므로 주의해야 함
- `favorParameter(true)`를 허용했을 경우 파라미터 이름을 명확히 정해 두는 것이 좋음
- `ignoreAcceptHeader(false)`로 설정하면 `Accept` 헤더가 우선적으로 반영