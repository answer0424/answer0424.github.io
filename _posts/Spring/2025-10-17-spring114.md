---
layout: post
title: Message Converters
date: 2025-10-17 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, MVC config]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념 및 역할

- HTTP 요청/응답 본문을 Java 객체 ↔️ 표현 간에 변환하는 책임을 지는 컴포넌트들이 `HttpMessageConverter`
- Spring MVC는 여러 기본 메시지 변환기를 내장하고 있으며, 적절한 미디어 타입에 따라 가장 알맞는 변환기를 선택하여 동작
- 개발자는 기본 변환기 대신 또는 함께 커스텀 메시지 변환기를 등록하거나 조정할 수 있음

<br>

## 커스터마이징 방식

| 메서드 | 역할 | 주의점 |
|-|-|-|
| `configureMessageConverters(List<HttpMessageConverter<?>> converters)` | 기본 변환기들을 모두 제거하고 개발자가 직접 지정한 변환기만 사용하는 방식 | 기본 제공 변환기를 그대로 유지하고 싶다면 이 방식은 주의해서 사용할 것 |
| `extendMessageConverters(List<HttpMessageConverter<?>> converters)` | 기본 변환기 리스트 위에 추가하거나 보완하는 방식 | 기존 기본 변환 기능을 손대지 않고 확장할 때 유용 |

- 권장되는 방식은 `extendMessageConverters`, 기본 변환기의 기능을 유지하면서 필요한 변환기만 추가하는게 안전하기 때문
- Spring Boot 어플리케이션에서는 `WebMvcAutoConfiguration`이 자동으로 감지된 `HttpMessageConverter` 빈들을 기본 변환기 목록에 포함시킴
- 따라서 Boot 환경에서는 `extendMessageConverters` 또는 `HttpMessageConverters` 빈 방식이 더 적합함

<br>

## 예제

```java
@Configuration
public class WebConfiguration implements WebMvcConfigurer {
    @Override
    public void extendMessageConverters(List<HttpMessageConverter<?>> converters) {
        Jackson2ObjectMapperBuilder builder = new Jackson2ObjectMapperBuilder()
            .indentOutput(true)
            .dateFormat(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"))
            .modulesToInstall(new ParameterNamesModule());

        converters.add(new MappingJackson2HttpMessageConverter(builder.build()));
        converters.add(new MappingJackson2XmlHttpMessageConverter(builder.createXmlMapper(true).build()));
    }
}
```

- 이 설정은 JSON 변환기와 XML 변환기를 객체 매핑 설정을 공유하면서 구성하는 방식
- XML 변환기의 경우 `XmlMapper`를 생성하도록 `createXmlMapper(true)` 옵션을 사용해야 함
- 또한 JSON/XML 변환 시 사용하는 `ObjectMapper`/`XmlMapper`에 여러 Jackson 모듈이 자동 등록되는 기능도 포함되어 있음

<br>

## 유의사항 및 팁

- `configureMessageConverters`를 사용하면 기본 제공 변환기가 모두 제거되므로, JSON, Form, 기본 문자열/바이트 변환기 등 필요한 기능을 모두 직접 등록해야 함
- `extendMessageConverters` 방식은 기본 제공 변환기를 유기하면서 필요한 것만 추가하므로 대부분 상황에서 더 안전하고 유연한 선택
- Spring Boot 환경에서는 `HttpMessageConverters` 빈을 사용하는 방식 또는 `extendMessageConverters` 방식을 사용하는 것이 일반적
- 변환기 순서가 중요할 수 있으며, 특정 미디어 타입 응답이 제대로 변환되지 않는 경우 순서 문제일 가능성이 큼
- JSON/XML 변환 구성 시 날짜 형식, null 처리, 직렬화 옵션 등 `ObjectMapper`/`XmlMapper` 설정을 적절히 조정하는 것이 중요
- 