---
layout: post
title: Static Resources
date: 2025-10-20 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, MVC config]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- 웹 어플리케이션에서는 CSS, JS, 이미지, 폰트 등 정적 리소스를 `/css/..`, `/js/...` 같은 경로에 배치하여 제공하는 경우가 많음
- Spring MVC는 이러한 정적 리소스를 효율적으로 제공할 수 있도록 `ResourceHandlerRegistry`, `ResourceResolver`, `ResourceTransformer` 등의 API를 통해 구성할 수 있음
- 또한 브라우저 캐싱, 버전 관리 지원 등 다양한 옵션도 제공

<br>


## 설정 방법

#### Java 기반 설정

```java

@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/resources/**")
                .addResourceLocations("/public/", "classpath:/static/")
                .setCacheControl(CacheControl.maxAge(Duration.ofDays(365)))
                .resourceChain(true)
                .addResolver(new VersionResourceResolver().addContentVersionStrategy("/**"));

    }
}
```

- `addResourceHandler("/resources/**")` ➡️ `/resources/` URL 패턴의 요청을 정적 리소스로 처리
- `addResourceLocations(..)` ➡️ 실제 리소스 물리 경로 또는 클래스패스 경로 지정
- `setCacheControl(...)` ➡️ 브라우저 캐시 제어 헤더 설정
- `resourceChain(true)` ➡️ 리소스 체인 활성화
- `addResolver(...)` ➡️ 버전 관리를 위한 `VersionResrouceResolver` 등록

<br>

#### XML 기반 설정

```xml
<mvc:resources mapping="/resources/**" location="/public/, classpath:/static/" cache-period="31556926">
    <mvc:resource-chain resource-cache="true">
        <mvc:resolvers>
            <mvc:version-resolver>
                <mvc:content-version-strategy patterns="/**"/>
            </mvc:version-resolver>
        </mvc:resolvers>
    </mvc:resource-chain>
</mvc:resources>
```

- `mapping` 속성으로 URL 패턴 지정
- `location` 속성으로 리소스 경로 지정
- `cache-period` 속성으로 캐시 기간 지정
- `<mvc:resource-chain>` 내부에 버전 전략 등 추가 옵션 설정 가능

<br>

## 주요 옵션과 활용

- 캐시 제어(CacheControl / cache-period)
  - 브라우저 및 프록시 캐시를 제어하기 위해 `Cache-Control` 헤더를 설정할 수 있음
- 버전 관리(VersionResourceResolver)
  - 리소스 파일이 변경되었을 떄 브라우저 캐시가 갱신되지 않는 문제를 방지하기 위해, URL에 해시 또는 버전 문자열을 붙이는 방식이 지원
- WebJar 지원
  - `org.webjars:webjars-locator-core`가 클래스패스에 있을 경우 `/webjars/**` 경로의 리소스를 자동으로 탐색하고 버전 없는 URL도 처리 가능한 `WebJarsResourceResolver`가 등록
- 리소스 체인(Resource Chain)
  - `resourceChain(true)` 설정을 통해 `ResourceResolver` 및 `ResourceTransFormer` 체인을 구성할 수 있으며, 압축된 리소스 제공, 캐시 무효화, 버전 전략 등을 포함할 수 있음

<br>

## 주의사항 및 팁

- `@EnableWebMvc`를 사용하고 기본 정적 리소스 설정을 오버라이드하면 Spring Boot의 자동 정적 리소스 설정이 무시될 수 있으므로, 설정 시 주의해야 함
- 버전 관리 전략을 사용하는 경우, 압축된 리소스와 버전 해시 전략을 함께 사용한다면 `EncodedResourceResolver` ➡️ `VersionResourceResolver` 순서가 중요함
- 클래스 패스 `/static/`, `/public/`, `/resources/`, `/META-INF/resources/` 등 다양한 기본 리소스 경로가 존재하며, Spring Boot에서는 기본적으로 이들 위치를 탐색
- 리소스 패턴이나 위치가 잘못되면 404가 발생하므로 URL 매핑과 파일 위치를 잘 확인해야 함
- 브라우저 캐시 만료를 길게 설정할 경우, 리소스 변경 시 클라이언트가 오래된 파일을 그대로 사용하게 될 수 있으므로 버전 전략이나 캐시 무효화 메커니즘을 함께 사용하는 것이 좋음