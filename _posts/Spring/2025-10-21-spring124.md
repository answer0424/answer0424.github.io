---
layout: post
title: Testing
date: 2025-10-21 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- 서블릿 API Mock 객체: `MockHttpServletRequest`, `MockHttpServletResponse` 등으로 컨트롤러/필터/서블릿 단위 테스트 가능
- TestContext Framework: `@WebAppConfiguration`, `WebApplicationContext` 등을 사용해 웹 어플리케이션 컨텍스트를 로드해 테스트 가능
- Spring MVC Test 프레임워크: `DispatcherServlet` 기반으로 실제 HTTP 서버 구동 없이 컨텍스트를 로드해 테스트 가능
- 클라이언트-사이드 REST 테스트: `MockRestServiceServer` 등 외부 REST 호출을 모킹하여 클라이언트 코드 테스트 가능
- `WebTestClient`: 원래는 WebFlux 용이지만, Web MVC 환경에서도 end-to-end 또는 비동기/스트리밍 응답 테스트에 사용 가능


<br>

## MockMvc 기반 테스트 흐름

- `MockMvc` 인스턴스를 통해 요청을 생성하고 (`perform()`), 결과를 기대하고 (`andExpect()`), 결과를 출력하거나 검사할 수 있음

```java
mockMvc.perform(get("/someEndpoint")
        .param("key", "value")
        .accept(MediaType.APPLICATION_JSON))
            .andDo(print())
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.data").value("expectedValue"));
```

- 위 흐름을 통해 컨트롤러의 매핑, 응답 상태, 응답 본문, 헤더 등을 단위 또는 통합 테스트 할 수 있음

<br>

## 활용 예시 및 전략

- 웹 레어 단위 테스트: `@WebMvcTest`(Spring Boot 환경) 등을 사용해 컨트롤러와 MVC 설정만 로드하고, 서비스/레포지토리 등은 `@MockBean`으로 대체하는 방식
- 통합테스트: `@SpringBootTest`와 `@AutoConfigureMockMvc` 등을 사용해 전체 어플리케이션 컨텍스트를 로드하고 `MockMvc`로 실제 요청을 검증하는 방식
- 클라이언트-사이드 모킹: 외부 API 호출을 하는 클라이언트 코드가 있다면 `MockRestServiceServer` 등을 사용해 HTTP 호출을 모킹하고 테스트 가능

<br>

## 주의사항 및 팁

- `MockMvc`는 실제 HTTP 서버를 띄우지 않고도 MVC 요청 흐름을 검증할 수 있기 때문에 빠른 단위 테스트에 적합
- 다만 정적 리소스, 보안 필터, 서블릿 컨테이너 특화 설정 등이 실제 프로덕션 환경과 다를 수 있으므로 리얼 서버 테스트나 프로파일 기반 테스트도 별도 고려해야 함
- 웹 레이어만 테스트 할 경우 서비스/리포지토리 등 의존성을 `@MockBean` 등으로 대체해 테스트범위를 좁히는 것이 좋음
- `WebTestClient` 등 비동기 스트리밍 응답을 다룰 필요가 있다면 복합적인 테스트 전략을 세워야 함