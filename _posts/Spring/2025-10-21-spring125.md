---
layout: post
title: WebSocket API
date: 2025-10-21 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, WebSockets]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---


## 주요 개념 및 기능

- WebSocket 프로토콜은 HTTP로 시작해 `Upgrade` 헤더로 WebCSocket 연결로 전환한 뒤 양방향 통신을 유지할 수 있는 TCP 연결을 만듦
- Spring은 WebSocket 기능을 지원하기 위해 `spring-websocket` 모듈을 제공하며, 서블릿 기반 환경에서도 WebSocket 핸들러를 쉽게 등록하고 사용할 수 있도록 구성
- 또한, WebSocket 위에서 STOMP 등의 서브 프로토콜을 사용하거나 폴백으로 SockJS를 지원하는 다양한 통신 패턴을 쉽게 구현 가능

<br>

## 서버 설정 및 등록 방법

#### 1. WebSocket 핸들러 등록

```java
@Configuration
@EnableWebSocket
public class WebSocketConfig implements WebSocketConfigurer {
    
    @Override
    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(new MyWebSocketHandler(), "/ws-endpoint")
                .setAllowedOrigins("*");
    }

    @Bean
    public WebSocketHandler myHandler() {
        return new MyWebSocketHandler() {
            @Override
            public void handleTextMessage(WebSocketSession session, TextMessage message) throws Exception {
                // 메시지 처리 로직
            }
        };
    }
}
```

- `@EnableWebSocket` 어노테이션으로 WebSocket 기능 활성화
- `WebSocketConfigurer`를 구현하여 `registerWebSocketHandlers(...)` 안에서 핸들러 매핑을 등록
- `WebSocketHandlerRegistry.addHandler(...)` 메서드로 지정 URL 패턴과 핸들러 빈을 지정
- `WebSocketHandler`는 `TextWebSocketHandler`, `BinaryWebSocketHandler` 등을 상속하여 구현 가능

<br>

#### 2. 서브프로토콜 / 매시징 브로커(STOMP 등) 적용

- 만약 STOMP를 WebSocket위에 얹어 사용하고자 하면, `@EnableWebSocketMessageBroker`등을 사용하고 `MessageBrokerRegistry`, `StompEndpointRegistry` 등을 통해 설정을 추가해야 함
- 예: 채팅, 실시간 알림등에서 클라이언트가 "/topic/..."과 같은 주제를 구독하고 서버가 해당 구독자에게 메시지를 발송하는 구조로 사용할 수 있음

<br>

## 실무 팁 / 유의사항

- WebSocket은 HTTP 요청에 비해 상태가 유지되는 연결하기 때문에, 클라이언트 연결 종료, 네트워크 단절, 프록시 타임아웃 등을 고려해야 함
- 서브프로토콜이나 폴백을 지원하지 않는 환경에서는 SockJS 같은 라이브러리로 폴백 구현을 고려해야 함
- 인증/인가 처리를 WebSocket 핸드셰이크 단계부터 고려해야 함
  - 특히 STOMP와 함께 사용할 경우, Principal 기반 사용자 식별·메시지 권한 제어 등이 필요
- 대량 메시지 처리, 구독 관리, 메시지 브로커 선택(RabbitMQ, ActiveMQ, Simple Broker 등) 등도 설계 초기에 고려하는 것이 좋음
- 개발 및 테스트 환경에서는 WebSocket 핸드쉐이크와 메시지 흐름을 검증하기 위한 도구(Postman WebSocket, 웹 클라이언트 JS, 테스트 프레임워크 등)를 활용해야 함