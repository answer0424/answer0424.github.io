---
layout: post
title: Simple Broker
date: 2025-10-23 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, WebSockets, STOMP]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---


## 개요

- Spring에서 STOMP over WebSocket을 구성할 때 가장 간단하게 사용할 수 있는 내장 메시지 브로커가 Simple Broker임
- 이 브로커는 클라이언트의 구독 요청을 메모리에 저장하고 해당 목적지를 구독한 클라이언트에게 메시지를 broadcast하는 역할을 수행
- 목적지 경로 패턴을 지원하며, Ant 스타일 경로나 슬래시 패턴, 점 구분자 등 다양한 구문을 허용

<br>

## 설정 방법

```java
@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {

    @Autowired
    @Lazy
    private TaskScheduler messageBrokerTaskScheduler;

    @Override
    public void configureMessageBroker(MessageBrokerRegistry registry) {
        registry.enableSimpleBroker("/queue/", "/topic/")
                .setHeartbeatValue(new long[] {10000, 10000}) // 클라이언트-서버 하트비트 설정
                .setTaskScheduler(messageBrokerTaskScheduler); // 하트비트 스케줄러 지정
    }

    @Override
    public void registerStompEndpoints(StompEndpointRegistry registry) {
        registry.addEndpoint("/ws-endpoint").withSockJS();
    }
}
```

- `registry.enableSimpleBroker("/queue/", "/topic/")`으로 Simple Broker를 활성화
- `setHeartbeatValue(long[])` 메서드를 통해 STOMP heart-beat 주기를 설정할 수 있음
- `setTaskScheduler(...)`를 지정하면 브로커 내부에서 구독자 핸들링이나 타이머 기반 작업 등을 커스터마이즈할 수 있음