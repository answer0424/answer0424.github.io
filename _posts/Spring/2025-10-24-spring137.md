---
layout: post
title: Dots as Seperators
date: 2025-10-23 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, WebSockets, STOMP]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---


## 개요

- 기본적으로 STOMP 목적지 매핑은 슬래시(`/`)를 경로 구분자로 사용
- 그러나 메시징 환경에서는 흔히 `.`을 사용해서 `topic.chat.room` 같은 형태로 목적지를 표현하는 것이 익숙할 수 있음
- 이 경우 Spring에서는 `AntPathMatcher` 기반의 경로 매칭 규칙을 바꿔서 점을 구분자로 사용할 수 있도록 지원

<br>

## 설정 방법

```java
@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfiguration implements WebSocketMessageBrokerConfigurer {

    @Override
    public void configureMessageBroker(MessageBrokerRegistry registry) {
        registry.setPathMatcher(new AntPathMatcher("."));
        registry.enableStompBrokerRelay("/queue", "/topic");
        registry.setApplicationDestinationPrefixes("/app");
    }
}
```

<br>

```xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:websocket="http://www.springframework.org/schema/websocket"
       …>
    <websocket:message-broker application-destination-prefix="/app" path-matcher="pathMatcher">
        <websocket:stomp-endpoint path="/stomp"/>
        <websocket:stomp-broker-relay prefix="/topic,/queue"/>
    </websocket:message-broker>

    <bean id="pathMatcher" class="org.springframework.util.AntPathMatcher">
        <constructor-arg index="0" value="."/>
    </bean>
</beans>
```


<br>

## 동작 및 유의사항
- 위와 같이 구분자를 점(`.`)으로 변경하면 `@MessageMapping("blue.{green}")` 같은 표현이 가능해지고 클라이언트는 `/app/red.blue.green123` 같은 목적지로 메시지를 보낼 수 있게 됨
- 단, 이 설정은 내장 Simple Broker 사용시 메시지 매핑에도 영향을 미침
  - 즉, 주분자를 점으로 바꾸면 브로커도 해당 구분자를 인식해서 구독 패턴 매칭을 해야 함
- 외부 브로커를 사용하는 경우에는 브로커 쪽의 목적지 규칙이나 구분자 사용 관례도 함께 고려해야 함 
  - 그 자체의 목적지 규칙을 따르므로, 구분자 설정이 브로커가 사용하는 규칙과 맞아야 함