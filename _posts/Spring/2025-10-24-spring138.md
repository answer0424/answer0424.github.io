---
layout: post
title: Authentication
date: 2025-10-24 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, WebSockets, STOMP]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- STOMP over WebSocket 세션은 보통 HTTP 요청을 통해 시작
  - 이는 WebSocket 핸드셰이크 요청이거나 SockJS 폴백일 경우 HTTP 기반 전송 요청이 될 수 있음
- 대부분의 웹 어플리케이션에서는 이미 Spring Security 등을 사용해 HTTP 수준에서 인증, 인가가 설정되어 있음
  - 사용자 인증 정보는 보통 HTTP 세션이나 보안 컨텍스트에 저장
- WebSocket 혹은 SockJS 핸드셰이크 이후 생성된 세션에서는 이 HTTP 수준의 인증 정보가 WebSocket 세션으로 자동 전이됨
  - 즉, WebSocket 연결 이후부터 STOMP 프레임에 포함된 `user` 헤더 등을 통해 인증된 사용자 정보가 사용

<br>

## 구현 방식

- 클라이언트가 WebSocket 엔드포인트로 핸드셰이크 요청을 보낼 때, 이미 HTTP 인증이 되어 있으면 `Principal`이 `WebSocketSession`에 매핑됨
  - 이 말은, 이후 STOMP 메시지 프레임이 들어올 때 이 `Principal`이 사용자의 식별자로 사용될 수 있다는 뜻
- STOMP 프로토콜에는 `CONNECT` 프레임에서 `login` 및 `passcode` 헤더를 전송할 수 있는 규약이 있음
  - 하지만 WebSocket + STOMP 구성에서는 보통 이 헤더들을 사용하지 않고, HTTP 수준 인증을 활용하는 방식이 기본

<br>

## 요약

- HTTP 요청 수준에서 인증된 상태라면, 별도 추가 설정 없이 WebSocket/STOMP 환경에서도 해당 인증 정보가 이어짐
- 클라이언트가 STOMP `CONNECT` 프레임에 `login` 및 `passcode`를 넣는 방식보다는 HTTP 세션을 통한 인증 방식을 사용하는 것이 권장
- 따라서 WebSocket/STOMP 구현 시 인증 로직은 보통 기존 HTTP 보안 설정에서 처리하고 WebSocket 구성에서는 인증된 `Principal`을 활용하는 방식으로 진행