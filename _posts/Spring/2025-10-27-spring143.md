---
layout: post
title: STOMP Client
date: 2025-10-27 09:00:00 +09:00
categories: [Spring, Servlet Stack, Web MVC, WebSockets, STOMP]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- Spring은 WebSocket 위에 STOMP 프로토콜을 사용하는 클라이언트 기능을 제공
- 즉, 서버 측에서 STOMP를 사용하고 있다면, 클라이언트도 Java에서 WebSocketStompClient 등을 만들어 STOMP 세션을 연결하고 메시지를 주고 받을 수 있음
- 또한 STOMP over TCP 방식도 지원

<br>

## 주요 구성요소 및 흐름

#### 1. 클라이언트 생성 및 설정

- WebSocket 클라이언트를 먼저 생성해야 함

```java
WebSocketClient webSocketClient = new StandardWebSocketClient();
WebSocketStompClient stompClient = new WebSocketStompClient(webSocketClient);
stompClient.setMessageConverter(new StringMessageConverter());
stompClient.setTaskScheduler(taskScheduler); // heartbeats 용
```

- 위 예제에서 `StandardWebSocketClient` 대신 SockJsClient를 사용할 수 있으며, SockJS는 WebSocket을 기본으로 하되 HTTP-fallback등을 지원

<br>

#### 2. 서버와 연결

- URL 예시: `"ws://127.0.0.1:8080/endpoint"`
- STOMP 세션 핸들러를 구현한 클래스를 준비하고 연결을 시도

```java
String url = "ws://127.0.0.1:8080/endpoint";
StompSessionHeader = new MyStompSessionHandler();
stompClient.connect(url, sessionHandler);
```