---
layout: post
title: Multipart
date: 2025-11-17 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebFlux, Annotated Controllers, Handler Methods]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- Spring MVC에서 `Multipart/form-data` 형식의 POST 요청을 처리하려면 먼저 `MultipartResolver`를 활성화해야 함
- `MultipartResolver`가 활성화된 상태에서는 요청의 본문이 파싱되어 일반 요청 파라미터처럼 컨트롤러 메서드에 반인딩 될 수 있음
- 즉, 파일 업로드가 포함된 폼 처리할 때 `@RequestParam`, `@RequestPart`, 또는 커맨드 객체 방식으로 메서드 인자를 선언할 수 있음

<br>

## 사용법 및 예제

#### Java 예제

```java
@Controller
public class FileUploadController {

    @PostMapping("/form")
    public String handleFormUpload(
            @RequestParam("name") String name,
            @RequestParam("file") MultipartFile file) throws IOException {

        if (!file.isEmpty()) {
            byte[] bytes = file.getBytes();
            // bytes 저장 로직 …
            return "redirect:uploadSuccess";
        }
        return "redirect:uploadFailure";
    }
}
```

- 위 예제에서는 폼 필드 `name`과 파일 필드 `file`을 각각 `@RequestParam`으로 받았음
- 파일 필드는 `org.springframework.web.multipart.MultipartFile` 타입으로 선언되어 있고, 비어있지 않을 경우 바이트 배열로 읽어 저장하는 로직이 있음

<br>

#### 다중 파일 또는 Map 방식 예제

- 만약 동일한 파라미터 이름으로 여러 파일을 업로드 가능하다면 `List<MultipartFile>` 또는 `MultipartFile[]` 타입을 사용 가능
- `@RequestParam` 어노테이션을 `Map<String, MultipartFile>` 또는 `MultiValueMap<String, MultipartFile>` 타입의 인자에 지정하면, 각각의 파라미터 이름별로 파일들이 담겨 들어옴

<br>

#### 커맨드 객체 방식

```java
public class MyForm {
    private String name;
    private MultipartFile file;
    // getters/setters
}

@Controller
public class FileUploadController {
    @PostMapping("/form")
    public String handleFormUpload(MyForm form, BindingResult errors) throws IOException {
        if (!form.getFile().isEmpty()) {
            byte[] bytes = form.getFile().getBytes();
            // 저장 로직
            return "redirect:uploadSuccess";
        }
        return "redirect:uploadFailure";
    }
}
```

<br>

#### JSON + 파일 같은 복합 요청 처리(`@RequestPart`)

- 파일 업로드 뿐 아니라 JSON 메타데이터 + 파일 같이 보내는 경우 `@RequestPart` 어노테이션을 사용 가능

```java
@PostMapping(value="/", consumes = {MediaType.MULTIPART_FORM_DATA_VALUE})
public String handle(
        @RequestPart("meta-data") MetaData metadata,
        @RequestPart("file-data") MultipartFile file) {
    // 처리 로직 …
}
```

- 위 예제처럼 요청 본문에 JSON 파트와 파일 파트가 혼합된 `multipart/form-data` 형식의 요청을 받을 수 있음

<br>

## 유의사항 및 팁

- 파일 업로드 요청을 처리할 때는 폼의 `enctype="multipart/form-data"` 설정이 필수
- `MultipartResolver`설정이 없으면 `MultipartFile` 타입이 정상 바인딩되지 않거나 예외가 발생할 수 있음
- `@RequestParam("file") MultipartFile file`처럼 파일만 받는 구조도 가능하지만, 폼 빌드 + 파일 같이 받을 경우 커맨드 객체 또는 `@RequestPart` 방식이 더 유연
- JSON과 파일을 동시에 받는 경우에는 `@RequestPart`를 사용하고 해당 JSON 객체에 대해 `@Valid` 등 유효성 검사를 적용하는 것도 가능
- 다중 파일 처리 시 `List<MultipartFile>` 또는 `MultipartFile[]` 사용을 고려하고, 클라이언트 측에서 유효성 검사를 적용하는 것도 가능
- 파일 크기 제한, 저장 경로, 보안 등을 실무에서는 반드시 고려해야 함