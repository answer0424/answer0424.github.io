---
layout: post
title: InitBinder
date: 2025-11-19 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebFlux, Annotated Controllers]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- `@InitBinder` 어노테이션은 컨트롤러 또는 컨트롤러 어드바이스 클래스 내에서 메서드에 사용할 수 있음
- 이러한 메서드는 내부에서 WebDataBinder 인스턴스를 초기화해줌
  - 이 바인더는 요청 파라미터를 모델 객체에 바인딩하거나, 문자열을 객체 속성 타입으로 변환, 또는 모델 객체 속성을 문자열로 포매팅할 때 사용됨
- 컨트롤러 수준에서는 해당 컨트롤러에만 적용되는 바인더 설정을 할 수 있고, `@ControllerAdvice`에서는 여러 컨트롤러에 걸친 공통 바인더 설정을 할 수 있음

<hr>

## 주요 기능 및 사용 방식

#### 메서드 정의

- `@InitBinder` 메서드는 일반적으로 다음과 같은 형태
  - `public void methodName(WebDataBinder binder)`
- 또한 Formatter 또는 Converter 기반의 타입 변환을 사용할 경우에도 사용 가능
  
<br>

#### 바인딩 및 변환 설정

- `WebDataBinder`를 사용하여 커스텀 에디터나 포맷터를 등록할 수 있음
  - 예: 날짜 타입을 특정 포맷으로 변환하도록 `CustomDataEditor` 등록
  - 예: `DateFormater`를 사용하여 날짜 포맷 지정

<br>

#### 보안 및 바인딩 범위 제어

- 웹 요청 시 요청 파라미터가 모델 객체의 모든 public 속성에 바인딩될 수 있는데, 이로 인해 예상치 않은 속성까지 설정될 위험이 있음
- 권장 사항
  - 전용 모델 객체를 만들어 요청에 필요한 속성만 선언하는 것이 좋음
  - 또는 constructor binding을 사용해 요청 파라미터가 생성자 인자로만 바인딩되도록 할 수 있음
  - 또 다른 방법으로는 `WebDataBinder`에 `allowedFields` 또는 `disallowedFields`를 설정하는 것인데, 허용 필드를 명시하는 방식이 더 안전함

```java
@InitBinder
void initBinder(WebDataBinder binder) {
    binder.setAllowedFields("oldEmailAddress", "newEmailAddress");
}
```

-  또한 프로퍼티 바인딩 대신 생성자 바인딩만 사용하고자 할 경우에는 `binder.setDeclarativeBinding(true)`를 성정할 수 있음

<hr>

## 적용 범위 및 특징

- 컨트롤러 내부에 `@InitBinder` 메서드를 둔 경우: 해당 컨트롤러에서 실행되는 핸들러 메서드들에 대해 로컬 바인더 설정이 적용됨
- @ControllerAdvice 내에 `@InitBinder` 메서드를 둔 경우: 여러 컨틀로러에 걸쳐 공통으로 적용 가능한 바인더 설정을 정의할 수 있음
- 바인더 설정은 주로 요청 파라미터 바인딩과 타입 변환/포맷팅과 관련되어 있으며, 뷰 렌더링 시 모델 객체 속성의 문자열 포맷을 제어할 수도 있음

<hr>

## 사용 시기

- 폼 데이터를 처리할 때 사용자 입력을 도메인 모델 혹은 DTO에 바인딩해야할 경우: 그전에 날짜 숫자, 커스텀 타입 등의 변환 또는 포맷팅 설정이 필요하다면 `@InitBinder`로 준비하면 좋음
- 모델 객체 바인딩 시 허용 필드나 금지 필드를 명시해서 보안 및 예측되지 않은 바인딩을 방지하고 싶을 때 
- 여러 컨트롤러에서 타입 변환/포맷팅 규칙이 동일하다면 @ConterollerAdvice + @InitBinder 조합으로 일관된 바인딩 설정을 중앙화할 수 있음

<br>

## 유의사항 및 팁

- @InitBinder 메서드는 `@RequestMapping` 메서드보다 먼저 실행되며, 바인더가 초기화된 후 요청 파라미터 바인딩이 이뤄짐
- 바인딩 대상 모델 객체 설계 시, 직접 도메인 엔티티를 사용하는 것보다 전용 폼 DTO를 사용하는 것이 권장
  - 도메인 모델이 바인딩 대상이되면 의도치 않은 속성까지 설정될 수 있음
- `allowedFields` 방식으로 허용 필드를 명시해 주는 것이 보안상 더 안전함
- 생성자 바인딩만 사용하고 싶으면 `setDecalarativeBinding(true)`를 설정해야 함
