---
layout: post
title: Controller Advice
date: 2025-11-20 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebFlux, Annotated Controllers]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- `@ControllerAdvice`는 여러 컨트롤러레 적용 가능한 공통 처리 메서드를 정의할 수 있게 해주는 어노테이션임
- `@RestControllerAdvice`는 `@ControllerAdvice`와 `@ResponseBody`가 결합된 형태로 JSON/문자열 형태의 응답을 반환하는 전역 처리기를 만들 때 사용됨
- 기본적으로 `@ControllerAdvice` 클래스에 선언된 `@ExceptionHandler`, `@InitBinder`, `@ModelAttribute` 메서드들은 모든 컨트롤러에 적용됨

<hr>

## 주요 기능 및 특징

#### 적용 대상

- `@ControllerAdvice`에서 별도의 지정이 없다면 어플리케이션 내 모든 컨트롤러 클래스에 적용됨
- 적용 대상을 제한할 수 있는 속성이 존재함
  - `annotations = RestController.class`처럼 특정 어노테이션이 붙은 컨트롤러만 적용
  - 패키지명으로 특정 패키지 이하 컨트롤러만 적용
  - `assignableTypes = {SomeController.class}`처럼 특정 클래스 타입을 기준으로 적용
- 선택 조건을 많이 사용하면 런타임 성능에 영향이 있을 수 있음 
 
<br>

#### 처리 우선순위

- 컨트롤러 내부에 정의된 `@ExceptionHandler, `@InitBinder`, `@ModelAttribute` 메서드가 우선 적용됨
  - 그 다음 `@ControllerAdvice`에 정의된 전역 처리기가 적용됨
- 다만 `@ModelAttribute` 및 `@InitBinder` 메서드의 경우, 전역 메서드(`@ControllerAdvice`) 메서드가 먼저 실행되고 그 뒤에 컨트롤러 내부 메서드가 실행된다는 특징이 있음

<br>

#### 적용 가능한 메서드 유형

- `@ExceptionHandler`: 예외 발생 시 공통 처리 로직 정의 가능
- `@InitBinder`: 데이터 바인딩/타입 변환 등 초기화 작업을 전역 수준에서 처리 가능
- `@ModelAttribute`: 모든 요청에 대해 공통으로 모델 속성을 추가할 때 사용 가능
- 이러한 메서드들을 `@ControllerAdvice` 클래스 안에 정의하면 여러 컨트롤러에서 중복 코드 없이 처리 가능

<hr>

## 사용 시기

- 여러 컨트롤러에서 공통된 예외 처리 로직이 필요할 때: 예컨대 API 전체에서 발생하는 `NullpointerException`, `IllegalArgumentException` 등에 대해 같은 JSON 응답 구조로 처리하고 싶을 때 
- 폼 바인디/유형 변환/모델 속성 설정 등 여러 컨트롤러에 반복적으로 들어가는 코드가 있을 때 이를 중앙화하여 관리하고 싶을 때
- 유지보수 및 코드 품질 측면에서, 컨트롤러 별로 중복된 로직을 제거하고 분리된 구조로 설계하고 싶을 때

<hr>

## 유의사항 및 팁

- `@ControllerAdvice`를 지나치게 많은 조건을 걸어 사용하면 각 요청마다 적용 가능한 클래스를 필터링하는 비용이 증가할 수 있으므로 주의
- 전역 처리기 내부에서 반환 타입이 뷰 이름일 경우, 원치 않는 뷰 렌더링이 발생할 수 있으므로 특히 REST API 형태라면 `@ResponseBody` 또는 `@RestControllerAdvice`를 사용하는 것이 좋음
- 전역으로 처리되는 로직이 너무 많아지면 어떤 로직이 어느 컨트롤러에 적용됐는지 추적이 어려워지므로 적용 범위를 명확히 설계해 두는 것이 좋음
- `@ControllerAdvice` 클래스에서도 `@InitBinder`, `@ModelAttribute`, `@ExceptionHandler` 이 세가지 기능이 모두 가능하지만, 실제로 어떤 기능을 어디에 두느냐에 따라 요청 흐름에 영향을 미칠 수 있으므로 사용 전 흐름을 잘 이해해야 함