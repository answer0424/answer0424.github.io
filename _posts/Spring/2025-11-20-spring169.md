---
layout: post
title: Functional Endpoints
date: 2025-11-20 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebFlux]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- Spring MVC에는 기존의 어노테이션 기반 모델 외에 함수형 프로그래밍 모델, 즉 WebMvc.fn 이라는 기능이 포함되어 있음
- 이 모델에서는 HTTP 요청을 처리할 때 함수와 라우터 함수라는 개념이 중심임
  - 즉, 요청 ➡️ 라우터 함수 ➡️ 핸들러 함수 ➡️ 응답 흐름으로 구성됨
- 기본적으로 이 모델은 동일한 `DispatcherServlet` 기반 위에서 동작하며, 어노테이션 기반 방식과 같이 동시 사용이 가능

<hr>

## 주요 개념

#### `HandlerFunction`

- `HandlerFunction`은 요청을 처리하는 함수형 단위로, `ServerRequest` 객체를 받아 `ServerResponse` 객체를 반환하는 형태
  - 즉, 어노테이션 기반 모델의 `@RequestMapping` 메서드 본문과 유사한 역할을 함
- `ServerRequest`와 `ServerResponse`는 변경 불가능 계약으로 설계되어 있으며, JDK8 이후 람다/메서드 참조 스타일과 잘 어울리도록 되어 있음

<br>

#### `RouterFunction`

- `RouterFunction`은 들어온 `ServerRequest`를 보고 적절한 `HandlerFunction`을 결정하는 함수형 라우터임
  - 입력: `ServerRequest` ➡️ 출력: `Optional<HandlerFunction>` 형태임
- 보통 `RouterFunctions.route()` 빌더를 통해 라우터를 구성하며, HTTP 메서드, 경로, 미디어 타입 등을 라우팅 규칙으로 설정할 수 있음
- 라우터 함수는 선언된 순서대로 평가되며, 먼저 매치되는 규칙이 처리됨

<hr>

## 코드 예시

```java
import static org.springframework.web.servlet.function.RequestPredicates.*;
import static org.springframework.web.servlet.function.RouterFunctions.route;

PersonRepository repository = …;
PersonHandler handler = new PersonHandler(repository);

RouterFunction<ServerResponse> router = route()
    .GET("/person/{id}", accept(APPLICATION_JSON), handler::getPerson)
    .GET("/person", accept(APPLICATION_JSON), handler::listPeople)
    .POST("/person", handler::createPerson)
    .build();
```

- 위 예시에서 `PersonHandler` 클래스의 메서드들은 `ServerRequest`를 받아 `ServerResponse`를 반환하는 형태로 구현되어야 함

<hr>

## 장점 및 특징

- 함다/메서드 참조 스타일로 라우팅 및 핸들러를 구성할 수 있어 코드가 간결해짐
- 어노테이션 기반 모델과 비교해 라우팅 로직을 하나의 함수형 빌더 안에 집중시킬 수 있음
- 기존 서블릿 기반 Spring MVC 구조를 유지하면서도 함수형 방식으로 구현 가능하므로, 이미 어노테이션 기반이 많은 경우 기존 코드와 병행 가능성이 있음

<hr> 

## 유의사항 / 한계

- 함수형 모델은 어노테이션 방식과 달리 자동으로 바인딩, 검증이 수행되지 않을 수 있음
  - 예컨대 `@Valid` 기반 검증이 라우터 함수 방식에서 자동으로 작동하지 않을 수 있음
- 라우터 함수의 순서가 중요하며, 잘못된 순서로 선언하면 원치않는 매칭이 되어 버릴 수 있음
- 기존의 많은 Spring MVC 프로젝트가 어노테이션 방식에 익숙해져 있기 때문에, 함수형 방식으로 전환할 경우 학습 비용이나 패턴 일관성을 고려해야 함

<hr> 