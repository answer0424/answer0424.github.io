---
layout: post
title: URL Links
date: 2025-11-20 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebFlux]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- Spring MVC에서는 URI(Uniform Resource Identifier)를 템플릿 방식으로 만들고, 변수 치환과 인코딩을 지원하는 API를 제공
- 주요 클래스
  - `org.springframework.web.util.UriComponentsBuilder`
  - `org.springframework.web.util.UriComponents`
  - `org.springframework.web.util.DefaultUriBuilderFactory` (및 `UriBuilderFactory`/`UriBuilder`) 
- 이를 통해 요청 기반 URL을 재활용 하거나 외부 요청을 위한 URI를 동적으로 생성할 수 있음 

<hr>

## 주요 개념 및 사용 방식

#### URI 템플릿 + 변수 치환

```java
UriComponents uriComponents = UriComponentsBuilder
    .fromUriString("https://example.com/hotels/{hotel}")
    .queryParam("q", "{q}")
    .encode()
    .build();
URI uri = uriComponents.expand("Westin", "123").toUri();
```

- 위 예제에서 `{hotel}` 및 `{q}`는 템플릿 변수이며, `expand()` 호출 시 실제 값으로 치환됨
- 또한 `buildAndExpand()` 메서드를 바로 사용할 수도 있음
- 템플릿 문자열 안에 쿼리 파라미터까지 포함할 수 있음

```java
URI uri = UriComponentsBuilder
    .fromUriString("https://example.com/hotels/{hotel}?q={q}")
    .build("Westin", "123");
```


<br>

#### 인코딩 처리

- `encode()` 메서드를 호출하면 URI 템플릿 치환 후에 적절한 인코딩이 적용됨
- 이는 변수 값이 특수 문자를 포함하는 경우 중요
- `UriComponentsBuilder` ➡️ `UriComponents` 객체는 불변하며, `expand()`나 `encode()` 호출 시 새 인스턴스를 반환함

<br>

#### 공통 설정을 담은 팩토리: UriBuilderFactory

- `DefaultUriBuilderFactory`는 `UriBuilderFactory` 인터페이스의 기본 구현체로 기본 URI나 이코딩 모드 등의 설정을 공유할 수 있음

```java
String baseUrl = "https://example.org";
DefaultUriBuilderFactory factory = new DefaultUriBuilderFactory(baseUrl);
factory.setEncodingMode(DefaultUriBuilderFactory.EncodingMode.TEMPLATE_AND_VALUES);

RestTemplate restTemplate = new RestTemplate();
restTemplate.setUriTemplateHandler(factory);
```
또는

```java
WebClient client = WebClient.builder()
    .uriBuilderFactory(factory)
    .build();
```

<hr>

## 실제 활용 시나리오 & 팁

- 리소스 생성 후 위치 헤더 설정: REST API에서 `POST` 요청 후 생성된 리소스의 URI를 Location 헤더에 넣기 위해 `UriComponentsBuilder` + `buildAndExpand()` 방식이 자주 사용됨
- 컨텍스트/서블릿 정보 포함된 URI 생성: 요청 기반으로 현재 URL을 재활용해 리다이렉트 URI를 생성할 때 유용함
- 템플릿을 통해 URL 치환 및 인코딩: 경로 변수나 쿼리 매개변수에 사용자 입력이 포함되는 경우 인코딩을 자동으로 처리하는 것이 안전함
- 공통 베이스 URL 설정: 여러 API 엔드포인트가 동일한 호스트/베이스 경로를 사용할 경우 `DefaultUriBuilderFactory`로 베이스 URL을 설정해 두면 중복 코드가 줄어들고 유지보수가 쉬워짐

<hr> 

## 주의사항 및 한계

- URI 템플릿을 사용하는 방식이지만, `@Controller`/`@RequestMapping` 메서드의 메서드 이름이나 클래스 이름을 자동으로 참조해 URI를 생성하는 기능은 내장되어 있지 않음
- 템플릿 변수 사용 시 치환할 값의 순서/이름을 정확히 맞춰야 하며, 쿼리 파라미터를 템플릿 변수로 넣을 때는 인코딩이나 변수 중복 등에 유의해야 함
- `UriComponenetsBuilder` 자체는 요청 파라미터 바인딩, 검증, 혹은 Spring MVC의 핸들러 매핑과 직접적으로 연계되어 있는 것은 아니며, URI 생성에 집중된 API임을 인식해야 함
- 다중 스레드 환경이나 공유 상태가 있는 경우 `DefaultUriBuilderFactory` 설정을 적절히 고려해야 함