---
layout: post
title: CORS
date: 2025-11-21 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebFlux]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- CORS는 브라우저가 기본적으로 적용하는 동일 출처 정책을 우회하여 다른 출처의 자원을 요청할 수 있도록 허용하는 메커니즘임
- Spring MVC는 CORS 요청을 지원하기 위한 통합 구조를 제공함
- 요청이 핸들러된 후 `HandlerMapping` 구현체가 해당 요청에 대해 CORS 설정을 확인하고, 미리 지정된 CORS 설정이 없으면 응답에 CORS 헤더를 추가하지 않음 ➡️ 결과적으로 브라우저가 요청을 거부할 수 있음

<hr>

## 주요 기능 및 설정 방식

#### 어노테이션 방식: `@CrossOrigin`

- 특정 컨트롤러 클래스나 메서드 수준에서 CORS를 허용하고자 할 때 사용함
- 기본 설정으로는 다음이 허용됨
  - 모든 출처(origins) 허용
  - 모든 헤더(headers) 허용
  - 컨트롤러 메서드에 매핑된 HTTP 메서드들 허용
- 설정 가능한 속성들 예: `origins`, `originPatterns`, `methods`, `allowedHeaders`, `exposeHeaders`, `allowCredentials`, `maxAge`

```java
@RestController
@RequestMapping("/account")
public class AccountController {
    @CrossOrigin
    @GetMapping("/{id}")
    public Account retrieve(@PathVariable Long id) {
        // …
    }
}
```

- 클래스 수준에 붙여서 전체 메서드에 적용할 수도 있고, 메서드 수준에 별도로 지정할 수도 있으며, 클래스 + 메서드 두 수준 다 지정 가능하고 이 경우 설정이 병합됨

<br>

#### 전역 설정(글로벌 CORS 설정)

- 어노테이션 방식 외에, 어플리케이션 전체 또는 특정 URL 패턴에 대해 CORS 설정을 일괄적으로 적용할 수 있음

```java
@Configuration
@EnableWebMvc
public class WebConfig implements WebMvcConfigurer {
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/**")
                .allowedOrigins("https://domain2.com")
                .allowedMethods("GET", "POST")
                .allowedHeaders("*")
                .exposedHeaders("header1", "header2")
                .allowCredentials(true)
                .maxAge(3600);
    }
}
```

<hr>

## 주요 설정 항목 및 의미

- `allowedOrigins`: 허용할 출처. `"*"`로 지정하면 모든 출처 허용이지만 보안상 주의해야 함
- `allowedMethods`: 허용할 HTTP 메서드들
- `allowedHeaders`: 클라이언트 요청 헤더 중 허용할 헤더들
- `exposedHeaders`: 응답에서 클라이언트가 접근 가능하도록 노출할 헤더
- `allowCredentials`: 자격증명이 포함된 요청을 허용할지 여부. 기본은 `false`이며, `true`로 설정 시 허용되는 origin을 명시해야 함
- `maxAge`: 브라우저가 Preflight 요청을 캐싱할 수 있는 최대 시간
- `originPatterns`: 유동적인 여러 출처 패턴 매칭이 필요할 경우 사용 가능

