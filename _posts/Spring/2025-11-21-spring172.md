---
layout: post
title: API Versioning
date: 2025-11-21 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebFlux]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요 

- Spring Framework는 REST API의 진화에 따른 버전 관리를 지원함
- 이장에서는 요청으로부터 버전을 추출하고, 버전에 따라 적절한 컨트롤러/메서드를 매핑하는 전략과 구성 방법을 설정
- 주요 키워드: `ApiVersionStrategy`, `ApiVersionRequestCondition`, `ApiVersionParser`, `ApiVersionDeprecationHandler`

<hr>

## 주요 구성요소

#### ApiVersionStrategy

- API 버전 관리를 위한 중심 전략 인터페이스
- 기능
  - 요청으로부터 버전을 해석
  - 버전 문자열 ➡️ 비교 가능 객체로 파싱
  -  요청된 버전이 지원되는 버전인지 검증
  -  응답에 버전 · 폐기 힌트 등을 포함

<br>

#### ApiVersionResolver

- 요청에서 버전 정보를 추출하는 방법을 캡슐화한 전략
- 기본 제공 옵션
  - 요청 헤더를 통해 버전 얻기
  - 쿼리 파라미터를 통해 버전 얻기
  - 미디어 타입 파라미터를 통해 버전 얻기
  - URL 경로에서 버전 추출하기
- 또한, 커스텀 `ApiVersionResolver`를 구현하여 사용할 수 있음

<br>

#### ApiVersionParser

- raw 버전 문자열을 내부적으로 비교 가능한 형태로 변환하는 전략
- 기본구현: `SemanticApiVersionParser`로 minor/patch가 없으면 0으로 간주

<br>

#### ApiVersionDeprecationHandler

- API의 오래된 버전에 대해 폐기 힌트를 클라이언트에게 전달하고 싶을 때 사용
- 예: `Deprecation`, `Sunset`, `Link` 헤더를 응답에 추가할 수 있음

<hr>

## 동작 흐름 및 매핑

- API 버전 관리가 활성화되면, 요청이 들어왔을 때 먼저 `ApiVersionResolver`가 버전 정보를 추출함
- `ApiVersionParser`가 이 버전을 파싱하고 `ApiVersionStrategy`가 해당 버전이 지원되는지 검증함
- 이후 컨트롤러 메서드 매핑 단계에서 버전 조건이 적용된 요청 매핑이 있을 경우 해당 매핑이 선택됨
- 만약 요청 버전이 지원되지 않는 버전이라면 `InvalidApiVersionException`이 발생하며 기본적으로 400 상태로 응답됨
- 버전이 누락된 경우 기본 설정에 따라 최신 버전 사용으로 처리할 수도 있고, 필수로 버전이 있어야 하도록 설정할 수도 있음 