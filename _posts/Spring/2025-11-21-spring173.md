---
layout: post
title: Error Responses
date: 2025-11-21 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebFlux]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## REST APIì˜ ì˜¤ë¥˜ ì‘ë‹µ ëª©í‘œ

- Spring MVCëŠ” REST APIì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•  ë•Œ RFC 9457 Problem Details for HTTP APIs í˜•ì‹ì„ ì§€ì›

```java
{
  "type": "https://example.com/errors/not-found",
  "title": "Resource not found",
  "status": 404,
  "detail": "User 10 not found",
  "instance": "/users/10"
}
```

<hr>

## í•µì‹¬ ê°œë…

#### `ProblemDetail`

- RFC 9457ì—ì„œ ì •ì˜í•œ ì˜¤ë¥˜ ì‘ë‹µ ê°ì²´
- ê¸°ë³¸ í•„ë“œ
  - `type`, `title`, `status`, `detail`, `instance`

```java
ProblemDetail pd = ProblemDetail.forStatus(HttpStatus.NOT_FOUND);
pd.setTitle("User not found");
pd.setDetail("User 10 does not exist");
```

<br>

#### `ErrorResponse`

- Springì˜ ì˜¤ë¥˜ ì‘ë‹µ ê³„ì•½ ì¸í„°í˜ì´ìŠ¤
- ë‚´ë¶€ Spring MVC ì˜ˆì™¸ë“¤ì€ ëª¨ë‘ ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•¨
- ì˜ˆì™¸ â¡ï¸ ProblemDetail ë³€í™˜ì„ ì¼ê´€ë˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ

<br>

#### `ErrorResponseException`

- ì‚¬ìš©ìê°€ ì§ì ‘ ìƒì„± ê°€ëŠ¥í•œ ê¸°ë³¸ ì˜ˆì™¸ í´ë˜ìŠ¤ 

```java
public class UserNotFoundException extends ErrorResponseException {
    public UserNotFoundException(Long userId) {
        super(HttpStatus.NOT_FOUND,
              ProblemDetail.forStatusAndDetail(HttpStatus.NOT_FOUND, "USER" + userId + " not found"),
              null);
    }
}
```

<br>

#### `ResponseEntityExceptionHandler`

- `@ControllerAdvice`ì—ì„œ í™•ì¥í•˜ì—¬ ê¸€ë¡œë²Œ ì˜ˆì™¸ ì²˜ë¦¬ê¸° ë§Œë“¤ ë•Œ ì‚¬ìš© 
- Springì˜ ê¸°ë³¸ Web ì˜ˆì™¸ë¥¼ ProblemDetailë¡œ ë Œë”ë§ ê°€ëŠ¥

<hr>

## ë Œë”ë§ ê·œì¹™

- Springì€ ProblemDetailì„ ì‘ë‹µìœ¼ë¡œ ë³´ë‚¼ ë•Œ ë‹¤ë¦„ ê·œì¹™ì„ ì ìš©
  - `status` â¡ï¸ HTTP ì‘ë‹µ ì½”ë“œë¡œ ì‚¬ìš©
  - `instance`ê°€ ì—†ì„ ê²½ìš° í˜„ì¬ ìš”ì²­ URLë¡œ ìë™ ì„¤ì •
  - Jackson ì‚¬ìš© ì‹œ ê¸°ë³¸ ë¯¸ë””ì–´ íƒ€ì… ìš°ì„ ìˆœìœ„
    - `application/problem+json`
    - ê·¸ ì™¸ JSON

```java
@GetMapping("/users/{id}")
public User ggetUser(@PathVariable Long id) {
    throw new UserNotFoundException(id);
}
```

<hr>

## ë¹„í‘œì¤€ í•„ë“œ ì¶”ê°€

#### ë°©ë²•1: properties Map ì‚¬ìš©

```java
ProblemDetail pd = ProblemDetail.forStatus(HttpStatus.BAD_REQUEST);
pd.setDetail("Invalid data");
pd.setProperty("errorCode", "VAL_001");
pd.setProperty("field", "email");
```

ğŸ”½ğŸ”½ğŸ”½

```json
{
  "status": 400,
  "detail": "Invalid data",
  "errorCode": "VAL_001",
  "field": "email"
}
```

<br>

#### ë°©ë²•2: ProblemDetailì„ ìƒì†

```java
public class CustomProblemDetail extends ProblemDetail {
    public CustomProblemDetail(ProblemDetail base) { super(base); }

    private String errorCode;
}
```

<hr>

## í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì²˜ë¦¬

- ì˜¤ë¥˜ ì‘ë‹µì´ ProblemDetailì´ë©´ ë‹¤ìŒì²˜ëŸ¼ ë””ì½”ë“œ ê°€ëŠ¥

```java
catch(WebClientResponseException ex) {
    ProblemDetail pd = ex.getResponseBodyAs(ProblemDetail.class);
}
```

<hr>

## ê°„ë‹¨í•œ í´ë¡œë²Œ ì˜ˆì™¸ ì²˜ë¦¬ê¸° ì˜ˆì‹œ

```java
@ControllerAdvice
public class GlobalExceptionHandler extends ResponseEntityExceptionHandler {
    @ExceptionHandler(UserNotFoundException.class)
    public ProblemDetail handleUserNotFound(UserNotFoundException ex) {
        ProblemDetail pd = ProblemDetail.forStatus(HttpStatus.NOT_FOUND);
        pd.setTitle("User Not Found");
        pd.setDetail(ex.getMessage());
        pd.setProperty("errorCode", "USER_NOT_FOUND");
        return pd;
    }
}
```

<hr>

## ìš”ì•½

| ìš”ì†Œ | ì„¤ëª… |
|-|-|
| **ProblemDetail** | RFC 9457 ê¸°ë°˜ ì˜¤ë¥˜ ì‘ë‹µ ëª¨ë¸ |
| **ErrorResponse** | ì˜¤ë¥˜ ì‘ë‹µ ê³„ì•½, Spring ë‚´ë¶€ ì˜ˆì™¸ê°€ êµ¬í˜„ |
| **ErrorResponseException** | ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ ë§Œë“¤ ë•Œ ì‚¬ìš© |
| **ResponseEntityExceptionHandler** | ê¸€ë¡œë²Œ ì˜ˆì™¸ ì²˜ë¦¬í•  ë•Œ ì‚¬ìš©í•˜ëŠ” base class |
| **ìë™ ì²˜ë¦¬** | status â†’ HTTP ì½”ë“œ, instance ê¸°ë³¸ URL, problem+json ìš°ì„  |
| **í™•ì¥ì„±** | ì»¤ìŠ¤í…€ í•„ë“œ ê°€ëŠ¥, ë©”ì‹œì§€ êµ­ì œí™” ì§€ì› |
| **í´ë¼ì´ì–¸íŠ¸ ì²˜ë¦¬** | WebClient/RestTemplateì—ì„œ ProblemDetailë¡œ ë°”ë¡œ íŒŒì‹± ê°€ëŠ¥ |
