---
layout: post
title: Error Responses
date: 2025-11-21 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebFlux]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## REST API의 오류 응답 목표

- Spring MVC는 REST API에서 오류가 발생할 때 RFC 9457 Problem Details for HTTP APIs 형식을 지원

```java
{
  "type": "https://example.com/errors/not-found",
  "title": "Resource not found",
  "status": 404,
  "detail": "User 10 not found",
  "instance": "/users/10"
}
```

<hr>

## 핵심 개념

#### `ProblemDetail`

- RFC 9457에서 정의한 오류 응답 객체
- 기본 필드
  - `type`, `title`, `status`, `detail`, `instance`

```java
ProblemDetail pd = ProblemDetail.forStatus(HttpStatus.NOT_FOUND);
pd.setTitle("User not found");
pd.setDetail("User 10 does not exist");
```

<br>

#### `ErrorResponse`

- Spring의 오류 응답 계약 인터페이스
- 내부 Spring MVC 예외들은 모두 이 인터페이스를 구현함
- 예외 ➡️ ProblemDetail 변환을 일관되게 처리할 수 있음

<br>

#### `ErrorResponseException`

- 사용자가 직접 생성 가능한 기본 예외 클래스 

```java
public class UserNotFoundException extends ErrorResponseException {
    public UserNotFoundException(Long userId) {
        super(HttpStatus.NOT_FOUND,
              ProblemDetail.forStatusAndDetail(HttpStatus.NOT_FOUND, "USER" + userId + " not found"),
              null);
    }
}
```

<br>

#### `ResponseEntityExceptionHandler`

- `@ControllerAdvice`에서 확장하여 글로벌 예외 처리기 만들 때 사용 
- Spring의 기본 Web 예외를 ProblemDetail로 렌더링 가능

<hr>

## 렌더링 규칙

- Spring은 ProblemDetail을 응답으로 보낼 때 다름 규칙을 적용
  - `status` ➡️ HTTP 응답 코드로 사용
  - `instance`가 없을 경우 현재 요청 URL로 자동 설정
  - Jackson 사용 시 기본 미디어 타입 우선순위
    - `application/problem+json`
    - 그 외 JSON

```java
@GetMapping("/users/{id}")
public User ggetUser(@PathVariable Long id) {
    throw new UserNotFoundException(id);
}
```

