---
layout: post
title: WebClient Configuration
date: 2025-11-24 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebClient]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## WebClient Builder

#### WebClient 생성 방법

```java
WebClient webClient = WebClient.builder()
WebClient clientBase = WebClient.create("https://api.example.com");
```

- 더 많은 설정이 필요하면 `WebClient.builder()`를 사용
- Builder로 생성된 WebClient는 불변
  - 설정된 WebClient를 복제해 변경하고 싶다면 `mutate()` 사용 가능

```java
WebClient client1 = WebClient.builder()
    .filter(filterA)
    .filter(filterB)
    .build();

WebClient client2 = client1.mutate()
    .filter(filterC)
    .filter(filterD)
    .build();
// client2는 A, B, C, D 필터 모두 가지고 있음
```

<br>

#### Builder에서 설정 가능한 주요 옵션

| 옵션 | 설명 |
|-|-|
| ruiBuilderFactory | 기본 URI 빌더 팩토리 설정 |
| defaultUriVariables | URI 템플릿에 사용할 기본 변수값 지정 |
| defaultHeaders | URI 템플릿에 사용할 기본 변수값 지정 |
| defaultCookie | 모든 요청에 포함될 기본 쿠키 설정 |
| defaultRequest | `Consumer`를 이용해 모든 요청에 공통으로 커스터마이징 적용 |
| filter | `ExchangeFilterFunction` 필터 등록, 요청/응답 가로채기 가능 |
| exchangeStrategies | HTTP 메시지 인코더/디코더 설정 변경. 버퍼 크기 조정 등 가능 |
| clientConnector | HTTP 클라이언트 커넥터 설정 |
| defaultApiVersion | API 버즌을 모든 요청에 기본값으로 넣는 기능 |
| apiVersionInserter | API 버전을 요청에 어떻게 삽입할지 전략 설정 가능 |
| observationRegistry/observationConvention | 관측용 설정 |

<br>

#### 메시지 코덱 설정

- WebClient가 사용하는 `ExchangeStrategies`를 통해 코덱 설정을 바꿀 수 있음

```java
WebClient webClient = WebClient.builder()
    .codecs(configurer -> configurer.defaultCodecs().maxInMemorySize(2 * 1024 * 1024))
    .build();
```

