---
layout: post
title: Request Body
date: 2025-11-25 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebClient]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- WebClient는 리액티브 스트림 또는 다른 타입을 사용해서 HTTP 요청의 바디를 보낼 수 있음
- 바디를 설정할 때 `body(..)`, `bodyValue(..)` 또는 `syncBody(..)` 메서드를 사용
- 다양한 미디어 타입을 자동 또는 명시적으로 지정 가능함 

<hr>

## 주요 사용 패턴 및 예시

#### 일반 객체

```java
// Mono를 바디로 보내는 예시
Mono<Person> personMono = Mono.just(new Person("John", "Doe"));
Mono<Void> response = webClient.post()
    .uri("/persons")
    .contentType(MediaType.APPLICATION_JSON)
    .body(personMono, Person.class)
    .retrieve()
    .bodyToMono(Void.class);
```

- 이 방식은 WebClient가 내부적으로 `HttpMessageWriter`를 사용해 `Person` 객체를 JSON 등으로 인코딩하여 전송함
- `Flux<T>`도 같은 방식으로 스트림 형태의 데이터 전송에 사용할 수 있음

```java
Flux<Person> peopleFlux = Flux.just(person1, person2, …);
webClient.post()
    .uri("/bulk")
    .contentType(MediaType.APPLICATION_STREAM_JSON)
    .body(peopleFlux, Person.class)
    .retrieve()
    .bodyToMono(Void.class);
```

<br>

#### 폼 데이터 전송

- `MultiValueMap<String, String>`을 사용해 폼 데이터를 보낼 수 있음

```java
MultiValueMap<String,String> formData = new LinkedMultiValueMap<>();
formData.add("key1", "value1");
formData.add("key2", "value2");

webClient.post()
    .uri("/submit")
    .bodyValue(formData)  // 또는 .body(fromFormData(...))
    .retrieve()
    .bodyToMono(Void.class);
```

- 또는 `BodyInserters`를 사용해서 인라인 폼 데이터를 생성할 수 있음

```java
import static org.springframework.web.reactive.function.BodyInserters.*;

webClient.post()
    .uri("/submit")
    .body(fromFormData("key1", "value1").with("key2", "value2"))
    .retrieve()
    .bodyToMono(Void.class);
```

<hr>

## 주의사항

- 메모리 사용: 바디에 큰 스트림을 보낼 때, 메시지 코덱이 버퍼나 스트림을 어떻게 처리하는지 확인해야 함
- Content-Type 설정: `contentType()` 메서드로 `MediaType`을 설정하지 않으면 기본 헤더가 자동으로 설정되지 않을 수 있으므로 주의
- BodyInserters 활용: `BodyInserters`를 통해 다양한 형태의 바디를 손쉽게 생성할 수 있어서 코드 가독성과 유연성이 증가함
- 에러처리: 바디를 보낼 때 네트워크 오류나 직렬화 오류가 발생할 수 있으므로, `retrieve()` 또는 `exchange()` 같은 방식으로 예외 처리를 고려하는 것이 좋음