---
layout: post
title: Filter
date: 2025-11-25 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebClient]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념

- WebClient에서 요청과 응답을 가로채고 조작할 수 있게 해주는 기능 ➡️ `ExchangeFilterFunction`을 사용
- WebClient의 필터는 `WebClient.Builder.filter()`를 통해 등록할 수 있고, WebClient를 생성할 때 적용됨
- 기존 WebClient 인스턴스를 복제해서 (`mutate()`) 필터를 추가하거나 제거할 수 있음

<hr>

## `ExchangeFilterFunction` 인터페이스

- 함수형 인터페이스로, 요청과 응답을 처리할 수 있음
- 메서드 시그니처

```java
Mono<ClientResponse> filter(ClientRequest request, ExchangeFunction next);
```

- 필터 체인을 구성할 수 있고, 여러 필터를 순서대로 적용 가능함
- 응답을 조작할 때는 반드시 응답 본문을 소비하거나 downstream으로 전달해야 함

<hr>

## 필터 사용 예시

#### 요청 헤더 추가

```java
WebClient client = WebClient.builder()
    .filter((request, next) -> {
        ClientRequest filtered = ClientRequest.from(request)
            .header("foo", "bar")
            .build();
        return next.exchange(filtered);
    })
    .build();
```


<br>

#### 기본 인증 필터

```java
import static org.springframework.web.reactive.function.client.ExchangeFilterFunctions.basicAuthentication;

WebClient client = WebClient.builder()
    .filter(basicAuthentication("user", "password"))
    .build();
```