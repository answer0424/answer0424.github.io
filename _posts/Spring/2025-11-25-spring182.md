---
layout: post
title: Synchronous Use
date: 2025-11-25 09:00:00 +09:00
categories: [Spring, Reactive Stack, WebClient]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- WebClient는 본래 비동기/논블로킹 API이지만, 최종적으로 `.block()`을 사용하여 동기 스타일로 결과를 받을 수 있음
- 이 방식은 리액티브 스트림을 끝까지 실행한 후 호출한 스레드를 차단한다는 뜻임
- 하지만 여러 HTTP 호출이 있을 경우, 모두 개별적으로 block() 하는 것보다는 reactive 방식으로 `Mono`/`Flux`를 조합한 뒤 한 번만 block하는 것이 더 효율적임
- Spring MVC컨트롤러나 WebFlux 핸들러 메서드에서는 block을 피하고 가능한 한 reactive 타입으로 반환하는 것이 권장됨

<hr>

## 코드 예시

#### 단일 요청 동기 처리

```java
WebClient client = WebClient.create("https://example.org");

Person person = client.get()
    .uri("/persons/{id}", id)
    .retrieve()
    .bodyToMono(Person.class)
    .block();  // 동기적으로 결과를 기다림
```

<br>

#### 여러 요청 동기 처리

```java
Mono<Person> personMono = client.get()
    .uri("/person/{id}", personId)
    .retrieve()
    .bodyToMono(Person.class);

Mono<List<Hobby>> hobbiesMono = client.get()
    .uri("/person/{id}/hobbies", personId)
    .retrieve()
    .bodyToFlux(Hobby.class)
    .collectList();

Map<String, Object> data = Mono.zip(personMono, hobbiesMono, (person, hobbies) -> {
        Map<String, Object> map = new HashMap<>();
        map.put("person", person);
        map.put("hobbies", hobbies);
        return map;
    })
    .block();  // 모든 호출을 병합한 후 한 번에 블록
```