---
layout: post
title: Unit Testing
date: 2025-11-26 09:00:00 +09:00
categories: [Spring, Testing]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- DI를 사용하는 Spring 어플리케이션은 컨테이너에 덜 의존적인 구조를 만들 수 있고, 그 결과로 POJO 수준에서 빠르고 단순한 단위 테스트가 가능해짐
- 진정한 단위 테스트는 외부 런타임 인프라를 띄우지 않고 아주 빠르게 실행되어야 함

<hr>

## Mock 객체 지원

- `org.springframework.mock.env.MockEnvironment`, `MockPropertySource`: 환경과 프로퍼티 소스 테스트용
- `org.springframework.mock.web`: Servlet API를 모의할 수 있는 구현들, 컨트롤러/필터 단위 테스트에 유용
- `org.springframework.mock.http.server.reactive` 및 `org.springframework.mock.web.server`: WebFlux용 서버 요청/응답 객체

<hr>

## 테스트 지원 클래스 및 유틸리티

- `org.springframework.test.util.ReflectionTestUtils`: private/protected 필드 조작, 메서드 호출 등을 테스트 시 사용할 수 있음
- `org.springframework.test.util.AopTestUtils`: AOP 프록시 뒤에 있는 실제 타깃 객체를 가져올 수 있음
- `org.springframework.test.web.ModelAndViewAssert`: Spring MVC의 모델+뷰 반환 테스트를 위한 유틸리티

<hr>

## Spring MVC 컨트롤러 단위 테스트

- 컨트롤러를 POJO로 단순화해서 테스트 할 수 있음 `MockHttpServletRequest`, `MockHttpServletResponse` 등을 사용해 요청/응답 환경을 흉내낼 수 있음
- 더 통합된 테스트가 필요하다면 `MockMvc`를 사용해서 실제 서블릿 컨테이너 없이 MVC 흐름을 검증 가능

<hr> 

## 단위 테스트의 특징 및 권장사항

- 매우 빠르게 실행되어야 함. 테스트가 느리면 개발 주기에 부담이 됨
- 외부 리소스 의존성을 최소화해야 함. 단위 테스트는 위 인프라 없이 로직만 집중하는 것이 이상적
- 코드가 잘 설계되어 있다면 mock이나 stub을 통해 쉽게 테스트 가능

<hr>

## 예제

```java
public class MyServiceTest {
    @Mock
    private MyRepository myRepository;

    private MyService myService;

    @BeforeEach
    public void setUp() {
        MockitoAnnotations.openMocks(this);
        myService = new MyService(myRepository);
    }

    @Test
    public void testCalculateSomething() {
        when(repository.getValue()).thenReturn(5);
        int result = myService.calculateSomething();
        assertEquals(10, result);
    }
}
```
