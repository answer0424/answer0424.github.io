---
layout: post
title: Integration Testing
date: 2025-11-26 09:00:00 +09:00
categories: [Spring, Testing]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- 통합 테스트는 어플리케이션의 여러 구성 요소가 실제로 함께 동작하는지 검증하는 테스트임
  - 즉, 단순 단위 메서드 이상의 상호작용을 검증함
- Spring에서는 별도의 어플리케이션 서버를 배포하지 않아도, `spring-test` 모듈 + 컨테이너 기반의 테스트 컨텍스트(`ApplicationContext`)를 통해 통합 테스트를 지원함
- 통합 테스트는 단위 테스트보다 느리지만, 실제 환경과 유사하게 빈 설정, 데이터 접근, 트랜잭션, 의존성 주입, 웹 계층 매핑 등을 포함해 시스템 전반이 올바르게 작동하는지 확인할 수 있음

<hr>

## Spring이 제공하는 통합 테스트 지원 요소


| 기능/지원 | 설명 |
|-|-|
| Spring TestContext Framework | 테스트용 `ApplicationContext` 생성, 관리, 캐싱 / 의존성 주입 / 트랜잭션 관리 등을 통합 지원 |
| 컨택스트 캐싱 | 한 번 로드된 `ApplicationContext`는 동일 JVM 내에서 테스트 간 재사용 됨 |
| 의존성 주입 | 테스트 클래스에도 `@Autowired`, `@Value` 등으로 빈 주입 가능 |
| 트랜잭션 관리 | 각 테스트 메서드마다 트랜잭션을 시작하고 기본적으로 롤백 |
| 전용 베이스 테스트 클래스 제공 | JDBC/ORM/웹 계층 등 레이어별로 미리 구현된 베이스 클래스를 상속해 편하게 테스트 가능 |
| 웹 계층 테스트 지원 | 컨트롤러 + MVC 매핑을 실제 어플리케이션 컨텍스트 기반으로 테스트 가능 |

<hr>

## 통합 테스트 작성 흐름 & 예시

#### 기본 흐름

1. 테스트 클래스에 Spring test 설정 어노테이션 지정
2. 필요한 빈을 `@Autowired` 또는 `@MockBean` 등으로 주입
3. 데이터베이스/Repository/서비스/웹 계층 등의 상호작용을 실제로 수행
4. 트랜잭션 기반이라면, 테스트 후 롤백이 기본이므로 DB가 깨끗한 상태 유지

<br>

#### 예시

```java
@SpringBootTest
public class MyServiceIntegrationTest {

    @Autowired
    private MyService myService;

    @Autowired
    private MyRepository myRepository;

    @Test
    public void testServiceMethod() {
        // given: DB 초기 상태 세팅 (예: repository.save(...))

        // when
        MyEntity result = myService.performBusinessLogic(...);

        // then
        assertThat(result).isNotNull();
        assertThat(/* some property */).isEqualTo(/* expected */);

        // DB 상태도 검증 가능
        List<MyEntity> list = myRepository.findAll();
        assertThat(list).hasSize(1);
    }
}
```

- 위 테스트는 전체 Spring 컨텍스트를 로드하고, 실제 Repository와 함께 동작하며, 비즈니스 로직 + DB 연동 + 설정이 잘 되었는지 검증
- 테스트 실행 후 DB 상태는 기본적으로 롤백되므로, 다른 테스트에 영향 없음 

<hr>

## 주의할 점

- 통합 테스트는 단위 테스트에 비해 실행 속도가 느리므로, 컨텍스트 로딩, DB 초기화, ORM 매핑 등이 포함될 경우 오버헤드가 큼
- 모든 테스트를 통합 테스트로 작성하면 시간이 오래 걸리고 유지보수 부담이 증가하므로, 단위 테스트 + 통합 테스트 비율을 적절히 설계하는 것이 좋음
- 여러 테스트가 같은 `ApplicationContext`를 공유하므로, 테스트 전후 상태를 절대적으로 초기화해야 할 경우 별도 설정 필요
- 외부 리소스에 대한 통합 테스트는 복잡성이 커질 수 있으므로 대체 stub 또는 테스트 전용 인프라 사용을 고려하는 것이 좋음

<hr>

## 사용 시기

| 목적/검증 내용 | 통합 테스트가 적합한 경우 |
|-|-|
| IoC 설정이 정상적인지 검증 | 빈 설정 + 의존성 주입 + 컨텍스트 구성 검증이 필요할 때 |
| 데이터베이스 + ORM/SQL 설정 + DAO/Repository 검증 | SQL 쿼리, 엔티티 매핑, 트랜잭션, 커밋/롤백 흐름을 실제 DB로 확인할 때 |
| 서비스 레이어 + DB + 외부 의존성 통합 동작 검증 | 여러 레이어 간 상호작용을 실제 조건으로 통합 검증할 때 |
| 웹 계층 + HTTP 요청/응답 흐름 검증 | 실제 웹 요청과 매핑, 직렬화/역직렬화, 인증/인가 흐름 검증이 필요할 때 |
| 전체 시스템의 흐름 | 특정 시나리오가 전체 시스템에서 제대로 동작하는지 확인 |