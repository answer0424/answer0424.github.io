---
layout: post
title: Appliction Events
date: 2025-11-28 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- TestContext Framework는 테스트 중에 ApplicationContext에 게시된 이벤트들을 기록할 수 있는 기능을 제공
- 이렇게 기록된 이벤트들은 테스트 안에서 확인할 수 있어서, 이 메서드 호출 ➡️ 특정 이벤트 발생 같은 흐름을 검증하는 데 유용

<hr>

## 사용법

#### 1. 테스트 클래스에 어노테이션 추가

- 테스트 클래스에 `@RecordApplicationEvents`를 붙여야 함
- 해당 어노테이션이 있어야 이벤트 기록이 활성화됨

<br>

#### 2. 기본 리스너 확인

- 이벤트 기록을 처리하는 기본 리스너인 ApplicationEventsTestExecutionListener는 디폴트로 등록되어 있음
- 별도 설정없이 사용할 수 있음
- 다만, 커스텀 리스너 설정(`@TestExecutionListeners`)을 쓰면서 기본 리스너를 제외했다면 직접 등록해야 함

<br>

#### 3. 테스트 내에서 `ApplicationEvents` 사용

- 테스트 메서드 또는 `@BeforeEach`/`@AfterEach` 등 생명주기 메서드에서, 매개변수 또는 `@Autowired` 필드로 `ApplicationEvents` 타입을 선언하면 됨
- 이 `ApplicationEvents`를 통해, 해당 테스트 동안 게시된 이벤트들을 Java Stream처럼 다룰 수 있음 

<br>

#### 4. 예시 코드

```java
@SpringJUnitConfig(MyConfig.class)
@RecordApplicationEvents
class OrderServiceTest {
    @Autowired
    OrderService orderService;

    @Test
    void submitOrder (ApplicationEvents events) {
        // 서비스 메서드 실행 → 내부에서 이벤트가 publish 됨
        orderService.submitOrder(new Order(...));

        // 이벤트 발행 확인
        long count = events.stream(OrderSubmittedEvent.class)
                           .count();
        assertThat(count).isEqualTo(1);
    }
}
```

<hr>

## 활용 시나리오

- 서비스 계층에서 도메인 이벤트를 사용하고 있을 때, 이벤트 퍼블리싱이 정상 작동하는지 테스트하고 싶을 때 유용
- 복잡한 비즈니스 로직이 여러 단계이고, 중간 단계에서 이벤트 발생 ➡️ 후속 처리 흐름이 있는 경우 흐름 검증
- 테스트 격리: 컨텍스트 재시작 없이 이 테스트 한정으로 어떤 이벤트가 발생했는지 기록 ➡️ 다른 테스트에 영향 안 줌