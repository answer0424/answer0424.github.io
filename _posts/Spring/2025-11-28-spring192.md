---
layout: post
title: Test Execution Events
date: 2025-11-28 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- Spring TestContext Framework는 테스트 라이프 사이클 각 단계에 대응하는 이벤트를 발행할 수 있음
  - 이 이벤트를 통해 테스트 흐름을 외부에서 관찰하거나 후처리할 수 있음
- 이를 가능하게 하는 건 `EventPublishingTestExecutionListener`이며, 이 리스너는 기본으로 등록되어 있음
- 하위는 각각 `TestExecutionListener` 인터페이스의 콜백 메서드에 대응됨

| 이벤트 | 대응 시점 |
|-|-|
| `BeforeTestClassEvent` | 테스트 클래스 실행 이전(`beforeTestClass`) |
| `PrepareTestInstanceEvent` | 테스트 인스턴스 준비 직후(`prepareTestInstance`) |
| `BeforeTestMethodEvent` | 테스트 메서드 실행 직전(`beforeTestMethod`) |
| `BeforeTestExecutionEvent` | 실제 테스트 실행 직전(`beforeTestExecution`) |
| `AfterTestExecutionEvent` | 실제 테스트 실행 직후(`afterTestExecution`) |
| `AfterTestMethodEvent` | 테스트 메서드 종료 후(`afterTestMethod`) |
| `AfterTestClassEvent` | 테스트 클래스의 모든 테스트 완료 후(`afterTestClass`) |

- 이 방식의 장점: 직접 `TestExecutionListener`를 구현하는 대신, 스프링 빈으로 등록된 일반 컴포넌트가 이벤트를 구독할 수 있음


<hr>

## 장점

- 테스트 전후 공통 로직을 구현하고 싶을 때
  - 예: 테스트 마다 mock reset, 테스트 데이터 초기화, 로깅, 통계 수집, 트레이스 ID 삽입 등
- `TestExecutionListener`를 구현하지 않고도, 일반 빈형태로 유연하고 DI-friendly 한 후처리 방법을 구성할 수 있을 때
- 테스트 프레임워크에 관계없이 동일한 이벤트 기반 후처리 로직을 유지하고 싶을 때
- 비동기 처리나 공통 관심사를 테스트 전후에 적용하고 싶을 때
- 여러 테스트 클래스/메서드에 걸쳐 일관된 테스트 환경 설정이나 정리 작업을 적용하고 싶을 때 

<hr>

## 예제 코드

```java
@Component
public class TestLifecycleListener {
    @org.springframework.context.event.EventListener
    public void handleBeforeClass(org.springframework.test.context.event.BeforeTestClassEvent ev) {
        System.out.println("Before Test Class: " + ev.getTestClass().getName());
    }

    @org.springframework.context.event.EventListener
    public void handleAfterMethod(org.springframework.test.context.event.AfterTestMethodEvent ev) {
        System.out.println("After Test Method: " + ev.getTestMethod().getName());
    }


    @org.springframework.context.event.EventListener
    public void handleAfterMethod(org.springframework.test.context.event.AfterTestMethodEvent ev) {
        System.out.println(">>> After Test Method: " + ev.getTestMethod());
    }
}
```

```java
// 2. 테스트 클래스 설정
@SpringJUnitConfig(MyTestConfig.class)
public class MyServiceTest {

    @Autowired MyService myService;

    @Test
    void testSomething() {
        // 테스트 로직
    }
}
```

- 위처럼 설정하면, 테스트 실행 흐름에 따라 `TestLifecycleLogger`의 이벤트 핸들러가 호출되고, 콘솔 등에 로깅 또는 후처리 로직이 실행됨
- 물론 `@EventListener` 대신 `ApplicationListener` 구현이나, 특정 어노테이션 전용 `@BeforeTestMethod`, `@AfterTestMethod` 등을 쓸 수도 있음