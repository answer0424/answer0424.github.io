---
layout: post
title: Context Configuration with XML
date: 2025-11-28 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, Context Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- Spring 테스트에서는 실제 어플리케이션 환경과 비슷한 `ApplicationContext`를 로드해서 테스트를 실행할 수 있음
- 이때 설정 방식은 다양하지만 그 중 하나가 XML 설정 파일을 사용하는 방식
- 테스트에서 기존 XML 스프링 설정을 그대로 재사용하고 싶거나, 자바 설정이 아닌 레거시 설정을 쓸 때 유용

<hr>

## 사용 방법

- 테스트 클래스에 `@ContextConfiguration` 어노테이션을 붙이고, `locations` 속성에 XML 설정 파일 경로를 지정

```java
@ExtendWith(SpringExtension.call)
@ContextConfiguration(locations = {"/app-config.xml", "/test-congfig.xml"})
public class MyTest {
    // 테스트 코드
}
```

- 경로 해석 규칙:
  - `"context.xml"` 등 상대 경로 ➡️ 테스트 클래스의 패키지 기준으로 클래스패스 내부 리소스로 간주
  - `"/something.xml"`처럼 슬래시로 시작 ➡️ 클래스패스의 루트 기준 절대 클래스 패스 리소스로 간주
  - `classpath:..."`, `"file:..."` 등 URL 접두사가 붙은 경로 ➡️ 그대로 해석
- 만약 `@ContextConfiguration`에 `locations`를 지정하지 않으면, 기본 로더가 자동으로 기본 XML 설정 파일명을 유추해 로드하려 시도함
  - 예: 테스트 클래스명이 `com.example.MyTest`이면 `classpath:com/example/MyTest-context.xml` 파일을 찾음

<hr>

## Context Management + 캐싱

- 테스트 실행 시 Spring은 `ApplicationContext`를 매번 새로 만드는 게 아니라, 동일 구성인 경우 Context를 캐싱해서 재사용함
  - 이는 테스트 실행 속도를 크게 높이는 중요한 기능
- 캐시 키로 쓰이는 속성들은 다음과 같은 것들이 있음
- 그래서 여러 테스트 클래스에서 동이한 XML 설정을 사용하면, 첫 번째 컨텍스트 로딩 이후엔 빠르게 재사용되어 효율적임
- 테스트 클래스 안에서 `Applicationcontext`를 사용하고 싶다면
  - 테스트 클래스가 `ApplicationContextAware`를 구현하거나
  - `@Autowired ApplicationContext applicationcontext;`처럼 필드 주입하거나
  - Web 어플리케이션 테스트라면 `@Autowired WebApplicationContext wac;`로 주입

<hr>