---
layout: post
title: Context configuration with Groovy scripts
date: 2025-11-28 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, Context Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- Spring TestContext Framework는 Groovy DSL을 사용한 설정 스크립트를 이용해 `ApplicationContext`를 구성할 수 있는 기능을 제공
- 즉, XML 설정이나 자바 설정 클래스 대신 Groovy의 Bean Definition DSL을 통해 빈 정의를 작성하고 테스트 컨텍스트 로딩에 활용할 수 있음
- 단, 이 기능은 클래스패스에 Groovy가 있어야 자동 활성화됨 만약 Groovy가 없다면 이 로더는 동작하지 않음 

<hr>

## 설정 방법 및 사용 예시

#### 1. 테스트 클래스에 설정하기

```java
@ExtendWith(SpringExtension.class)
@ContextConfiguration({ "/AppConfig.groovy", "/TestConfig.groovy" })
public class MyTest {

}
```


- 위 예시는 클래스패스 루트에 있는 `AppConfig.groovy`, `TestConfig.groovy` 파일을 이용해 `ApplicationContext`를 로드하는 설정

<br>

#### 2. 기본 위치 자동 감지

- `@ContextConfiguration`에 `locations` 또는 `value`를 지정하지 않으면 Spring TestContext는 기본 로더를 사용해 자동으로 Groovy 스크립트 위치를 유추하려 시도함

```bash
classpath:com/example/MyTestContext.groovy
```

<br>

#### 3. XML + Groovy 혼용 가능

```java
@ContextConfiguration({ "/app-config.xml", "/TestConfig.groovy" })
public class MixedConfigTest {
    // ...
}
```

- 이 경우, `.xml` 확장자는 XML 로더로, `.groovy` 확장자는 Groovy 로더로 각각 처리됨

<hr>

## 장점 & 활용 시나리오

- 더 간결하고 유연한 설정: Groovy DSL을 사용하면 빈 정의가 자바 기반 설정보다 간결하고, 동적 로직이나 조건을 넣기 쉬워 설정이 유연해짐
- 레거시 XML 설정 + 테스트 전용 Bean 조합: 기존 시스템이 XML 설정이 많이 사용하고 있을 때, 테스트에서만 추가/변경되는 빈을 Groovy 스크립트로 정의하기 용이
- 테스트 전용 설정의 분리: 프로덕션 설정과 테스트 설정을 분리함으로써, 테스트 전용 빈 / mock 빈 / stub 빈 등을 쉽게 구성
- 테스트 코드 가독성 향상: Groovy DSL은 비교적 간결해서 테스트 설정이 가독성 있게 유지됨
- 동적 설정 가능성: 조건 또는 외부 값에 따라 빈 설정을 분기하는 등, XML보다 유연한 설정 작성 가능