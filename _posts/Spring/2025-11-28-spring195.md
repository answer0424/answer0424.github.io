---
layout: post
title: Context Configuration with Component Classes
date: 2025-11-28 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, Context Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- 테스트에서 `ApplicationContext`를 로드할 때, XML이나 Groovy 대신 자바 설정 클래스를 사용할 수 있도록 지원
- 즉, 실제 어플리케이션에서 사용하는 설정 클래스를 재사용하거나, 테스트 전용 설정 클래스를 만들어 테스트 컨텍스트 구성 가능 

<hr>

## 설정 방법 - `@ContextConfiguration`

```java
@ExtendWith(SpringExtension.class)
@ContextConfiguration(classes = {AppConfig.class, TestConfig.class})
public class MyTest {
    // 테스트 코드 …
}
```

- 위 설정은 `AppConfig`, `TestConfig` 자바 설정 클래스를 기반으로 `ApplicationContext`를 생성하라는 의미

#### 컴포넌트 클래스가 될 수 있는 것들

- `@Configuration`이 붙은 설정 클래스
- `@Component`, `@Service`, `@Repository` 등 stereotype 어노테이션이 붙은 클래스
- `@Bean` 메서드를 가진 클래스
- 또는 자동 생성 가능한 bean 클래스도 포함 가능함 
  
<hr>

## 테스트 클래스 내에 중첩된 설정 클래스 사용하기

> 테스트 클래스 내부에 `static` 또는 nested 설정 클래스를 정의하고 별도 external 설정없이 그 클래스를 컨텍스트 설정으로 쓸 수도 있음

```java
@SpringJUnitConfig
public class  OrderServiceTest {
    @Configuration
    static class Config {
        @Bean
        public OrderService orderService() {
            return new OrderServiceImpl();
        }
    }

    @Autowired
    OrderService orderService;

    @Test
    void testOrderService() {
        // 테스트 코드 …
    }
}
```

- 위처럼 하면, 테스트 전용 설정 테스트 클래스 내부에 정의하고, 그 설정으로만 `ApplicationContext`를 구성할 수 있음

<hr>

## 장점

- 설정이 자바 코드로 되어 있어서, IDE 지원이 좋고, XML이나 Groovy보다 타입 안전
- 테스트 전용 설정을 클래스 내부에 한눈에 정의할 수 있어, 테스트 유지보수가 쉬움
- 실제 어플리케이션 설정을 그대로 재사용 가능 ➡️ 테스트와 실제 환경 간 설정 불일치 위험 감소ㅓ
- 여러 설정 클래스를 조합해서 복잡한 컨텍스트를 만들 수 있음

<hr>

## 유의사항  & 팁

- `@ContextConfiguration`에 지정하는 설정 클래스들이 실제 bean 정의로 문제가 없도록 해야 함
  - 예: 컴포넌트 스캔 범위, `@Bean` 메서드 등 만약 잘못된 설정이 있다면 테스트 시작 시 `ApplicationContext` 로드 실패 가능
- 테스트마다 서로 다른 설정 클래스를 지정하면, `ApplicationContext` 캐싱 효과가 떨어질 수 있음 
  - 실행 속도가 느려질 수 있음, 많이 쓸 경우 캐시 전략이나 `@DirtiesContext` 사용을 고려해야 함
- XML 설정, Groovy 설정, JavaConfig 설정을 혼합해야 할 때는 주의 필요 - bean 충돌이나 로딩 순서, 설정 우선순위 등을 잘 설계해야 함