---
layout: post
title: Test Execution Events
date: 2025-12-01 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, Context Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념 & 목적

- `TestExecutionEvents`는 테스트 실행의 여러 시점에 맞춰 이벤트를 발행하도록 설계된 기능
  - 이 이벤트들은 테스트 환경 내부에서 소비될 수 있음
- 이를 가능하게 하는 것은 기본으로 등록되는 리스너 `EventPublishingTestExecutionListener`로, 해당 리스너가 `TestExecutionListener` API 기반의 콜백들이 실행되는 시점마다 대응하는 이벤트를 Spring `ApplicationContext`에 게시함
- 이벤트 소비자는 단순한 `TestExecutionListener` 구현체가 아니라, Spring 빈으로 등록된 일반적인 컴포넌트가 될 수 있음
- 이런 구조 덕분에 테스트 프레임워크의 생명주기와 무관하게, Spring 내부 이벤트 기반으로 테스트 흐름을 관찰하거나 제어할 수 있다는 유연성이 생김 

<hr>

## 지원되는 이벤트 목록

| 이벤트 | 설명 |
|-|-| 
| `BeforeTestClassEvent` | 테스트 클래스 실행 전에 |
| `PrepareTestInstanceEvent` | 테스트 인스턴스 준비 직후 |
| `BeforeTestMethodEvent` | 테스트 메서드 실행 전 |
| `BeforeTestExecutionEvent` | 실제 테스트 메서드 실행 직전 - `@BeforeEach` 이후, 메서드 본문 직전 |
| `AfterTestExecutionEvent` | 테스트 메서드 실행 직후 |
| `AfterTestMethodEvent` | 테스트 메서드 이후 | 
| `AfterTestClassEvent` | 테스트 클래스의 모든 메서드 실행 후 | 

<hr>

## 이벤트 리스너 등록 - 사용방법

#### Spring bean + `@EventListener` 활용

> 이벤트를 처리할 클래스를 Spring 빈으로 등록하고 `@EventListener`로 원하는 이벤트 타입을 받아 처리할 수 있음

```java
@Component
public class TestLifecycleLogger {
    @EventListener
    public void onBeforeTestMethod(BeforeTestMethodEvent ev) {
        System.out.println("Before test method: " + ev.getTestMethod().getName());
    }

    @EventListener
    public void onAfterTestMethod(AfterTestMethodEvent ev) {
        System.out.println("After test method: " + ev.getTestMethod().getName());
    }
}
```

- 위 예시처럼 `@EventListener` 메서드를 통해 특정 테스트 실행 이벤트를 수신하고 처리할 수 있음

<br>

#### `@BeforeTestMethod`, `@AfterTestMethod` 등 전용 어노테이션 사용

- `@BeforeTestClass`, `@AfterTestMethod` 등 — 이벤트 타입에 대응하는 메서드에 붙이면 동작

<hr>

## 동작 특성 & 주의사항

- 기본적으로 `EventPublishingTestExecutionListener`는 ApplicationContext가 이미 로드된 경우에만 이벤트를 게시
  - 즉, 어떤 경우에는 `BeforeTestClassEvent`가 처음엔 발생하지 않을 수 있음
- 만약 테스트에서 `@TestExecutionListeners`로 커스텀 리스너 설정하면서 기본 리스너 집합을 덮어썼다면, 이벤트 게시 / 리스닝 기능은 동작하지 않음
- 이벤트 리스너 내부에서 예외가 발생하면 기본 테스트 프레임워크로 전파되어 테스트가 실패로 처리됨
- 비동기 리스너를 사용할 수 있지만, 이 경우 예외 처리가 달라짐 - 비동기에서는 예외가 원래 테스트 흐름에 반영되지 않을 수 있으니 주의가 필요