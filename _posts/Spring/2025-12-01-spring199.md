---
layout: post
title: Context Configuration with XML
date: 2025-12-01 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, Context Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---


## 개념

- Spring 테스트에서는 어플리케이션의 `Applicationcontext`를 실제 테스트용으로 로드해서 사용 가능
- 이때 설정 방식 중 하나로, 기존 프로젝트에서 사용하던 XML 설정 파일을 그대로 재사용할 수 있음
- 테스트 클래스에서는 특별히 상속이나 복잡한 설정 없이, 어노테이션만으로 컨텍스트 설정을 지정할 수 있어서 테스트 작성이 간결해짐

<hr>

## `@ContextConfiguration` 사용법

#### 기본 사용법

```java
@ExtendWith(SpringExtension.class)  // JUnit 5 환경에서 Spring과 연동
@ContextConfiguration(locations = { "/app-config.xml", "/test-config.xml" })
// 또는 @ContextConfiguration({ "/app-config.xml", "/test-config.xml" })
public class MyTest {
    // 테스트 코드 …
}
```

- 위 예시에서 `locations` 배열에 지정한 각 XML 파일이 클래스패스에서 로드되어 `ApplicationContext`가 생성됨
- 경로 규칙:
  - `"context.xml"`처럼 plain or 상대 경로 ➡️ 테스트 클래스가 속한 패키지를 기준으로 한 상태 클래스패스 리소스로 간주됨
  - `"/org/example/config.xml"`처럼 슬래시 시작 ➡️ 클래스패스 루트 기준의 절대 클래스패스 리소스로 간주됨
  - `"classpath:..."`, `"file:..."` 등 URL 접두사 있는 경로 ➡️ 그대로 리소스 위치로 사용됨

<br>

#### 기본값 사용

- 만약 `@ContextConfiguration`에 `locations` 또는 `value`를 지정하지 않으면, Spring은 기본 규칙을 사용해 XML 설정 파일을 유추할 수 있음
- 이 자동 유추 기능 덕분에 설정이 간단한 경우 `@ContextConfiguration`만 붙이면 되고, 별도 파일 지정이 필요 없음 

<hr>

## 장점

- 레거시 설정 재활용: 기존 프로젝트가 XML 설정 중심이라면, 설정을 거의 그대로 재사용하면서 테스트를 작성할 수 있어서 마이크레이션 부담이 적음
- 간단한 테스트 설정: `@ContextConfiguration` 만으로 설정 + 로딩이 가능하므로 테스트 코드가 간결함
- 설정 파일 분리: 운영 설정 + 테스트 전용 설정을 분리해서, 테스트 전용 빈을 XML로 구성 가능
- TestContext의 다양한 기능과 조합 가능: 트랜잭션, 프로파일, 프로퍼티 소스, 웹 컨텍스트 로딩, SQL 초기화, context caching 등 기존 Spring Test 지원 기능들과 함께 사용 가능 

<hr>

## 주의사항 & 유의점

#### 컨텍스트 캐싱 동작

- Spring TestContext는 같은 설정이면 이미 로드된 `ApplicationContext`를 재사용함 ➡️ 테스트 간 로딩 시간 줄여줌
- 하지만 만약 테스트 중에 XML 설정이나 빈 구성을 변경하거나 mock/spy bean을 동적으로 교체하는 경우 - 캐시된 컨텍스트를 재사용하면 상태가 공유되는 부작용이 있을 수 있음

<br>

#### XML + 자바/groovy 설정 병행 시 충돌 주의

- 만약 XML 설정과 자바 설정 또는 Groovy  설정을 혼용한다면, 빈 정의 충돌, 로딩 순서, 설정 우선순위 등을 주의해서 설계해야 함

<br>

#### 테스트 속도 고려

- 여러 XML 파일을 조합하거나 복잡한 설정이 많으면 `ApplicationContext` 로딩 시간이 길어질 수 있음 