---
layout: post
title: Context Configuration with Context Initializers
date: 2025-12-02 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, Context Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념

- Context Initializer는 테스트용 `ApplicationContext`가 로드될 때 빈을 정의하거나 환경을 설정하는 프로그래밍 초기화 로직을 삽입할 수 있게 해주는 매커니즘
- 구체적으로 `org.springframework.context.ApplicationContextInitializer<ConfigurableApplicationContext>` 인터페이스를 구현한 클래스를 지정하고, 이를 통해 `ApplicationContext`가 생성된 직후
- 이런 초기화 작업은 단순 프로퍼티 설정, 프로파일 활성화, 빈 등록, 모의 빈 삽입, 외부 리소스 설정 등 다양할 수 있어서, 테스트 전용 설정 + Bean 구성 + 환경 조정을 유연하게 할 수 있음

<hr>

## 사용 시기

- 테스트마다 공통 설정이 필요하거나 환경 설정 + 빈 등록 + 커스텀 초기화 로직이 반복될 때
- XML/자바 설정 클래스만으로는 표현하기 번거롭거나 불가능한 복잡한 초기화 로직이 있을 때
- 어플리케이션 설정과 테스트 설정을 최대한 분리하고 싶을 때: 실제 설정 클래스와 테스트 전용 초기화 코드를 분리함으로써, production 설정은 그대로 두고 테스트 전용 설정만 추가 가능
- 테스트 간 설정 변경을 덜 반복하면서 재사용성을 높이고 싶을 때 

<hr>

## 예시

#### 1. `ApplicationContextInitializer` 구현

```java
public class TestAppCtxInitializer implements ApplicationContextInitializer<ConfigurableApplicationContext> {
    @Override
    public void initialize(ConfigurableApplicationContext ctx) {
        // 예: 환경 변수 또는 프로퍼티 추가
        ctx.getEnvironment().getSystemProperties().put("some.test.property", "true");

        // 또는 프로파일 활성화
        ctx.getEnvironment().addActiveProfile("test");

        // 또는 bean 정의 등록 (예: 테스트 전용 mock bean)
        GenericBeanDefinition bd = new GenericBeanDefinition();
        bd.setBeanClass(MyMockedService.class);
        ctx.registerBeanDefinition("myMockedService", bd);
    }
}
```

<br>

#### 2. 테스트 클래스에 `@ContextConfiguration` 지정 - `initializers` 속성


```java
@ExtendWith(SpringExtension.class)
@ContextConfiguration(
    classes = TestConfig.class,
    initializers = TestAppCtxInitializer.class
)
public class MyTest {
    // 테스트 코드 …
}
```

- 이 설정으로, `TestConfig` 기반으로 빈 정의가 로드되기 전에 `TestAppCtxInitializer.initialize()`가 호출되어 초기화 작업이 먼저 수행됨
