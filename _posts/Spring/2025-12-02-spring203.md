---
layout: post
title: Context Configuration Inheritance
date: 2025-12-01 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, Context Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념 

- Spring TestContext는 테스트 클래스 상속체계가 있을 경우 상위 클래스에 정의된 `@ContextConfiguration` 설정을 하위 클래스가 자동으로 물려받는 기능을 제공
- 즉, 테스트 클래스 간에 기본 설정을 재사용하면서, 하위 클래스에서 추가 설정만 정의하는 방식으로 테스트 설정을 계층화할 수 있음
- 이 상속 동작은 기본적으로 활성화되어 있으며, `@ContextConfiguration` 에는 다음 두 속성이 존재
  - `inheritLocations` - 리소스 위치 / 설정 클래스 상속 여부
  - `inheritInitializers` - context initializer 상속 여부

<hr>

## 예제

```java
@ExtendWith(SpringExtension.class)
@ContextConfiguration("/base-config.xml")
class BaseTest {
    // ...
}

@ContextConfiguration("/extended-config.xml")
class ExtendedTest extends BaseTest {
    // ...
}
```

> 위 경우 `ExtendedTest`의 `ApplicationContext`는 `/base-config.xml` + `/extended-config.xml` 두 설정을 모두 로드

<br>

```java
@SpringJUnitConfig(BaseConfig.class)
class BaseTest { … }

@SpringJUnitConfig(ExtendedConfig.class)
class ExtendedTest extends BaseTest { … }
```

> 여기서도 `ExtendedTest`는 `BaseConfig` + `ExtendedConfig` 두 설정을 모두 사용

<br>

#### 만약 상속을 원하지 않을 경우 

```java
@ContextConfiguration(locations = "/child-config.xml", inheritLocations = false)
class ChildTest extends BaseTest { … }
```

> 이렇게 하면, `ChildTest`는 부모의 `/base-config.xml` 설정을 무시하고, 오직 `/child-config.xml` 설정만 사용

<hr>

## 사용 시기

- 여러 테스트 클래스가 공통 설정을 사용하면서도, 각각의 테스트 클래스마다 추가 설정이 필요할 때 
  - base 설정 + 클래스별 추가 설정 조합 가능
- 테스트 설정의 중복 방지 + 유지보수 편의성: 공통 설정을 상위 클래스에 모아두고, 하위 클래스에서는 필요한 변경만 적용
- 테스트 계층 간 설정 일관성 유지: 여러 테스트가 동일 base context를 공유해서, 테스트 간 설정이 뒤섞이는 것을 줄일 수 있음

<hr>

## 주의사항

- 만약 상속된 설정 + 하위 설정을 혼용할 때, 빈 충돌 또는 오버라이드 문제가 생길 수 있음
- 상속을 무시하고 싶다면 `inheritLocations=false`, `inheritInitializers=false` 등 속성을 명시해줘야 함
- 설정 상속 + context caching + context customizer/initializer 등이 얽힐 경우, 어떤 설정 조합이 최종 컨텍스트를 결정하는지 복잡해짛 수 있으니 주의가 필요 