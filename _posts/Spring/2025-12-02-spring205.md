---
layout: post
title: Loading a WebApplicationContext
date: 2025-12-02 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, Context Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---


## 개요

- TestContext Framework는 단순한 일반 `ApplicationContext` 뿐 아니라, 웹 어플리케이션용 `WebApplicationContext` / 서블릿 컨텍스트 기반 설정도 지원
- 즉, 실제 웹 서버 없이도 `WebApplicationContext`를 로드하고, 웹 계층 동작을 검증할 수 있는 환경을 구성 가능

<hr>

## 설정 방법

#### 핵심 어노테이션 + 클래스

- 일반 테스트에서는 `@ContextConfiguration`, `@SpringJUnitConfig` 등을 사용하지만, 웹 계층 테스트라면 아래 어노테이션들을 조합하여 사용
  - `@WebAppConfiguration`: 테스트용 웹 어플리케이션 컨텍스트를 로드하도록 지정
  - `@ContextConfiguration`: 어떤 설정으로 웹 컨텍스를 구성할지 지정
  - 또는 spring Boot + 테스트 환경이라면 `@SpringJUniConfig` 등을 쓸 수 있음 
- 테스트 클래스에서 `WebApplicationContext`를 `@Autowired`로 주입받으면, 컨트롤러 + 필터 + 서블릿 설정이 반영된 상태의 컨텍스를 이용할 수 있음

<br>

#### 실제 HTTP 요청 시뮬레이션 - `MockMvc`

- 웹 계층 테스트에서 자주 사용하는 방식은 `MockMvc`
  - 이걸 사용하면 실제 서블릿 컨테이너 없이 HTTP 요청/응답 흐름을 흉내낼 수 있음
- 일반적으로 테스트 클래스에 다음과 같은 구조가 됨

```java
@ExtendWith(SpringExtension.class)
@WebAppConfiguration
@ContextConfiguration("classpath:/servlet-context.xml")
public class MyControllerTest {

    @Autowired
    private WebApplicationContext wac;

    private MockMvc mockMvc;

    @BeforeEach
    void setup() {
        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();
    }

    @Test
    void testGetSomething() throws Exception {
        mockMvc.perform(get("/api/hello"))
               .andExpect(status().isOk())
               .andExpect(jsonPath("$.message").value("hello"));
    }
}
```

> 이처럼 `wac`를 통해 웹 컨텍스트를 로드하고, `MockMvcBuilders.webAppContextSetup(...)`으로 MockMvc 객체를 만든 후 테스트 가능

<hr>

## 장점 / 유용한 이유

- 서블릿 컨테이너 없이 웹 컨트롤러 + 필터 + 서블릿 설정 테스트 가능: 외부 WAS나 톰캣을 띄울 필요 없이, 순수 JVM + Spring 만으로 웹 계층 테스트 가능
- MVC 흐름 전체 테스트: URL 매핑, 핸들러 매핑, 필터/인터셉터, 데이터 바인딩, 검증, 응답 직렬화/역직렬화, 예외 핸들링 등 실제 요청-응답 과정을 거의 실환경처럼 시뮬레이션 가능
- 짧고 빠름: 실제 배포 환경을 띄우는 통합 테스트보다 경량이고 빠르게 실행되어 개발 주기에서 피드백을 빠르게 받을 수 있음

<hr>

## 유의사항

- 빈 설정 주의: 웹 컨텍스트 설정을 테스트용으로 적절히 구성해야 함
- 컨텍스트 캐싱 영향: TestContext는 동일 설정을 사용하는 테스트들끼리 `ApplicationContext`를 캐싱 + 공유
- MockMvc 한계: `MockMvc`는 실제 네트워크, WAS 특성, 필터 페인, 서블릿 컨테이너 내부 동작, 세션 관리 일부 등 흉내-모킹하는 방식이므로 완전히 동일하지는 않음
- 설정 복잡성 증가 시 주의: XML + JavaConfig + Web 설정 + 테스트 전용 설정이 뒤얽히면, 어떤 빈/설정이 최종적으로 로드되는지 추적이 어려울 수 있음
