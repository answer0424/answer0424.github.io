---
layout: post
title: Working with Web Mocks
date: 2025-12-02 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, Context Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---


## 개요

- Spring TestContext는 단순한 `ApplicationContext` 기반 테스트 뿐 아니라, 웹 어플리케이션용 `WebApplicationContext` + mock 서블릿 환경을 지원
  - 즉, 실제 톰캣 / 서블릿 컨테이너 없이도 웹 요청 / 응답을 흉내낸 테스트가 가능
- 이를 가능하게 해주는 것은 Spring의 mock servlet API 구현체들 - 예: `MockHttpServletRequest`, `MockHttpServletResponse`, `MockHttpSession` 등
- 또한, 프레임워크 차원에서 WebApplicationContext 생성 + mock servlet environment 구성을 지원하므로, 테스트 클래스는 복잡한 설정 없이 웹 컨텍스트 / mock servlet 환경을 쓸 수 있음 

<hr>

## 설정 방법 & 사용법

#### 테스트 클래스 설정

```java
// Java + JUnit 5 예시
@ExtendWith(SpringExtension.class)
@WebAppConfiguration              // WebApplicationContext + mock servlet context 로드
@ContextConfiguration(locations = "/web-servlet-config.xml")  // 또는 자바 Config 클래스
public class MyControllerTest {

    @Autowired
    WebApplicationContext wac;   // 주입된 WebApplicationContext

    private MockMvc mockMvc;

    @BeforeEach
    void setup() {
        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();
    }

    @Test
    void testGetEndpoint() throws Exception {
        mockMvc.perform(get("/api/hello"))
               .andExpect(status().isOk())
               .andExpect(jsonPath("$.message").value("Hello"));
    }
}
```
  
- `@WebAppConfiguration`을 통해 테스트용 `WebApplicationContext` + mock servlet 환경을 활성화
- `wac`를 주입받고, `MockMvcBuilders.webAppContextSetup(wac).build()`로 `MockMvc` 인스턴스 생성
  - 이후 `mockMvc.perform(...)`으로 HTTP 요청 시뮬레이션 가능
- `MockHttpServletRequest`, `MockHttpServletResponse`, `MockHttpSession` 등 low-level mock 객체를 직접 이용해 테스트할 수도 있으나, 보통은 `MockMvc` 사용 + WebApplicationContext 기반 테스트가 더 일반적이고 편의성이 높음

<br>

#### 스프링부트 + 테스트 시

- 만약 Spring Boot + 테스트 환경이라면, `@SpringBootTest(webEnvironment = WebEnvironment.MOCK)` 또는 `@AutoConfigureMockMvc` 등을 사용해 자동으로 mock servlet 환경 + MockMvc 구성이 가능
- 이 경우에도 컨트롤러, 필터, JSON 직렬화/역직렬화, 검증, 예외 핸들러 등 대부분의 웹 계층 로직 mock 환경에서 테스트할 수 있음

<hr>

## Web Mocks 사용 이유

- 서블릿 컨테이너 없이 웹 계층 테스트 가능 - 실제 WAS를 띄우지 않아도 웹 요청 응답 흐름 + 스프링 MVC 동작 테스트 가능
- 가볍고 빠름 - 무거운 컨테이너 로딩 없이 단위/통합 수준 웹 기능 테스트를 빠르게 수행, 개발 속도 및 피드백 주기 단축
- JSON/XML 응답, 요청 바인딩, 필터, 예외 핸들러, 인터셉터, 세션, 쿠키 등 웹 관련 여러 요소 테스트 지원 - 실제 흐름과 유사한 환경 제공
- Mock 객체 제공 + Spring 통합 - Spring이 제공하는 mock servlet API 덕분에 별도의 mocking 프레임워크 없이도 HTTP 요청/응답, 세션 등 테스트 가능