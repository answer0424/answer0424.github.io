---
layout: post
title: Context Hierarchies
date: 2025-12-03 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, Context Management]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념 

- 보통은 테스트를 위해 하나의 `ApplicationContext`만 로드하면 충분하지만, 경우에 따라 부모-자식 구조의 여러 Context를 함께 구성해야 할 때가 있음
- 전형적인 예는 웹 어플리케이션
  - 루트 컨텍스트 - 공통 인프라, 서비스 계층, DAO, 공통 빈 등 
  - 서블릿 전용 컨텍스트 - 컨트롤러, 뷰 리졸버, 핸들러 매핑 등 웹-계층 빈들 
- 다른 예: 배치 작업 또는 복잡한 모듈 구성 - 부모 컨텍스트에 공통 구성, 자식 컨텍스트에 Job / 모듈 - specific 설정 분리

<hr>

## 설정 방법 - `@ContextHierarchy` 사용

```java
@ExtendWith(SpringExtension.class)
@WebAppConfiguration
@ContextHierarchy({
    @ContextConfiguration(classes = TestAppConfig.class),  // root context
    @ContextConfiguration(classes = WebConfig.class)       // servlet / web context (child)
})
class ControllerIntegrationTests {

    @Autowired
    WebApplicationContext wac;  // child context가 주입됨

    // 테스트 메서드들 ...
}
```

- 위 예에서는 `TestAppConfig`(root) + `WebConfig`(child)를 계층으로 구성
- 테스트 클래스에서 `@Autowired WebApplicationContext`로 주입받는 컨텍스트는 child임
- 