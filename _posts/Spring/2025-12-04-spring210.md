---
layout: post
title: Bean Overriding in Tests
date: 2025-12-04 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념

- 테스트를 할 때, 원래 어플리케이션 컨텍스트에 정의된 빈을 테스트 전용 빈으로 대체하거나, 새 빈을 추가하는 기능을 말함
  - 즉, 프로덕션 설정을 그대로 두면서 테스트용으로 일부 빈을 override 하거나 substitute 할 수 있음
- 이 기능은 `beanFactory.setAllowBeanDefinitionOverriding(true)`와 같은 전역 설정 대신 - 테스트에 국한된 안전한 방식으로 제공
  - 즉, 테스트 컨텍스트 구성 시에만 빈을 재정의하도록 설계
- 프레임워크는 두 주요 방식의 bean-override 어노테이션을 제공
  - `@TestBean` - Spring 기반
  - `@MockBean` / `@MockitoBean` - Mockito 기반 mock/spy 빈으로 대체하기 위한 어노테이션
- 내부적으로 `@BeanOverride` 메타어노테이션 + `BeanOverrideProcessor` + `ContextCutomizerFactory` + `TestExecutionListener` 기반 인프라가 작동하여, 테스트용 컨텍스트가 로드되기 전에 빈 정의를 대체하거나 추가함
- 대체 방식
  - **REPLACE**: 기존 빈을 대체
  - **REPLCAE_OR_CREATE**: 기존 빈이 있으면 대체, 없으면 새로 생성
  - **WRAP**: 원래 빈을 감싸거나 래핑하도록 변경
- 중요한 점: 만약 원래 빈이 prototype이거나 FactoryBean을 통해 생성된 빈이면, override 후에는 대신 singleton 빈으로 바뀔 수 있음