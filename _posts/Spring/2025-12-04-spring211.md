---
layout: post
title: Testing Request- and Session-scoped Beans
date: 2025-12-04 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 웹 스코프 빈이란

- 스프링에는 단순 singleton, prototype 스코프 외에, 웹 어플리케이션 환경에서만 동작하는 웹 스코프가 존재 
  - 예: `request`, `session`, `application`, `websocket` 등
- request-scoped bean은 HTTP 요청 하나를 단위로 생성/소멸되며, session-scoped bean은 HTTP 세션 단위로 생성되고 세션이 끝날 때까지 유지됨
- 실제 웹 어플리케이션에서는 정상적으로 동작하지만, 테스트에서 이 스코프 빈을 사용하려면 웹 컨텍스트 + 모의 환경이 필요 - 이것을 지원하는 것이 TestContext의 web-scoped 빈 테스트 기능

<hr>

## TestContext 사용하여 웹 스코프 빈 테스트하는 방법

1. 테스트 클래스에 `@WebAppConfiguration` 어노테이션을 붙여서, `WebApplicationContext`를 로드하게 됨
2. 테스트 클래스에서 `MockHttpServletRequest`, `MockHttpSession`을 `@Autowired`로 주입받음
3. 테스트 대상 빈 - reqeust-scoped, session-scoped 빈을 포함하는 서비스 또는 웹 컴포넌트를 DI를 통해 주입받음
4. 테스트 메서드 안에서 mock request/session에 원하는 상태나 파라미터를 설정
5. 그런 뒤 서비스 또는 컨트롤러 호출 ➡️ 내부에서 request/session scoped 빈이 정상적으로 동작하는지 검증