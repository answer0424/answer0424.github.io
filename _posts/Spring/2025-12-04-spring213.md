---
layout: post
title: Executing SQL Scripts
date: 2025-12-04 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 필요 이유

- 통합 테스트에서 실제 데이터베이스 스키마 생성, 초기 데이터 삽입, 테스트별 DB 상태 초기화 등이 필요할 때가 많음
- 매번 DAO/Repository 레이어 호출로 테스트 데이터를 세팅하거나 지우는 것보다, SQL 스크립트를 통해 테이블 생성 + 초기 데이터 삽입 + cleanup을 자동화하면 훨씬 편리하소 명확
- Spring은 이런 필요를 위해, 테스트 컨텍스트 로딩 시 또는 테스트 실행 중에 SQL 스크립트를 자동 또는 수동으로 실행할 수 있는 메커니즘을 제공

<hr>

## 지원방식: 프로그래밍 방식 vs 선언 방식


#### 프로그래밍 방식

- `org.springframework.jdbc.datasource.init.ResourceDatabasePopulator`
- `org.springframework.jdbc.datasource.init.ScriptUtils`
- (JUnit 4 / TestNG 사용 시) `AbstractTransactionalJUnit4SpringContextTests`, `AbstractTransactionalTestNGSpringContextTests` 등의 편의 메서드

<br>

#### 예시

```java
@Test
void databaseTest() {
    ResourceDatabasePopulator pop = new ResourceDatabasePopulator();
    pop.addScripts(
        new ClassPathResource("test-schema.sql"),
        new ClassPathResource("test-data.sql")
    );
    pop.setSeparator(";;");  // (예: 커스텀 구분자 사용 시)
    pop.execute(dataSource);

    // 이후 테스트 로직 실행
}
```