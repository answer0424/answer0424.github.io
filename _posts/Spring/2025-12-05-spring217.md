---
layout: post
title: RestTestClient
date: 2025-12-05 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념과 목적

- RestTestClient는 서버 어플리케이션을 테스트하기 위한 HTTP 클라이언트
- 즉, 실제 서버를 띄우는 end-to-end 테스트 혹은 서버 없이 mock/컨텍스트만으로 REST API 레벨의 통합이나 단위 테스트를 할 때 모두 활용될 수 있음
- 과거에 많이 쓰였던 MockMvc나 WebTestClient 대신 또는 보완재로 사용되며, Spring 7.0부터 공식 지원되는 비교적 최신 도구

<hr>

## RestTestClient 사용 방식

| 바인딩 방식 | 언제 / 어떤 용도인가 | 특징 |
|-|-|-|
| bindToController | 특정 컨트롤러만 단위 테스트할 때 | 지정한 컨트롤러 객체로ㅓ만 mock 요청/응답 처리 ➡️ 가장 가볍고 빠른 테스트 |
| bindToApplicationContext | Spring MVC/Web 설정 + 여러 컨트롤러 포함 전체 어플리케이션 컨텍스트 테스트 시 | 실제 스프링 설정을 로드하고 handler mapping, 변환기 등 포함 |
| bindToRouterFunction | WebFlux 라우터 기반 API를 functional routing 방식으로 구현했을 때 | RouterFunction + handler function 기반 API 테스트 가능 |
| bindToServer().baseUrl() | 실제 서버가 가동중이거나 외부 서버 대상 테스트할 때 | HTTP over network 호출 ➡️ 실환경과 유사한 통합 테스트 가능 |

<hr>

## 간단한 테스트 설정 + 호출 예제

```java
@SpringJUnitConfig(WebConfig.class)  // Web 설정 클래스
class MyApiTest {

    RestTestClient client;

    @BeforeEach
    void setUp(ApplicationContext context) {
        client = RestTestClient.bindToApplicationContext(context).build();
    }

    @Test
    void testHelloEndpoint() {
        client.get().uri("/api/hello")
              .exchange()
              .expectStatus().isOk()
              .expectBody()
              .jsonPath("$.message").isEqualTo("Hello, world!");
    }
}
```

- 위 구조는 서버를 실제 띄우지 않고도 스프링 MVC + 컨트롤러 + JSON 변환까지 포함한 API 테스트를 가능하게 함

<hr>

## 장점

- 단일 API로 통합된 테스트 방식 - 컨트롤러 단위 테스트, 전체 MVC 컨텍스트 기반 테스트, WebFlux 라우터 테스트, 실제 서버 대상 테스트까지 하나의 클라이언트 API로 커버 가능
- 간결하고 fluently 구성 가능한 테스트 코드 - 기존 mockMvc보다 구문이 간결하고 직관적이라는 평가가 많음
- Spring 최신 HTTP client 기반 - Spring 7.0 / RestClient 기반이라 최신 스택과 잘 어울림
- 유연성 - 테스팅 목적과 환경에 따라 가볍고 빠른 단위테스트 통합 / E2E 테스트를 쉽세 전환 가능

<hr>

## 주의사항

- 다른 테스트 클라이언트와 일부 동작 차이나 subtle한 차이가 있을 수 있음
- 실제 WAS 환경 고유 동작은 mock/embedded 방식으로는 완벽히 재현되지 않을 수 있음
- 프로젝트가 아직 Spring 7.0미만이거나 RestClient 기반 스택이 아니라면 사용이 제한될 수 있음