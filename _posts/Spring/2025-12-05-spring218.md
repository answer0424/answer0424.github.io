---
layout: post
title: MockMvc Overview
date: 2025-12-05 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, MockMvc]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개념

- MockMvc는 실제 서버를 띄우지 않고도, Spring MVC 어플리케이션의 HTTP 요청 ➡️ 응답 흐름을 가짜 환경에서 거의 완전히 재현해주는 테스트 프레임워크
- 즉, 컨트롤러 + 핸들러 매핑, `@RequestBody`/`@ResponseBody`, `@InitBinder`, `@ModelAttribute`, 예외 핸들러 등 Spring MVC의 핵심 기능이 정상 동작하는지를 가장 가볍고 빠른 방식으로 테스트할 수 있음
- MockMvc는 서버 없는 테스트 + 가볍고 빠른 테스트 + 실제 HTTP 요청/응답과 유사한 수준의 흐름 검증이라는 장점을 가짐

<hr>

## MockMvc의 주요 기능 & 장점

- 서블릿 컨테이너 없이 테스트 가능 - 톰캣, Jetty 등 WAS를 띄우지 않아도 되는 경량 테스트 환경
- 실제 MVC 흐름 거의 완전 시뮬레이션 - 단순한 메서드 호출 테스트 수준을 넘어서, 요청 매핑, 데이터 바인딩, validation, message converter, exception handler, view resolution 등 다양한 MCX 기능을 포함해서 테스트 가능
- 응답에 대한 세밀한 검증 가능 - 상태 코드, 헤더, 콘텐츠 타입, 본문 view이름, 리다이렉트, 모델 속성, 세션/쿠키 변화 등 다양한 항목을 `andExpect()`, `andDo()` 등을 통해 검증
- 테스트 속도 & 독립성 - 실제 서버를 띄우지 않기 때문에 빠르게 실행되고, 환경에 영향 적어서 CI 환경이나 로컬에서도 안정적으로 반복 실행 가능 

<hr>

## 예제

```java
// 예: JUnit 5 + Spring Boot 환경
@SpringBootTest  // 또는 @WebMvcTest(Controller class) 등
@AutoConfigureMockMvc  // Spring Boot + MockMvc 자동 설정
public class MyControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @Test
    void testGetSomething() throws Exception {
        mockMvc.perform(get("/api/hello")                    // ① 요청 설정
                  .param("name", "Alice")                    // (옵션) 파라미터/헤더/본문 등 설정
                  .accept(MediaType.APPLICATION_JSON))
               .andExpect(status().isOk())                   // ② 응답 검증
               .andExpect(content().contentType(MediaType.APPLICATION_JSON))
               .andExpect(jsonPath("$.message").value("Hello, Alice"))
               .andDo(print());                              // (옵션) 요청/응답 로그 출력
    }
}
```

> 또는 Spring Mvc 설정 + 컨트롤러 단위 테스트하고 싶다면

```java
MockMvc mockMvc = MockMvcBuilders.standaloneSetup(new MyController()).build();
// 또는 WebApplicationContext 기반 테스트: MockMvcBuilders.webAppContextSetup(wac).build();
```

<hr>

## MockMvc로 할 수 없는 것

- MockMvc는 mock servlet API 기반 테스트이기 떄문에 실제 WAS 환경 고유 동작은 완전하게 재현하지 않음
- 즉, JSP 렌더링, JSP 기반 뷰 리졸버, 실제 서블릿 컨테이너-specific 설정, HTTP/2, 서버-specific 최적화 또는 일부 컨테이너 ㅅ종속 기능은 테스트되지 않을 수 있음
- 만약 어플리케이션이 복잡하고, 전체 스택을 포함한 E2E 테스트가 필요하다면 MockMvc 만으로는 한계가 있고 실제 서버 또는 다른 테스트 도구를 병행해야 할 수 있음 