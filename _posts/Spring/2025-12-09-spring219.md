---
layout: post
title: Setup options
date: 2025-12-09 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, MockMvc]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## MockMvc 설정 방식

| 방식 | 설명 |
|-|-|
| WebApplicationContext 기반 | 실제 스프링 MVC 설정, 빈, 컨트롤러, 필터, 인터셉터 등 전체 컨텍스트를 로드 ➡️ 실제 어플리케이션 환경에 가까운 통합-레벨 테스트 가능 |
| standalone | 테스트할 컨트롤러만 지정하고, 필요한 의존성을 직접 mock / stub / 수동 주입 ➡️ 경량, 단일 컨트롤러 중심의 단위 테스트/슬라이스 테스트에 적합 |

<hr>

## 선택 가이드

#### WebApplicationContext 기반 - 통합 / 웹 레이어 전체 테스트

- 실제 프로젝트의 Spring MVC 설정을 그대로 로드하고 싶을 때
- 컨트롤러 + 빈 의존성 + Spring 설정이 복합적으로 얽혀 있는 흐름을 통합 테스트하고자 할 때
- 여러 컨트롤러에 대한 공통 설정을 유지하면서 반복 테스트를 수행하고 싶을 때
- 실제 운영 환경과 유사하게 요청 ➡️ DispatcherServlet ➡️ 핸들러 ➡️ 리턴 ➡️ 응답변화 + 예외처리 + 필터/인터셉터 흐름 전반을 검증하고 싶을 때

> 장점: 실제 설정을 거의 그대로 반영 ➡️ 안정성/신뢰성 높음, 캐시 덕분에 여러 테스트 돌려도 속도 괜찮음
>
> 단점: 설정 로딩 오버헤드 + 테스트 환경이 조금 무거움

<br>

#### standalone - 단위 / 슬라이스 테스트

- 특정 컨트롤러 하나만 집중해서 빠르게 테스트하고 싶을 때
- 서비스나 리포지토리는 mock/stub으로 대체해서, 컨트롤러 로직 + 요청/응답 + validation/바인딩만 검증하고 싶을 때
- 설정 로딩 없이 가볍고 빠르 피드백이 중요할 때 - 예: TDD, 단위 테스트, 일부 버스 재현, 로직 검증 등
- 어떤 필터나 설정이 필요없는 단순 컨트롤러 + request/response + JSON 변환 + status/body 검사 

> 장점: 가볍고 빠름, 설정이 간단, mock/stub injection 자유, 테스트 코드 가독성 / 집중성 높음
>
> 단점: Spring MVC 전체 설정은 반영 안됨 ➡️ 필터/인터셉터/예외 핸들러/컨버터/뷰 리졸버 등이 무시되기 쉬움

<hr>

## 설정 예제 코드

#### WebApplicationContext 기반 설정

```java
// JUnit 5 + Spring TestContext + 실제 WebApplicationContext
@SpringJUnitWebConfig(locations = "classpath:/my-servlet-context.xml")
public class MyControllerIntegrationTest {

    private MockMvc mockMvc;

    @BeforeEach
    void setup(WebApplicationContext wac) {
        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();
    }

    @Test
    void testGetUser() throws Exception {
        mockMvc.perform(get("/api/users/1"))
               .andExpect(status().isOk())
               .andExpect(content().contentType(MediaType.APPLICATION_JSON))
               .andExpect(jsonPath("$.id").value(1));
    }
}
```

<br>

#### Standalone 설정

```java
public class MyControllerUnitTest {

    private MockMvc mockMvc;

    @Mock  // Mockito 등으로 의존 주입 mock
    private UserService userService;

    @InjectMocks
    private UserController userController;

    @BeforeEach
    void setup() {
        MockitoAnnotations.openMocks(this);
        mockMvc = MockMvcBuilders.standaloneSetup(userController).build();
    }

    @Test
    void testGetUserNotFound() throws Exception {
        when(userService.findById(999)).thenReturn(Optional.empty());

        mockMvc.perform(get("/api/users/999"))
               .andExpect(status().isNotFound());
    }
}
```

<hr>

## 판단 기준

- 컨트롤러 + Spring 설정 전체 + JSON 변환 + 필터/예외 핸들러 포함 등 실제 요청 흐름을 거의 완벽하게 테스트하고 싶다면 ➡️ WebApplicationContext 기반 설정
- 특정 컨트롤러 로직 / 바인딩 / validation / 간단한 응답 구조만 빠르게 검증하고 싶다 ➡️ standalone 설정