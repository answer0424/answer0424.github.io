---
layout: post
title: Configuring MockMvc
date: 2025-12-09 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, MockMvc, Hamcrest]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## MockMvc 설정 방식

| 방식 | 설명 |
|-|-|
| `MockMvcBuilders.standaloneSetup()` | 특정 컨트롤러만 지정하고, 필요한 설정을 최소한으로 구성 ➡️ 스프링 MVC 인프라를 프로그래밍 방식으로 설정 |
| `MockMvcBuilders.webAppContextSetup()` | 실제 스프링 MVC 설정과 빈 컨텍스트를 로드한 뒤, 전체 어플리케이션 컨텍스트 기반으로 MockMvc 구성 ➡️ 필터, 인터셉터, 예외 핸들러 등 모든 설정 반영 |

<hr>

## 언제 어떤 방식을 사용하는 것이 좋을까

#### standaloneSetup: 가볍고 빠른 단위/슬라이스 테스트

- 컨트롤러 하나만 단위로 빠르게 테스트하고 싶을 때 - 서비스 리포지토리는 mock/stub으로 대체
- Spring MVC의 복잡한 설정, 필터, 인터셉터, 빈 주입이 필요없고, 요청 ➡️ 컨트롤러 ➡️ 응답 흐름 + JSON 직렬화/역직렬화 + validation 등을 단순 검증할 떄
- 테스트 속도가 중요하고, 설정 로딩 없이 가볍게 여러 테스트를 돌리고 싶을 때

> 장점: 속도 빠르고 설정 간단 / 테스트 집중 /  mock 사용 편리
>
> 단점: Spring MVC 전체 설정을 반영하지 않기 때문에 필터, interceptor, 예외 핸들러 등은 무시됨 ➡️ 이러한 설정이 동작하는지 검증하려면 WebApplicationContext 기반 테스트가 별도로 필요

<br>

#### WebApplicationContext-Setup: 실제 설정 기반 통합 수준 테스트

- 실제 어플리케이션 설정 - 빈 구성, 필터, 인터셉터, 예외 핸들러, 메시지 컨버터 등을 모두 포함한 테스트가 필요할 때
- 여러 컨트롤러, 서비스, 빈 의존성 등이 얽혀 있고, 실제 설정이 잘 동작하는지 확인하고 싶을 때 
- 스프링 설정 오류, 메시지 변환, validation, security filter, exception resolver 등 실제 운영 환경과 유사한 요청 흐름 전체를 검증해야 할 때

> 장점: 설정을 그대로 반영 ➡️ 현실과 유사한 테스트/다양한 설정 요소 검증 가능
>
> 단점: 테스트 환경이 무거워지고, 설정 로딩 + 빈 초기화 비용이 발생

<hr>

## 예제

#### standaloneSetup 예제

```java
@ExtendWith(MockitoExtension.class)
class MyControllerTest {
    @InjectMocks
    private MyController myController;

    private MockMvc mockMvc;

    @BeforeEach
    void setup() {
        mockMvc = MockMvcBuilders.standaloneSetup(myController).build();
    }

    @Test
    void testHello() throws Exception {
        mockMvc.perform(get("hello")
               .param("name", "Alice"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.message").value("Hello, Alice"));
    }
}
```

- 컨트롤러만 등록, 다른 빈은 mock/stub으로 대체 ➡️ 빠르게 테스트
- 필터/인터셉터/예외 핸들러 등은 포함되지 않음

<br>

#### WebApplicationContextSetup 방식

```java
@SpringJUnitWebConfig(locations = "classpath:/web-servlet.xml")
class MyWebIntegrationTest {
    private MockMvc mockMvc;

    @BeforeEach
    void setup(WebApplicationContext wac) {
        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();
    }

    @Test
    void testGetUser() throws Exception {
        mockMvc.perform(get("/api/users/1"))
               .andExpect(status().isOk())
               .andExpect(content().contentType(MediaType.APPLICATION_JSON))
               .andExpect(jsonPath("$.id").value(1));
    }
}
```

- Spring 설정 + 모든 빈 + 메시지 컨버터 + 필터/예외 핸들러 등을 포함한 전체 stack 기반 테스트
- 운영 환경에 가까운 요청 흐름을 검증할 수 있어서, 설정 누락이나 오류를 잡는 데 유리

<hr>

## 주의사항

- 만약 StandaloneSetup만 사용하고, 필터/인터셉터/글로벌 예외 핸들러/메시지 컨버터 설정이 많다면 해당 설정이 제대로 동작하는지 검증하지 못할 수 있음
- WebApplicationContext 기반 테스트는 로딩/초기화 오버헤드가 있어, 테스트가 느려질 수 있고, context caching / 재사용을 고려할 필요가 있음