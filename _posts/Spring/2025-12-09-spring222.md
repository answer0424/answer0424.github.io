---
layout: post
title: Setup Features
date: 2025-12-09 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, MockMvc, Hamcrest]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## MockMvc 설정 순서

| 단계 | 설명/동작 |
|-|-|
| 1. MockMvc 인스턴스 생성/설정 | 테스트 전에 `MockMvcBuilders`를 통해 `MockMvc` 객체를 생성해야 함 |
| 2. ApplicationContext / Controller / 의존성 구성 | standaloneSetup 또는 webAppContextSetup을 통해 컨트롤러와 의존성을 설정 |
| 3. HTTP 요청 준비 | 테스트에서 실행할 HTTP 요청을 정의: GET/POST/PUT/DELETE 등 HTTP 메서드, URI, 파라미터/헤더/본문/Content-Type/Accept 설정 |
| 4. 요청 실행 | `mockMvc.perform(...)` 호출로, mock 서블릿 환경에서 가짜 요청 ➡️ 가짜 servlet 컨테이너 ➡️ 컨트롤러 핸들러 ➡️ 응답 흐름을 실행 |
| 5. 응답에 대한 검증 / 결과 처리 | `perform()`의 결과로 반환되는 `ResultActions` 객체를 이용해 `.andExpect()`, `.andDo()`, `.andReturn()` 등의 호출하여 응답 상태, 헤더, 본문, JSON 응답의 특정 필드 리다이렉션, 뷰이름, model 속성 등 다양한 검증 수행 |
| 6. 테스트 반복/다양한 시나리오 실행 | 동일한 MockMvc 인스턴스를 사용해 여러 테스트 케이스 실행 가능 |


<hr>

## 의미 & 장점

- MockMvc는 실제 서블릿 컨테이너 없이도, Spring MVC의 전체 요청 처리 흐름을 흉내내기 위해 설계됨
- `MockMvcBuilders.standaloneSetup()` 방식은 테스트 대상 컨트롤러만 집중해서 빠르게 테스트할 수 있게 해줘서 단위 테스트 또는 슬라이스 테스트에 적합
- 반면, `webAppContextSetup()` 방식은 실제 어플리케이션 설정을 로드해 통합 수준 테스트를 가능하게 함
- 이 단계적 구조 덕분에, 테스트 목적, 속도 vs 정확성, 설정 단순성 vs 전체 흐름 검증 등 상황에 맞게 유연하게 선택할 수 있음

<hr>

## 예제

#### standaloneSetup 방식

```java
class MyControllerTest {

    private MockMvc mockMvc;

    @BeforeEach
    void setup() {
        // 1. standaloneSetup — 컨트롤러만 등록
        mockMvc = MockMvcBuilders.standaloneSetup(new MyController()).build();
    }

    @Test
    void testHello() throws Exception {
        // 3. 요청 준비 + 4. 요청 실행 + 5. 검증
        mockMvc.perform(get("/hello").param("name", "Alice"))
               .andExpect(status().isOk())
               .andExpect(content().json("{\"message\":\"Hello, Alice\"}"));
    }
}
```

- 여기선 Spring 설정이나 전체 빈 로딩 없이, 단순하게 컨트롤러 단위 HTTP 요청/응답 테스트 가능

#### webAppContextSetup 방식

```java
@SpringJUnitWebConfig(locations = "classpath:/web-servlet-config.xml")
class MyWebIntegrationTest {

    private MockMvc mockMvc;

    @BeforeEach
    void setup(WebApplicationContext wac) {
        // 1. webAppContextSetup — 실제 컨텍스트 로드
        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();
    }

    @Test
    void testGetUser() throws Exception {
        mockMvc.perform(get("/api/users/1"))
               .andExpect(status().isOk())
               .andExpect(content().contentType(MediaType.APPLICATION_JSON))
               .andExpect(jsonPath("$.id").value(1))
               .andExpect(jsonPath("$.name").isNotEmpty());
    }
}
```

- 실제 Spring MVC 설정, 빈, 메시지 컨버터, 예외 핸들러 등 전체 설정이 적용된 상태이므로, production-like 환경에서 HTTP 흐름 전체를 테스트 가능

<hr>

## 주의사항 & 팁

- 하나의 테스트 클래스 안에서 설정 방식을 바꾸거나, 여러 컨트롤러 + 설정을 믹스하려면 `MockMvcBuilders` 호출 시 혼동이 없도록 해야 함
- `standaloneSetup`은 컨트롤러만 등록하고 나머지를 수동 mock/주입해야 해서, 만약 필터, 인터셉터 메시지 컨버터, 예외 핸들러 등이 필요하다면 `webAppContextSetup` 또는 `standaloneSetup` 등 추가 설정이 필요