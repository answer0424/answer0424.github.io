---
layout: post
title: Performing Requests
date: 2025-12-09 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, MockMvc, Hamcrest]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- MockMvc 단독 사용 시 요청 생성 ➡️ 수행 ➡️ 응답 검증하는 방법을 설명
- 만약 테스트에서 WebTestClient를 통해 MockMvc를 사용한다면 별도 섹션을 참고해야 함
- 즉, 실제 서버 없이 Spring MVC 컨트롤러 계층만 mock 환경에서 테스트 가능한 방식

<hr>

## 요청 작성/전송: 다양한 방식

| 방식/용도 | 사용 예 |
|-|-|
| HTTP 메서드 + URI 템플릿 | `mockMvc.perform(post("/hotels/{id}", 42).accept(MediaType.APPLICATION_JSON));` |
| 파일 업로드 | `mockMvc.perform(multipart("/doc").file("a1", "ABC".getBytes("UTF-8")));` |
| 쿼리 파라미터를 URI를 템플릿으로 전달 | `mockMvc.perform(get("/hotels?thing={thing}", "somewhere"));` |
| Servlet request 파라미터 | `mockMvc.perform(get("/hotels").param("thing", "somewhere"));` |

> 중요: 두 방식은 내부적으로 다름
>
> - URI 템플릿 방식은 브라우저/URL 인코딩 후 자동 디코딩된 값을 처리
> - "`param()`으로 전달하는 경우는 이미 디코딩된 값 상태여야 함"

<hr>

## 기본 요청 속성 설정과 재사용

> 매 요청마다 `contextPath`, `servletPath`, `accept` 헤더 등을 매번 지정하기 번거로울 수 있음
>
> 이럴 경우, MockMvc 인스턴스를 만들 때 default request 설정을 해 둘 수 있음

```java
mockMvc = standaloneSetup(new AccountController())
    .defaultRequest(get("/")
       .contextPath("/app")
       .servletPath("/main")
       .accept(MediaType.APPLICATION_JSON))
    .build();
```

- 여기서 주목할 점은 기본 request 설정은 HTTP 메서드와 URI는 의미없고 이후 실제 요청에서 overwrite 됨