---
layout: post
title: Configuring MockMvcTest
date: 2025-12-10 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, MockMvc, AssertJ]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---


## 개요

- MockMvc는 기본적으로 Hamcrest 기반의 매처 API로 요청 ➡️ 응답 테스트를 지원
- 하지만 Spring Framework 6.2부터는 MockMvc 결과를 더 현대적이고 읽기 쉬운 assertion 스타일로 검증하고자, MockMvc 위에 AssertJ 지원을 덧붙인 MockMvcTester를 제공
- MockMvcTester 덕분에 static import 없이, 예외 처리 선언 없이, fluent API + AssertJ assertion 스타일로 테스트 작성 가능

<hr>

## MockMvcTester 설정 방법

#### 특정 Controller 만을 테스트 - Standalone 방식

```java
private final MockMvcTester MockMvc = MovkMvcTester.of(new AccountController());
```

> 이 방식은 Spring 컨텍스트 전체를 로드하지 않고, 특정 컨트롤러만 독립적으로 테스트할 때 유용

<br>

#### Spring 설정 / WebApplicationContext 기반 - 통합된 MVC 설정 방식

```java
@SpringJUnitWebConfig(ApplicationConfig.class)
class AccountControllerIntegrationTests {
    private final MockMvcTester mockMvc;

    AccountControllerIntegrationTests(@Autowired WebApplicationContext wac) {
        this.mockMvc = MockMvcTester.from(wac);
    }
}
```

> 필요시 JSON 직렬화/역직렬화를 위해 HTTP 메시지 컨버터를 수동으로 등록할 수 있음

<br>

#### 예시

```java
mockMvc = MockMvcTester.from(wac)
    .withHttpMessageConverters(
        List.of(wac.getBean(AbstractJackson2HttpServletConverter.class))
    );
```

<hr>

## 장점

- 가독성: fluent API + AssertJ 스타일로 정적 import 없이 직관적인 `.get().uri()`, `.post()` 등으로 요청 구성 및 assertion 가능
- 예외 처리 단순화: 테스트 코드에서 `throws Exception` 선언이나 try-catch 없이, 예외를 일관되게 처리
- 동기/비동기 요청 모두 지원: 동기 요청뿐 아니라 async 요청 처리도 같은 API로 핸들링 가능
- JSON 응답 검증이 용이: Hamcrest + JsonPath 처럼 복잡한 체인 대신, AssertJ 기반으로 JSON 구조/값을 간결하게 검증 가능

<hr>

## 언제, 어떤 테스트에 MockMvcTester를 사용할까?

- 단위, 슬라이스 테스트: 특정 컨트롤러만 독립적으로 테스트할 때
- 통합테스트: WebApplicationContext 기반으로 MockMvcTester 생성
- Json API 응답 검증이 많고, 디버깅 / assertion 가독성을 중요시할 때
- async 요청 지원이 필요한 경우 