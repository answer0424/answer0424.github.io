---
layout: post
title: Defining Expectations
date: 2025-12-10 09:00:00 +09:00
categories: [Spring, Testing, TestContext Framework, MockMvc, AssertJ]
tags: [spring]
image:
    path: /assets/img/spring/Spring.png
---

## 개요

- MockMvc 기반 테스트에서, Hamcrest matcher + `.andExpect()` 방식 대신 AssertJ 스타일의 fluent API + assertion chain으로 검증할 수 있도록 해주는 게 MockMvcTester + AssertJ 통합
- static import 없이도 직관적이고 간결한 검증 코드 작성 가능
- 예외 처리 없이 테스트 코드를 깔끔히 유지 가능
- 비동기 요청도 기본적으로 완료된 결과를 기다려주기 떄문에 별도 async-dispatch 처리가 필요 없음
- 테스트 결과는 `MvcTestResult` / `MvcTestResultAssert` 등의 AssertJ-friendly 객체로 표현되며, 표준 `assertThat()` 구문을 사용할 수 있음

<hr>

## 지원되는 검증 항목들

| 검증 대상 / 항목 | 설명 |
|-|-|
| HTTP 응답 상태 | `hasStatusOk()` 처럼, 응답 상태가 200 OK인지 확인 가능한 메서드 제공 |
| 응답 Content-Type/헤더 | 예: `hasContentTypeCompatibleWith(MediaType.APPLICATION_JSON)` 같이 응답 `Content-Type` 헤더를 검사 가능 |
| 본문 - JSON, 텍스트 등 | `bodyJson()` 등을 통해 JSON 응답 본문을 AssertJ-friendly 방식으로 읽고, JSON 구조/값을 검증 가능 |
| 쿠키 | 응답에 포함된 쿠키를 검증하기 위한 assertion 객체 지원 |\
| 모델, 뷰, 핸드러 정보 | 만약 controller에서 모델/뷰 반환 형태라면, `hasViewName()` 또는 모델 속성 assertion, 핸들러 정보 assertion 등을 사용할 수 있음 |
| 요청, 응답 객체 속성 | 요청 객체나 응답 객체 자체에 대해 AssertJ assertions 사용 가능 |
| 비동기 처리 결과 | MockMvcTester는 async 요청도 기본으로 완료된 결과를 반환하므로, 별도 async-dispatch 없이 동일한 assertion API로 처리 가능 |

> 즉, 기존 Hamcrest + `andExpect()`로 할 수 있었던 대부분의 검증을 그리고 더 읽기 쉽고 유지보수하기 좋은 방식으로 AssertJ를 통해 수행 가능하다는 뜻

<hr>

## 예제

```java
assertThat(mockMvc.get().uri("/hotels/{id}", 42))
    .hasStatusOk()
    .hasContentTypeCompatibleWith(MediaType.APPLICATION_JSON)
    .bodyJson().isLenientEqualsTo("sample/hotel-42.json");
```

- 검증 대상
  - `/hotels/42` GET 요청의 응답
  - 응답 상태가 200 OK인지
  - 응답 Content-Type이 JSON인지
  - 응답 본문이 `sample/hotel-42.json` 파일과 lenient 모드로 동일한지
