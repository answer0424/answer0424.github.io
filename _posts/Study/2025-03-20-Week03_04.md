---
layout: post
title: Spring AOP & 프록시 개념
date: 2025-03-20 13:20 +09:00
categories: [Study, W03]
tags: [study]     
---

## AOP(Aspect-Oriented Programming)

> AOP는 관점 지향 프로그래밍이라고 불린다.
> 관점 지향은 쉽게 말해 어떤 로직을 기준으로 **핵심적인 관점**, **부가적인 관점**을 나누어서 보고 기 관점을 기준으로 각각 모듈화하겠다는 것

<br>

## 기본 구성 요소

#### Aspect (관점)

- AOP의 핵심 개념으로 공통 관심사를 **하나의 모듈**로 분리한 것
- 예를 들어 로그를 남기는 코드나 트랜잭션 처리 코드가 Aspect가 될 수 있음

<br>

#### Joinpoint (조인포인트)

- Aspect가 적용될 수 있는 지점, 즉 메서드 호출 지점을 의미
- Spring AOP에서는 메서드 실행 전후 예외 발생 시점 등이 조인 포인트가 될 수 있음

<br>

#### Advice (어드바이드)

- 조인포인트에서 실행되는 실제 작업을 정의한 코드
- 주로 **before**(메서드 실행 전), **after**(메서드 실행 후), **around**(메서드 실행 전후) 등이 있음

<br>

#### Pointcut (포인트컷)

- 어떤 조인포인트에 Advice를 적용할지 정의한 표현식
- 예를 들어 특정 패키지나 클래스에 속한 메서드들에만 적용할 수 있음

<br>

#### Weaving (위빙)

- Aspect를 코드에 적용하는 과정
- AOP에서는 위빙을 컴파일 타임, 로딩 타임, 런타임에 할 수 있음
- Spring AOP는 **런타임 위빙** 방식을 사용

![AOP](/assets/img/study/Week03_12.png)

<br>

## 프록시 (Proxy)

> 프록시는 객체의 대리자로 원래 객체에 대한 **접근을 제어**하거나, **기능을 확장**하는 데 사용
> AOP에서 프록시는 주로 **메서드 실행 전후에 추가적인 로직을 처리**하는 데 쓰임


<br>

## 프록시 종류

#### JDK 동적 프록시

- 인터페이스 기반의 프록시
- 원본 객체가 구현한 **인터페이스를 기반**으로 프록시 객체를 생성
- Spring AOP에서는 `@Transactional` 어노테이션을 사용할 때 주로 사용

#### CGLIB 프록시 (Code Generation Library)

- 클래스 기반의 프록시
- JDK 동적 프록시는 인터페이스를 요구하는 반면, CGLIB는 **클래스를 상속**하여 프록시를 생성
- 원본 객체가 인터페이스를 구현하지 않더라도 프록시를 만들 수 있음

<br>

## Spring에서의 AOP와 프록시

> Spring에서는 AOP를 **프록시 기반**으로 구현
> Spring AOP는 메서드 **실행 전후에 추가 로직을 실행**하기 위해 프록시 패턴을 사용

#### Spring에서 AOP 적용하는 방식

- JDK 동적 프록시는 주로 `@Service`와 같은 인터페이스 기반의 빈에 대해 사용
- CGLIB 프록시는 클래스 기반으로 동작하므로, 원본 클래스에 대해 AOP를 적용할 수 있음

<br>

## AOP와 프록시를 실생활에 비유하여 표현한다면?

#### AOP

- 회사에서의 공통 업무
  - 부서 A : 근무 시간 기록 + 인사 담당
  - 부서 B : 근무 시간 기록 + 기술 담당
  - 부서 C : 근무 시간 기록 + 기획 담당
- 이 때 AOP에서는 근무 시간 기록이라는 **공통 관심사**를 하나의 관리 시스템으로 빼서, 모든 부서가 일 할 때마다 자동으로 기록되도록 하는 것

<br>

#### 프록시

- 대리인 (비서)
- CEO가 회의에 참석해야 하는 상황이지만 여러가지 업무로 인해 대리인으로 통해 **결정 사항을 전달**하고 **필요한 사항**을 CEO에게 보고 하는 방식

<br>

## AOP와 프록시를 사용하는 이유

- 중복 코드 제거
  - AOP를 사용하면 로그를 찍는 작업을 여러 클래스에서 반복적으로 하지 않아도 됨
- 핵심 로직과 공통 작업 분리
  - 핵심 로직만 집중해서 작성하고 트랜잭션 처리는 AOP에서 자동으로 관리되므로 코드가 깔끔해짐
- 유연한 확장성
  - 새로운 부가 기능을 추가할 때 AOP를 사용하면 기존 코드를 수정하지 않고도 새로운 기능 쉽게 추가 가능
- 보안과 관리 용이