---
layout: post
title: Chapter 09. 단위 테스트
date: 2025-03-15 14:52 +09:00
categories: [Study, CleanCode]
tags: [study]     
---

## TDD 법칙 3가지 (Test Driven Development)

- 첫째 법칙 : 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
- 둘째 법칙 : 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
- 섯째 법칙 : 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.
  - 실제 코드를 사실상 전부 테스트하는 테스트 케이스가 나온다.
  - 하지만 실제 코드와 맞먹을 정도로 방대한 테스트 코드는 심각한 관리 문제를 유발하기도 함

<br>

## 깨끗한 테스트 코드 유지하기

- 실제 코드가 진화하면 테스트 코드도 변해야 함
- 그렇기 때문에 실제 코드를 짜는 시간보다 테스트 케이스를 추가하는 시간이 더 걸림
- 그렇기 때문에 테스트 케이스가 실패하기 시작하면, 지저분한 코드로 인해, 실패하는 테스트 케이스를 점점 더 통과시키기 어려움
- 결국에는 테스트 슈트를 폐기하게 됨
  - 문제점 : 테스트 슈트가 없으면 개발자는 자신이 수정한 코드가 제대로 도는지 확인할 방법이 없음
  - 문제점 : 결함률이 높아지기 시작
  - 문제점 : 코드가 망가지기 시작
  - 결론 : 테스트 코드는 실제 코드 못지 않게 중요하다.

#### 테스트는 유연성, 유지보수성, 재사용성을 제공

- 코드에 유연성, 유지보수성, 재사용성을 제공하는 버팀목이 바로 단위 테스트!
- 테스트 케이스가 없다면 모든 변경은 잠정적인 버그
- 테스트 케이스가 있으면 변경이 쉬워짐!!

<br>

## 깨끗한 테스트 코드

- 깨끗한 테스트 코드를 만드려면 꼭 알아야 하는 내용 → **가독성!!**
- 가독성은 실제 코드에서보다 테스트 코드에서 더 중요
- 가독성을 높이려면 → 명료성, 단순성, 풍부한 표현력

#### BUILD-OPERATE-CHECK 패턴

1. 테스트 자료 만들기
2. 테스트 자료를 조작
3. 조작한 결과가 올바른지 확인

#### 도메인에 특화된 언어 (DSL)

- 테스트를 구현하는 당사자와 나중에 테스트를 읽어볼 독자를 도와주는 테스트 언어

#### 이중 표현

```java
@Test
public void turnOnLoTempAlarmAtThreshold() throws Exception {
    hw.setTemp(WAY_TOO_COLD);
    controller.tic();
    assertTrue(hw.heaterState());
    assertTrue(hw.blowerState());
    assertTrue(hw.coolerState());
    assertTrue(hw.hiTempAlarm());
    assertTrue(hw.loTempAlarm());
}
```

⬇️⬇️⬇️

```java
@Test
public void tuenOnLoTempAlarmAtThreshold() throws Exception {
    wayTooCold();
    assertEquals("HBchL", hw.getState());
}
```

<br>

## 테스트당 assert 하나

- JUnit으로 테스트 코드를 짤 때는 함수마다 assert 문을 단 하나만 사용해야 하는 것이 좋음 (줄이는 것이 좋음)


#### TEMPLATE METHOD 패턴

- 해당 패턴을 사용하면 중복을 제거할 수 있음
- 상위 클래스에서 알고리즘의 골격을 정의하고, 하위 클래스에서 그 알고리즘의 세부 단계를 구현하는 패턴
- 상속과 관련 개념??

<br>

## 테스트당 개념 하나

- 이것저것 잡다한 개념을 연속으로 테스트하는 긴 함수는 피해야 함
- 즉, 가장 좋은 규칙은 개념 당 assert 문 수를 최소한 줄이는 것과 테스트 함수 하나는 개념 하나만 테스트하는 것

<br>

## F.I.R.S.T

1. 빠르게(Fast) : 초반에 문제를 찾아내고 코드를 마음껏 정리하기 위해서는 테스트는 빨라야 한다.
2. 독립적으로(Independent) : 테스트가 의존하게 되면 연쇄적으로 실패할 가능성이 있기 때문에 각 테스트는 독립적이어야 한다.
3. 반복가능하게(Repeatable) : 테스트는 어떠한 환경에서도 돌아가야 한다.
4. 자가검증하는(Self-Validating) : 테스트가 스스로 성공과 실패를 가늠하지 않으면 안되고 결론적으로는 bool 값으로 결과를 내야 한다.
5. 적시에(Timely) : 단위 테스는 적시인 실제 코드를 구현하기 직전에 구현해야 한다.

<br>

## 결론
- 테스트 코드는 실제 코드의 유연성, 유지보수성, 재사용성을 보존하고 강화하기 위함
- 테스트 코드를 지속적으로 깨끗하게 관리해야 함
- 표현력을 높이고 간결하게 정리
- 테스트 API를 구현해 도메인 특화 언어를 만들자

<br>

## 핵심 요약
- TDD 법칙: 테스트를 먼저 작성하고, 실패하는 테스트를 통과시킬 수 있는 최소한의 코드만 작성한다.
- 깨끗한 테스트 코드: 코드의 가독성을 높이고, 테스트 코드는 실제 코드 못지않게 관리해야 한다.
- F.I.R.S.T: 테스트는 빠르고, 독립적이며, 반복 가능하고, 자가검증해야 하며, 코드를 작성하기 직전에 구현해야 한다.